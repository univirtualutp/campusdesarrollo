import{n as G,i as Ul,a as kn,l as wn,c as $n,d as yn,S as oe,b as fe,e as re,f as ge,g as y,h as M,j as h,k as m,s as _e,t as R,m as et,r as Ie,o as g,p as F,q as Tt,u as Mn,v as L,w as W,x as De,y as je,z as it,A as Cn,B as Sn,C as Dn,D as S,E as Ae,F as He,G as z,H as Me,I as dt,J as ht,K as Se,L as ne,M as ie,N as J,O as K,P as V,Q as O,R as ut,T as Lt,U as ue,V as Le,W as Be,X as ze,Y as rt,Z as he,_ as Fe,$ as Hl,a0 as Ve,a1 as We,a2 as vt,a3 as Oe,a4 as Ol,a5 as Jl,a6 as _t,a7 as nt,a8 as Ee,a9 as zt,aa as ct,ab as jt,ac as Kl,ad as Vl,ae as Ge,af as Ue,ag as tt,ah as bt,ai as Wl,aj as Nt,ak as Tn,al as Ln,am as Xl,an as zn,ao as jn,ap as Yl,aq as Nn,ar as gt,as as In}from"./global-BngkQIBe.js";const at=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ql(l,e,t,s){if(!e)return G;const n=l.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return G;const{delay:i=0,duration:r=300,easing:o=Ul,start:a=kn()+i,end:f=a+r,tick:c=G,css:u}=t(l,{from:e,to:n},s);let d=!0,_=!1,b;function p(){u&&(b=$n(l,0,1,r,i,o,u)),i||(_=!0)}function $(){u&&yn(l,b),d=!1}return wn(w=>{if(!_&&w>=a&&(_=!0),_&&w>=f&&(c(1,0),$()),!d)return!1;if(_){const k=w-a,C=0+1*o(k/r);c(C,1-C)}return!0}),p(),c(0,1),$}function Zl(l){const e=getComputedStyle(l);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,n=l.getBoundingClientRect();l.style.position="absolute",l.style.width=t,l.style.height=s,kt(l,n)}}function kt(l,e){const t=l.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(l),n=s.transform==="none"?"":s.transform;l.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Ke=(l=>(l[l.NotDeleted=0]="NotDeleted",l[l.Deleted=1]="Deleted",l[l.DeletedForever=2]="DeletedForever",l))(Ke||{}),xl=(l=>(l[l.No=0]="No",l[l.Separate=1]="Separate",l[l.Visible=2]="Visible",l))(xl||{}),qe=(l=>(l.TO="to",l.CC="cc",l.BCC="bcc",l))(qe||{}),ae=(l=>(l[l.SM=576]="SM",l[l.MD=768]="MD",l[l.LG=992]="LG",l[l.XL=1200]="XL",l))(ae||{});function It(l){let e;function t(i,r){return i[2]?Bn:An}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),m(e,"class","local-mail-course-link mt-n2 mb-3 mb-lg-4")},m(i,r){y(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&M(e),n.d()}}}function An(l){let e;return{c(){e=R(" ")},m(t,s){y(t,e,s)},p:G,d(t){t&&M(e)}}}function Bn(l){let e,t,s=et(l[2],l[1].settings.courselink)+"",n,i,r;return{c(){e=h("nav"),t=h("a"),n=R(s),m(t,"class","text-truncate"),m(t,"href",i=window.M.cfg.wwwroot+"/course/view.php?id="+l[1].params.courseid),m(t,"title",r=Ie(l[1].strings.gotocourse,et(l[2],"fullname"))),m(e,"class","d-flex align-items-center")},m(o,a){y(o,e,a),g(e,t),g(t,n)},p(o,a){a&6&&s!==(s=et(o[2],o[1].settings.courselink)+"")&&F(n,s),a&2&&i!==(i=window.M.cfg.wwwroot+"/course/view.php?id="+o[1].params.courseid)&&m(t,"href",i),a&6&&r!==(r=Ie(o[1].strings.gotocourse,et(o[2],"fullname")))&&m(t,"title",r)},d(o){o&&M(e)}}}function qn(l){let e=["shortname","fullname"].includes(l[1].settings.courselink),t,s=e&&It(l);return{c(){s&&s.c(),t=ge()},m(n,i){s&&s.m(n,i),y(n,t,i)},p(n,[i]){i&2&&(e=["shortname","fullname"].includes(n[1].settings.courselink)),e?s?s.p(n,i):(s=It(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:G,o:G,d(n){n&&M(t),s&&s.d(n)}}}function Pn(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,a=>t(1,n=a)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;return r(),l.$$set=a=>{"store"in a&&r(t(0,o=a.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=n.courses.find(a=>a.id==n.params.courseid))},[o,n,s]}class En extends oe{constructor(e){super(),fe(this,e,Pn,qn,re,{store:0})}}function en(l){const e=l-1;return e*e*e+1}function Pe(l,{delay:e=0,duration:t=400,easing:s=Ul}={}){const n=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*n}`}}function mt(l,{delay:e=0,duration:t=400,easing:s=en,x:n=0,y:i=0,opacity:r=0}={}){const o=getComputedStyle(l),a=+o.opacity,f=o.transform==="none"?"":o.transform,c=a*(1-r),[u,d]=Tt(n),[_,b]=Tt(i);return{delay:e,duration:t,easing:s,css:(p,$)=>`
			transform: ${f} translate(${(1-p)*u}${d}, ${(1-p)*_}${b});
			opacity: ${a-c*$}`}}const{document:Rn}=at;function At(l){let e,t,s=l[1]&&Bt(l),n=l[2]&&l[4]&&qt(l);return{c(){e=h("div"),s&&s.c(),t=L(),n&&n.c(),m(e,"class","modal-footer")},m(i,r){y(i,e,r),s&&s.m(e,null),g(e,t),n&&n.m(e,null)},p(i,r){i[1]?s?s.p(i,r):(s=Bt(i),s.c(),s.m(e,t)):s&&(s.d(1),s=null),i[2]&&i[4]?n?n.p(i,r):(n=qt(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&M(e),s&&s.d(),n&&n.d()}}}function Bt(l){let e,t,s,n;return{c(){e=h("button"),t=R(l[1]),m(e,"type","button"),m(e,"class","btn btn-secondary")},m(i,r){y(i,e,r),g(e,t),s||(n=W(e,"click",function(){De(l[3])&&l[3].apply(this,arguments)}),s=!0)},p(i,r){l=i,r&2&&F(t,l[1])},d(i){i&&M(e),s=!1,n()}}}function qt(l){let e,t,s,n,i;return{c(){e=h("button"),t=R(l[2]),m(e,"type","button"),m(e,"class",s="btn "+l[5]),e.disabled=l[6]},m(r,o){y(r,e,o),g(e,t),n||(i=W(e,"click",function(){De(l[4])&&l[4].apply(this,arguments)}),n=!0)},p(r,o){l=r,o&4&&F(t,l[2]),o&32&&s!==(s="btn "+l[5])&&m(e,"class",s),o&64&&(e.disabled=l[6])},d(r){r&&M(e),n=!1,i()}}}function Fn(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p,$,w,k,C,v,T;const A=l[10].default,D=Mn(A,l,l[9],null);let N=(l[1]||l[2]&&l[4])&&At(l);return{c(){e=L(),t=h("div"),s=h("div"),n=h("div"),i=h("div"),r=h("h5"),o=R(l[0]),a=L(),f=h("button"),c=h("span"),c.textContent="×",u=L(),d=h("div"),D&&D.c(),_=L(),N&&N.c(),$=L(),w=h("div"),m(r,"class","modal-title"),m(c,"aria-hidden","true"),m(f,"type","button"),m(f,"class","close"),m(f,"aria-label",l[1]),m(i,"class","modal-header"),m(d,"class","modal-body"),m(n,"class","modal-content"),m(s,"class","modal-dialog"),m(t,"class","modal show"),m(t,"tabindex","-1"),m(t,"role","dialog"),m(t,"aria-label",l[0]),m(t,"aria-modal","true"),m(w,"class","modal-backdrop show")},m(I,H){y(I,e,H),y(I,t,H),g(t,s),g(s,n),g(n,i),g(i,r),g(r,o),g(i,a),g(i,f),g(f,c),g(n,u),g(n,d),D&&D.m(d,null),g(n,_),N&&N.m(n,null),l[11](t),y(I,$,H),y(I,w,H),C=!0,v||(T=[W(Rn.body,"keyup",l[8]),W(f,"click",function(){De(l[3])&&l[3].apply(this,arguments)}),je(b=it.call(null,t,l[3]))],v=!0)},p(I,[H]){l=I,(!C||H&1)&&F(o,l[0]),(!C||H&2)&&m(f,"aria-label",l[1]),D&&D.p&&(!C||H&512)&&Cn(D,A,l,l[9],C?Dn(A,l[9],H,null):Sn(l[9]),null),l[1]||l[2]&&l[4]?N?N.p(l,H):(N=At(l),N.c(),N.m(n,null)):N&&(N.d(1),N=null),(!C||H&1)&&m(t,"aria-label",l[0]),b&&De(b.update)&&H&8&&b.update.call(null,l[3])},i(I){C||(S(D,I),Ae(()=>{C&&(p||(p=He(t,mt,{y:-100},!0)),p.run(1))}),Ae(()=>{C&&(k||(k=He(w,Pe,{},!0)),k.run(1))}),C=!0)},o(I){z(D,I),p||(p=He(t,mt,{y:-100},!1)),p.run(0),k||(k=He(w,Pe,{},!1)),k.run(0),C=!1},d(I){I&&(M(e),M(t),M($),M(w)),D&&D.d(I),N&&N.d(),l[11](null),I&&p&&p.end(),I&&k&&k.end(),v=!1,Me(T)}}}function Gn(l,e,t){let{$$slots:s={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:o=""}=e,{onCancel:a}=e,{onConfirm:f=void 0}=e,{confirmClass:c="btn-primary"}=e,{confirmDisabled:u=!1}=e,d;dt(()=>{document.body.classList.add("modal-open"),d.focus()}),ht(()=>{document.body.classList.remove("modal-open")});const _=p=>{p.key=="Escape"&&a()};function b(p){Se[p?"unshift":"push"](()=>{d=p,t(7,d)})}return l.$$set=p=>{"title"in p&&t(0,i=p.title),"cancelText"in p&&t(1,r=p.cancelText),"confirmText"in p&&t(2,o=p.confirmText),"onCancel"in p&&t(3,a=p.onCancel),"onConfirm"in p&&t(4,f=p.onConfirm),"confirmClass"in p&&t(5,c=p.confirmClass),"confirmDisabled"in p&&t(6,u=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[i,r,o,a,f,c,u,d,_,n,s,b]}class Xe extends oe{constructor(e){super(),fe(this,e,Gn,Fn,re,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function Pt(l){let e,t;return e=new Xe({props:{title:l[1].strings.error,onCancel:l[2],$$slots:{default:[Un]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.title=s[1].strings.error),n&1&&(i.onCancel=s[2]),n&10&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Et(l){var n;let e,t=((n=l[1].error)==null?void 0:n.debuginfo)+"",s;return{c(){e=h("p"),s=R(t)},m(i,r){y(i,e,r),g(e,s)},p(i,r){var o;r&2&&t!==(t=((o=i[1].error)==null?void 0:o.debuginfo)+"")&&F(s,t)},d(i){i&&M(e)}}}function Rt(l){var n,i;let e,t=(((n=l[1].error)==null?void 0:n.backtrace)||((i=l[1].error)==null?void 0:i.stacktrace))+"",s;return{c(){e=h("pre"),s=R(t)},m(r,o){y(r,e,o),g(e,s)},p(r,o){var a,f;o&2&&t!==(t=(((a=r[1].error)==null?void 0:a.backtrace)||((f=r[1].error)==null?void 0:f.stacktrace))+"")&&F(s,t)},d(r){r&&M(e)}}}function Un(l){var f,c,u,d;let e,t=((f=l[1].error)==null?void 0:f.message)+"",s,n,i,r,o=((c=l[1].error)==null?void 0:c.debuginfo)&&Et(l),a=(((u=l[1].error)==null?void 0:u.backtrace)||((d=l[1].error)==null?void 0:d.stacktrace))&&Rt(l);return{c(){e=h("p"),s=R(t),n=L(),o&&o.c(),i=L(),a&&a.c(),r=ge()},m(_,b){y(_,e,b),g(e,s),y(_,n,b),o&&o.m(_,b),y(_,i,b),a&&a.m(_,b),y(_,r,b)},p(_,b){var p,$,w,k;b&2&&t!==(t=((p=_[1].error)==null?void 0:p.message)+"")&&F(s,t),($=_[1].error)!=null&&$.debuginfo?o?o.p(_,b):(o=Et(_),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null),(w=_[1].error)!=null&&w.backtrace||(k=_[1].error)!=null&&k.stacktrace?a?a.p(_,b):(a=Rt(_),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},d(_){_&&(M(e),M(n),M(i),M(r)),o&&o.d(_),a&&a.d(_)}}}function Hn(l){let e,t,s=l[1].error&&Pt(l);return{c(){s&&s.c(),e=ge()},m(n,i){s&&s.m(n,i),y(n,e,i),t=!0},p(n,[i]){n[1].error?s?(s.p(n,i),i&2&&S(s,1)):(s=Pt(n),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(S(s),t=!0)},o(n){z(s),t=!1},d(n){n&&M(e),s&&s.d(n)}}}function On(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.setError();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Jn extends oe{constructor(e){super(),fe(this,e,On,Hn,re,{store:0})}}function Kn(l){let e,t,s,n,i,r;return{c(){e=h("button"),t=h("i"),m(t,"class","fa fa-fw fa-trash"),m(e,"type","button"),m(e,"class","local-mail-delete-button btn"),e.disabled=s=!l[2].selectedMessages.size,m(e,"title",n=l[2].strings.movetotrash),O(e,"btn-secondary",!l[1]),O(e,"btn-light",l[1]),O(e,"disabled",!l[2].selectedMessages.size)},m(o,a){y(o,e,a),g(e,t),i||(r=W(e,"click",l[3]),i=!0)},p(o,[a]){a&4&&s!==(s=!o[2].selectedMessages.size)&&(e.disabled=s),a&4&&n!==(n=o[2].strings.movetotrash)&&m(e,"title",n),a&2&&O(e,"btn-secondary",!o[1]),a&2&&O(e,"btn-light",o[1]),a&4&&O(e,"disabled",!o[2].selectedMessages.size)},i:G,o:G,d(o){o&&M(e),i=!1,r()}}}function Vn(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{bottom:o=!1}=e;const a=()=>r.setDeleted(Array.from(s.selectedMessages.keys()),Ke.Deleted,!0);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"bottom"in f&&t(1,o=f.bottom)},[r,o,s,a]}class tn extends oe{constructor(e){super(),fe(this,e,Vn,Kn,re,{store:0,bottom:1})}}function Ft(l){let e,t;return e=new Xe({props:{title:l[2].strings.deleteforever,cancelText:l[2].strings.cancel,confirmText:l[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:l[5],onConfirm:l[3],$$slots:{default:[Wn]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.deleteforever),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.deleteforever),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Wn(l){let e=l[2].strings[l[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"",t;return{c(){t=R(e)},m(s,n){y(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings[s[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"")&&F(t,e)},d(s){s&&M(t)}}}function Xn(l){let e,t,s,n,i,r,o,a,f,c=l[2].params.dialog=="deleteforever"&&Ft(l);return{c(){e=h("button"),t=h("i"),i=L(),c&&c.c(),r=ge(),m(t,"class","fa fa-fw fa-trash"),m(e,"type","button"),m(e,"class","local-mail-delete-forever-button btn"),e.disabled=s=!l[2].selectedMessages.size,m(e,"title",n=l[2].strings.deleteforever),O(e,"btn-secondary",!l[1]),O(e,"btn-light",l[1])},m(u,d){y(u,e,d),g(e,t),y(u,i,d),c&&c.m(u,d),y(u,r,d),o=!0,a||(f=W(e,"click",l[4]),a=!0)},p(u,[d]){(!o||d&4&&s!==(s=!u[2].selectedMessages.size))&&(e.disabled=s),(!o||d&4&&n!==(n=u[2].strings.deleteforever))&&m(e,"title",n),(!o||d&2)&&O(e,"btn-secondary",!u[1]),(!o||d&2)&&O(e,"btn-light",u[1]),u[2].params.dialog=="deleteforever"?c?(c.p(u,d),d&4&&S(c,1)):(c=Ft(u),c.c(),S(c,1),c.m(r.parentNode,r)):c&&(ne(),z(c,1,1,()=>{c=null}),ie())},i(u){o||(S(c),o=!0)},o(u){z(c),o=!1},d(u){u&&(M(e),M(i),M(r)),c&&c.d(u),a=!1,f()}}}function Yn(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,u=>t(2,s=u)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{bottom:o=!1}=e;const a=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Ke.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),c=()=>r.hideDialog();return l.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"bottom"in u&&t(1,o=u.bottom)},[r,o,s,a,f,c]}class sn extends oe{constructor(e){super(),fe(this,e,Yn,Xn,re,{store:0,bottom:1})}}function Gt(l,e,t){const s=l.slice();return s[16]=e[t],s}function Qn(l){let e;return{c(){e=R(" ")},m(t,s){y(t,e,s)},p:G,d(t){t&&M(e)}}}function Zn(l){let e=l[5].strings.errorrepeatedlabelname+"",t;return{c(){t=R(e)},m(s,n){y(s,t,n)},p(s,n){n&32&&e!==(e=s[5].strings.errorrepeatedlabelname+"")&&F(t,e)},d(s){s&&M(t)}}}function xn(l){let e;return{c(){e=h("span"),e.textContent="a",m(e,"aria-hidden","true")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function ei(l){let e;return{c(){e=h("i"),m(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function Ut(l,e){let t,s,n,i,r,o;function a(d,_){return d[16]==d[7]?ei:xn}let f=a(e),c=f(e);function u(){return e[15](e[16])}return{key:l,first:null,c(){t=h("button"),c.c(),s=L(),m(t,"role","radio"),m(t,"aria-checked",n=e[16]==e[7]),m(t,"tabindex","0"),m(t,"title",i=e[5].strings[`color${e[16]}`]),m(t,"class","local-mail-label-modal-color-option btn svelte-cky3j8"),m(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(d,_){y(d,t,_),c.m(t,null),g(t,s),r||(o=W(t,"click",Be(u)),r=!0)},p(d,_){e=d,f!==(f=a(e))&&(c.d(1),c=f(e),c&&(c.c(),c.m(t,s))),_&128&&n!==(n=e[16]==e[7])&&m(t,"aria-checked",n),_&32&&i!==(i=e[5].strings[`color${e[16]}`])&&m(t,"title",i)},d(d){d&&M(t),c.d(),r=!1,o()}}}function ti(l){let e,t,s,n=l[5].strings.name+"",i,r,o,a,f,c,u,d,_,b,p,$=l[5].strings.color+"",w,k,C,v,T=[],A=new Map,D,N,I;function H(X,ee){return X[4]?Zn:Qn}let P=H(l),q=P(l),Z=ue(ut);const se=X=>X[16];for(let X=0;X<Z.length;X+=1){let ee=Gt(l,Z,X),U=se(ee);A.set(U,T[X]=Ut(U,ee))}return{c(){e=h("form"),t=h("div"),s=h("label"),i=R(n),r=L(),o=h("input"),f=L(),c=h("div"),q.c(),u=L(),d=h("div"),d.textContent=" ",_=L(),b=h("div"),p=h("label"),w=R($),C=L(),v=h("div");for(let X=0;X<T.length;X+=1)T[X].c();m(s,"for","local-mail-label-modal-name"),m(o,"type","text"),o.required=!0,m(o,"class","form-control is-invalid"),m(o,"id",a=l[9]+"-name"),O(o,"is-valid",l[8]),O(o,"is-invalid",!l[8]),m(c,"class","invalid-feedback"),m(d,"class","valid-feedback"),m(t,"class","form-group mb-0"),m(p,"for",k=l[9]+"-color"),m(v,"role","radiogroup"),m(v,"class","local-mail-label-modal-color svelte-cky3j8"),m(v,"id",D=l[9]+"-color"),m(b,"class","form-group")},m(X,ee){y(X,e,ee),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),l[13](o),Le(o,l[3]),g(t,f),g(t,c),q.m(c,null),g(t,u),g(t,d),g(e,_),g(e,b),g(b,p),g(p,w),g(b,C),g(b,v);for(let U=0;U<T.length;U+=1)T[U]&&T[U].m(v,null);N||(I=[W(o,"input",l[14]),W(e,"submit",Be(l[10]))],N=!0)},p(X,ee){ee&32&&n!==(n=X[5].strings.name+"")&&F(i,n),ee&512&&a!==(a=X[9]+"-name")&&m(o,"id",a),ee&8&&o.value!==X[3]&&Le(o,X[3]),ee&256&&O(o,"is-valid",X[8]),ee&256&&O(o,"is-invalid",!X[8]),P===(P=H(X))&&q?q.p(X,ee):(q.d(1),q=P(X),q&&(q.c(),q.m(c,null))),ee&32&&$!==($=X[5].strings.color+"")&&F(w,$),ee&512&&k!==(k=X[9]+"-color")&&m(p,"for",k),ee&160&&(Z=ue(ut),T=ze(T,ee,se,1,X,Z,A,v,rt,Ut,null,Gt)),ee&512&&D!==(D=X[9]+"-color")&&m(v,"id",D)},d(X){X&&M(e),l[13](null),q.d();for(let ee=0;ee<T.length;ee+=1)T[ee].d();N=!1,Me(I)}}}function si(l){let e,t;return e=new Xe({props:{title:l[5].strings[l[1]?"editlabel":"newlabel"],cancelText:l[5].strings.cancel,onCancel:l[2],confirmText:l[5].strings[l[1]?"save":"create"],confirmDisabled:!l[8],onConfirm:l[10],$$slots:{default:[ti]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,[n]){const i={};n&34&&(i.title=s[5].strings[s[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=s[5].strings.cancel),n&4&&(i.onCancel=s[2]),n&34&&(i.confirmText=s[5].strings[s[1]?"save":"create"]),n&256&&(i.confirmDisabled=!s[8]),n&525304&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function li(l,e,t){let s,n,i,r,o,a,f,c=G,u=()=>(c(),c=_e(d,T=>t(5,f=T)),d);l.$$.on_destroy.push(()=>c());let{store:d}=e;u();let{label:_=void 0}=e,{onCancel:b}=e,{onSubmit:p}=e,$;const w=async()=>{p(n,i)};dt(()=>$.focus());function k(T){Se[T?"unshift":"push"](()=>{$=T,t(6,$)})}function C(){n=this.value,t(3,n),t(1,_)}const v=T=>{t(7,i=T)};return l.$$set=T=>{"store"in T&&u(t(0,d=T.store)),"label"in T&&t(1,_=T.label),"onCancel"in T&&t(2,b=T.onCancel),"onSubmit"in T&&t(11,p=T.onSubmit)},l.$$.update=()=>{l.$$.dirty&2&&t(9,s=`local-mail-label-modal-${(_==null?void 0:_.id)||"new"}`),l.$$.dirty&2&&t(3,n=(_==null?void 0:_.name)||""),l.$$.dirty&2&&t(7,i=(_==null?void 0:_.color)||ut[0]),l.$$.dirty&8&&t(12,r=Lt(n)==""),l.$$.dirty&42&&t(4,o=f.labels.some(T=>T.id!=(_==null?void 0:_.id)&&T.name==Lt(n))),l.$$.dirty&4112&&t(8,a=!r&&!o)},[d,_,b,n,o,f,$,i,a,s,w,p,r,k,C,v]}class ln extends oe{constructor(e){super(),fe(this,e,li,si,re,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:ni}=at;function Ht(l,e,t){const s=l.slice();return s[15]=e[t],s}function Ot(l){let e,t=[],s=new ni,n,i,r=ue(l[2].labels);const o=d=>d[15].id;for(let d=0;d<r.length;d+=1){let _=Ht(l,r,d),b=o(_);s.set(b,t[d]=Jt(b,_))}let a=l[2].labels.length>0&&Kt();function f(d,_){return d[5]?ri:ii}let c=f(l),u=c(l);return{c(){e=h("div");for(let d=0;d<t.length;d+=1)t[d].c();n=L(),a&&a.c(),i=L(),u.c(),m(e,"class","dropdown-menu show")},m(d,_){y(d,e,_);for(let b=0;b<t.length;b+=1)t[b]&&t[b].m(e,null);g(e,n),a&&a.m(e,null),g(e,i),u.m(e,null)},p(d,_){_&276&&(r=ue(d[2].labels),t=ze(t,_,o,1,d,r,s,e,rt,Jt,n,Ht)),d[2].labels.length>0?a||(a=Kt(),a.c(),a.m(e,i)):a&&(a.d(1),a=null),c===(c=f(d))&&u?u.p(d,_):(u.d(1),u=c(d),u&&(u.c(),u.m(e,null)))},d(d){d&&M(e);for(let _=0;_<t.length;_+=1)t[_].d();a&&a.d(),u.d()}}}function Jt(l,e){let t,s,n,i,r=e[15].name+"",o,a,f;function c(){return e[13](e[15])}return{key:l,first:null,c(){t=h("button"),s=h("i"),i=L(),o=R(r),m(s,"class",n="fa fa-fw "+e[4](e[15].id)+" svelte-1r4iigx"),m(t,"type","button"),m(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(u,d){y(u,t,d),g(t,s),g(t,i),g(t,o),a||(f=W(t,"click",c),a=!0)},p(u,d){e=u,d&20&&n!==(n="fa fa-fw "+e[4](e[15].id)+" svelte-1r4iigx")&&m(s,"class",n),d&4&&r!==(r=e[15].name+"")&&F(o,r)},d(u){u&&M(t),a=!1,f()}}}function Kt(l){let e;return{c(){e=h("div"),m(e,"class","dropdown-divider")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function ii(l){let e,t=l[2].strings.newlabel+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[10]),n=!0)},p(r,o){o&4&&t!==(t=r[2].strings.newlabel+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function ri(l){let e,t=l[2].strings.apply+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[9]),n=!0)},p(r,o){o&4&&t!==(t=r[2].strings.apply+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function Vt(l){let e,t;return e=new ln({props:{store:l[0],onCancel:l[14],onSubmit:l[11]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[14]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function ai(l){let e,t,s,n,i,r,o,a,f,c,u=l[3]&&Ot(l),d=l[2].params.dialog=="createlabel"&&Vt(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),u&&u.c(),o=L(),d&&d.c(),m(s,"class","fa fa-fw fa-tag"),m(t,"type","button"),m(t,"class","local-mail-action-label-button btn dropdown-toggle svelte-1r4iigx"),t.disabled=n=!l[2].selectedMessages.size,m(t,"aria-expanded",l[3]),m(t,"title",i=l[2].strings.labels),O(t,"btn-secondary",!l[1]),O(t,"btn-light",l[1]),O(t,"disabled",!l[2].selectedMessages.size),m(e,"class","btn-group"),m(e,"role","group"),O(e,"dropup",l[1])},m(_,b){y(_,e,b),g(e,t),g(t,s),g(e,r),u&&u.m(e,null),g(e,o),d&&d.m(e,null),a=!0,f||(c=[W(t,"click",l[7]),je(it.call(null,e,l[6]))],f=!0)},p(_,[b]){(!a||b&4&&n!==(n=!_[2].selectedMessages.size))&&(t.disabled=n),(!a||b&8)&&m(t,"aria-expanded",_[3]),(!a||b&4&&i!==(i=_[2].strings.labels))&&m(t,"title",i),(!a||b&2)&&O(t,"btn-secondary",!_[1]),(!a||b&2)&&O(t,"btn-light",_[1]),(!a||b&4)&&O(t,"disabled",!_[2].selectedMessages.size),_[3]?u?u.p(_,b):(u=Ot(_),u.c(),u.m(e,o)):u&&(u.d(1),u=null),_[2].params.dialog=="createlabel"?d?(d.p(_,b),b&4&&S(d,1)):(d=Vt(_),d.c(),S(d,1),d.m(e,null)):d&&(ne(),z(d,1,1,()=>{d=null}),ie()),(!a||b&2)&&O(e,"dropup",_[1])},i(_){a||(S(d),a=!0)},o(_){z(d),a=!1},d(_){_&&M(e),u&&u.d(),d&&d.d(),f=!1,Me(c)}}}function oi(l,e,t){let s,n,i,r=G,o=()=>(r(),r=_e(a,v=>t(2,i=v)),a);l.$$.on_destroy.push(()=>r());let{store:a}=e;o();let{bottom:f=!1}=e,c=!1,u=new Map;const d=()=>{t(3,c=!1)},_=()=>{t(3,c=!c)},b=v=>{t(12,u=new Map(Array.from(u.entries()).map(([T,A])=>[T,T==v?A=="true"?"false":"true":A])))},p=()=>{t(3,c=!1),a.setLabels(Array.from(u.keys()).filter(v=>u.get(v)=="true"),Array.from(u.keys()).filter(v=>u.get(v)=="false"))},$=()=>{d(),a.showDialog("createlabel")},w=async(v,T)=>{a.hideDialog(),a.createLabel(v,T)},k=v=>b(v.id),C=()=>a.hideDialog();return l.$$set=v=>{"store"in v&&o(t(0,a=v.store)),"bottom"in v&&t(1,f=v.bottom)},l.$$.update=()=>{l.$$.dirty&4&&t(12,u=new Map(i.labels.map(v=>{const T=Array.from(i.selectedMessages.values()).filter(A=>A.labels.some(D=>D.id==v.id));return[v.id,T.length==0?"false":T.length<i.selectedMessages.size?"mixed":"true"]}))),l.$$.dirty&4100&&t(5,s=Array.from(u.entries()).some(([v,T])=>Array.from(i.selectedMessages.values()).some(A=>T=="true"&&A.labels.every(D=>D.id!=v)||T=="false"&&A.labels.some(D=>D.id==v)))),l.$$.dirty&4096&&t(4,n=v=>u.get(v)=="false"?"fa-square-o":u.get(v)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[a,f,i,c,n,s,d,_,b,p,$,w,u,k,C]}class nn extends oe{constructor(e){super(),fe(this,e,oi,ai,re,{store:0,bottom:1})}}function Wt(l){let e;function t(i,r){return i[7].params.tray=="trash"?ui:fi}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),m(e,"class","dropdown-menu show")},m(i,r){y(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&M(e),n.d()}}}function fi(l){let e,t,s,n,i,r=l[5]&&Xt(l),o=l[6]&&Yt(l),a=l[3]&&Qt(l),f=l[4]&&Zt(l),c=l[2]&&xt(l);return{c(){r&&r.c(),e=L(),o&&o.c(),t=L(),a&&a.c(),s=L(),f&&f.c(),n=L(),c&&c.c(),i=ge()},m(u,d){r&&r.m(u,d),y(u,e,d),o&&o.m(u,d),y(u,t,d),a&&a.m(u,d),y(u,s,d),f&&f.m(u,d),y(u,n,d),c&&c.m(u,d),y(u,i,d)},p(u,d){u[5]?r?r.p(u,d):(r=Xt(u),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),u[6]?o?o.p(u,d):(o=Yt(u),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null),u[3]?a?a.p(u,d):(a=Qt(u),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null),u[4]?f?f.p(u,d):(f=Zt(u),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),u[2]?c?c.p(u,d):(c=xt(u),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},d(u){u&&(M(e),M(t),M(s),M(n),M(i)),r&&r.d(u),o&&o.d(u),a&&a.d(u),f&&f.d(u),c&&c.d(u)}}}function ui(l){let e,t=l[7].strings.emptytrash+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[18]),n=!0)},p(r,o){o&128&&t!==(t=r[7].strings.emptytrash+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function Xt(l){let e,t=l[7].strings.markasread+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[21]),n=!0)},p(r,o){o&128&&t!==(t=r[7].strings.markasread+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function Yt(l){let e,t=l[7].strings.markasunread+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[22]),n=!0)},p(r,o){o&128&&t!==(t=r[7].strings.markasunread+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function Qt(l){let e,t=l[7].strings.markasstarred+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[23]),n=!0)},p(r,o){o&128&&t!==(t=r[7].strings.markasstarred+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function Zt(l){let e,t=l[7].strings.markasunstarred+"",s,n,i;return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,o){y(r,e,o),g(e,s),n||(i=W(e,"click",l[24]),n=!0)},p(r,o){o&128&&t!==(t=r[7].strings.markasunstarred+"")&&F(s,t)},d(r){r&&M(e),n=!1,i()}}}function xt(l){let e,t,s=l[7].strings.editlabel+"",n,i,r,o=l[7].strings.deletelabel+"",a,f,c,u=(l[5]||l[6]||l[3]||l[4])&&es();return{c(){u&&u.c(),e=L(),t=h("button"),n=R(s),i=L(),r=h("button"),a=R(o),m(t,"type","button"),m(t,"class","dropdown-item"),m(r,"type","button"),m(r,"class","dropdown-item")},m(d,_){u&&u.m(d,_),y(d,e,_),y(d,t,_),g(t,n),y(d,i,_),y(d,r,_),g(r,a),f||(c=[W(t,"click",l[14]),W(r,"click",l[16])],f=!0)},p(d,_){d[5]||d[6]||d[3]||d[4]?u||(u=es(),u.c(),u.m(e.parentNode,e)):u&&(u.d(1),u=null),_&128&&s!==(s=d[7].strings.editlabel+"")&&F(n,s),_&128&&o!==(o=d[7].strings.deletelabel+"")&&F(a,o)},d(d){d&&(M(e),M(t),M(i),M(r)),u&&u.d(d),f=!1,Me(c)}}}function es(l){let e;return{c(){e=h("div"),m(e,"class","dropdown-divider")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function ci(l){let e,t,s,n;const i=[_i,di],r=[];function o(a,f){return a[7].params.dialog=="editlabel"?0:a[7].params.dialog=="deletelabel"?1:-1}return~(e=o(l))&&(t=r[e]=i[e](l)),{c(){t&&t.c(),s=ge()},m(a,f){~e&&r[e].m(a,f),y(a,s,f),n=!0},p(a,f){let c=e;e=o(a),e===c?~e&&r[e].p(a,f):(t&&(ne(),z(r[c],1,1,()=>{r[c]=null}),ie()),~e?(t=r[e],t?t.p(a,f):(t=r[e]=i[e](a),t.c()),S(t,1),t.m(s.parentNode,s)):t=null)},i(a){n||(S(t),n=!0)},o(a){z(t),n=!1},d(a){a&&M(s),~e&&r[e].d(a)}}}function mi(l){let e,t,s=l[7].params.dialog=="emptytrash"&&ts(l);return{c(){s&&s.c(),e=ge()},m(n,i){s&&s.m(n,i),y(n,e,i),t=!0},p(n,i){n[7].params.dialog=="emptytrash"?s?(s.p(n,i),i&128&&S(s,1)):(s=ts(n),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(S(s),t=!0)},o(n){z(s),t=!1},d(n){n&&M(e),s&&s.d(n)}}}function di(l){let e,t;return e=new Xe({props:{title:l[7].strings.deletelabel,cancelText:l[7].strings.cancel,confirmText:l[7].strings.deletelabel,confirmClass:"btn-danger",onCancel:l[27],onConfirm:l[17],$$slots:{default:[gi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&128&&(i.title=s[7].strings.deletelabel),n&128&&(i.cancelText=s[7].strings.cancel),n&128&&(i.confirmText=s[7].strings.deletelabel),n&1&&(i.onCancel=s[27]),n&268435588&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function _i(l){let e,t;return e=new ln({props:{store:l[0],label:l[2],onCancel:l[26],onSubmit:l[15]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&4&&(i.label=s[2]),n&1&&(i.onCancel=s[26]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function gi(l){let e=Ie(l[7].strings.deletelabelconfirm,l[2].name)+"",t;return{c(){t=R(e)},m(s,n){y(s,t,n)},p(s,n){n&132&&e!==(e=Ie(s[7].strings.deletelabelconfirm,s[2].name)+"")&&F(t,e)},d(s){s&&M(t)}}}function ts(l){let e,t;return e=new Xe({props:{title:l[7].strings.emptytrash,cancelText:l[7].strings.cancel,confirmText:l[7].strings.emptytrash,confirmClass:"btn-danger",onCancel:l[25],onConfirm:l[19],$$slots:{default:[pi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&128&&(i.title=s[7].strings.emptytrash),n&128&&(i.cancelText=s[7].strings.cancel),n&128&&(i.confirmText=s[7].strings.emptytrash),n&1&&(i.onCancel=s[25]),n&268435584&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function pi(l){let e=l[7].strings.emptytrashconfirm+"",t;return{c(){t=R(e)},m(s,n){y(s,t,n)},p(s,n){n&128&&e!==(e=s[7].strings.emptytrashconfirm+"")&&F(t,e)},d(s){s&&M(t)}}}function bi(l){let e,t,s,n,i,r,o,a,f,c,u,d,_=l[8]&&Wt(l);const b=[mi,ci],p=[];function $(w,k){return w[7].params.tray=="trash"?0:w[2]?1:-1}return~(o=$(l))&&(a=p[o]=b[o](l)),{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),_&&_.c(),r=L(),a&&a.c(),f=ge(),m(s,"class","fa fa-fw fa-ellipsis-v"),m(t,"type","button"),m(t,"class","local-mail-action-more-button btn dropdown-toggle svelte-14se2dy"),t.disabled=l[9],m(t,"aria-expanded",l[8]),m(t,"title",n=l[7].strings.more),O(t,"btn-secondary",!l[1]),O(t,"btn-light",l[1]),O(t,"disabled",l[9]),m(e,"class","btn-group"),O(e,"dropup",l[1])},m(w,k){y(w,e,k),g(e,t),g(t,s),g(e,i),_&&_.m(e,null),y(w,r,k),~o&&p[o].m(w,k),y(w,f,k),c=!0,u||(d=[W(t,"click",l[11]),je(it.call(null,e,l[10]))],u=!0)},p(w,[k]){(!c||k&512)&&(t.disabled=w[9]),(!c||k&256)&&m(t,"aria-expanded",w[8]),(!c||k&128&&n!==(n=w[7].strings.more))&&m(t,"title",n),(!c||k&2)&&O(t,"btn-secondary",!w[1]),(!c||k&2)&&O(t,"btn-light",w[1]),(!c||k&512)&&O(t,"disabled",w[9]),w[8]?_?_.p(w,k):(_=Wt(w),_.c(),_.m(e,null)):_&&(_.d(1),_=null),(!c||k&2)&&O(e,"dropup",w[1]);let C=o;o=$(w),o===C?~o&&p[o].p(w,k):(a&&(ne(),z(p[C],1,1,()=>{p[C]=null}),ie()),~o?(a=p[o],a?a.p(w,k):(a=p[o]=b[o](w),a.c()),S(a,1),a.m(f.parentNode,f)):a=null)},i(w){c||(S(a),c=!0)},o(w){z(a),c=!1},d(w){w&&(M(e),M(r),M(f)),_&&_.d(),~o&&p[o].d(w),u=!1,Me(d)}}}function hi(l,e,t){let s,n,i,r,o,a,f,c,u=G,d=()=>(u(),u=_e(_,U=>t(7,c=U)),_);l.$$.on_destroy.push(()=>u());let{store:_}=e;d();let{bottom:b=!1}=e,p=!1;const $=()=>{t(8,p=!1)},w=()=>{t(8,p=!p)},k=U=>{$(),_.setUnread(n.filter(te=>!te.draft).map(te=>te.id),U)},C=U=>{$(),_.setStarred(n.map(te=>te.id),U)},v=()=>{$(),_.showDialog("editlabel")},T=(U,te)=>{_.hideDialog(),s&&_.updateLabel(s.id,U,te)},A=()=>{$(),_.showDialog("deletelabel")},D=()=>{_.hideDialog(),_.deleteLabel(c.params.labelid||0)},N=()=>{$(),_.showDialog("emptytrash")},I=()=>{_.hideDialog(),_.emptyTrash(c.params.courseid)},H=()=>k(!1),P=()=>k(!0),q=()=>C(!0),Z=()=>C(!1),se=()=>_.hideDialog(),X=()=>_.hideDialog(),ee=()=>_.hideDialog();return l.$$set=U=>{"store"in U&&d(t(0,_=U.store)),"bottom"in U&&t(1,b=U.bottom)},l.$$.update=()=>{l.$$.dirty&128&&t(2,s=c.params.tray=="label"&&c.message==null?c.labels.find(U=>U.id==c.params.labelid):null),l.$$.dirty&128&&t(20,n=Array.from(c.selectedMessages.values())),l.$$.dirty&1048576&&t(6,i=n.some(U=>!U.draft&&!U.unread)),l.$$.dirty&1048576&&t(5,r=n.some(U=>!U.draft&&U.unread)),l.$$.dirty&1048576&&t(4,o=n.some(U=>U.starred)),l.$$.dirty&1048576&&t(3,a=n.some(U=>!U.starred)),l.$$.dirty&252&&t(9,f=c.params.tray=="trash"?!c.totalCount:!s&&!i&&!r&&!o&&!a)},[_,b,s,a,o,r,i,c,p,f,$,w,k,C,v,T,A,D,N,I,n,H,P,q,Z,se,X,ee]}class rn extends oe{constructor(e){super(),fe(this,e,hi,bi,re,{store:0,bottom:1})}}function ss(l){let e,t;return{c(){e=h("div"),t=R(l[3]),m(e,"class","align-self-center text-nowrap")},m(s,n){y(s,e,n),g(e,t)},p(s,n){n&8&&F(t,s[3])},d(s){s&&M(e)}}}function ls(l){let e,t;return{c(){e=h("div"),t=R(l[3]),m(e,"class","text-truncate align-self-center flex-shrink-1 mx-2"),he(e,"min-width","0")},m(s,n){y(s,e,n),g(e,t)},p(s,n){n&8&&F(t,s[3])},d(s){s&&M(e)}}}function vi(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p,$,w,k=!l[1]&&ss(l),C=l[1]&&ls(l);return{c(){e=h("div"),k&&k.c(),t=L(),s=h("div"),n=h("button"),i=h("i"),f=L(),C&&C.c(),c=L(),u=h("button"),d=h("i"),m(i,"class","fa fa-fw fa-chevron-left"),m(i,"aria-label",r=l[2].strings.previouspage),m(n,"type","button"),m(n,"class","btn btn-secondary"),n.disabled=o=!l[4],m(n,"title",a=l[2].strings[l[2].message?"previousmessage":"previouspage"]),O(n,"btn-secondary",!l[1]),O(n,"btn-light",l[1]),m(d,"class","fa fa-fw fa-chevron-right"),m(d,"aria-label",_=l[2].strings.nextpage),m(u,"type","button"),m(u,"class","btn"),u.disabled=b=!l[5],m(u,"title",p=l[2].strings[l[2].message?"nextmessage":"nextpage"]),O(u,"btn-secondary",!l[1]),O(u,"btn-light",l[1]),m(s,"class","btn-group d-flex"),m(s,"role","group"),he(s,"min-width","0"),O(s,"btn-group",!l[1]),m(e,"class","local-mail-paging-buttons d-flex svelte-nbwrye"),O(e,"ml-auto",!l[1])},m(v,T){y(v,e,T),k&&k.m(e,null),g(e,t),g(e,s),g(s,n),g(n,i),g(s,f),C&&C.m(s,null),g(s,c),g(s,u),g(u,d),$||(w=[W(n,"click",Be(l[8])),W(u,"click",Be(l[9]))],$=!0)},p(v,[T]){v[1]?k&&(k.d(1),k=null):k?k.p(v,T):(k=ss(v),k.c(),k.m(e,t)),T&4&&r!==(r=v[2].strings.previouspage)&&m(i,"aria-label",r),T&16&&o!==(o=!v[4])&&(n.disabled=o),T&4&&a!==(a=v[2].strings[v[2].message?"previousmessage":"previouspage"])&&m(n,"title",a),T&2&&O(n,"btn-secondary",!v[1]),T&2&&O(n,"btn-light",v[1]),v[1]?C?C.p(v,T):(C=ls(v),C.c(),C.m(s,c)):C&&(C.d(1),C=null),T&4&&_!==(_=v[2].strings.nextpage)&&m(d,"aria-label",_),T&32&&b!==(b=!v[5])&&(u.disabled=b),T&4&&p!==(p=v[2].strings[v[2].message?"nextmessage":"nextpage"])&&m(u,"title",p),T&2&&O(u,"btn-secondary",!v[1]),T&2&&O(u,"btn-light",v[1]),T&2&&O(s,"btn-group",!v[1]),T&2&&O(e,"ml-auto",!v[1])},i:G,o:G,d(v){v&&M(e),k&&k.d(),C&&C.d(),$=!1,Me(w)}}}function ki(l,e,t){let s,n,i,r,o,a,f=G,c=()=>(f(),f=_e(u,p=>t(2,a=p)),u);l.$$.on_destroy.push(()=>f());let{store:u}=e;c();let{bottom:d=!1}=e;const _=()=>u.navigate(r),b=()=>u.navigate(i);return l.$$set=p=>{"store"in p&&c(t(0,u=p.store)),"bottom"in p&&t(1,d=p.bottom)},l.$$.update=()=>{var p;l.$$.dirty&4&&t(7,s=a.nextMessageId||!a.params.search&&(a.params.offset||0)+a.preferences.perpage<a.totalCount),l.$$.dirty&4&&t(6,n=a.prevMessageId||!a.params.search&&(a.params.offset||0)),l.$$.dirty&132&&t(5,i=s?a.message?{...a.params,messageid:a.nextMessageId,offset:(a.params.offset||0)+1}:{...a.params,messageid:void 0,offset:(a.params.offset||0)+a.preferences.perpage,search:a.params.search?{...a.params.search,startid:(p=a.listMessages[a.listMessages.length-1])==null?void 0:p.id,reverse:!1}:void 0}:void 0),l.$$.dirty&68&&t(4,r=n?a.message?{...a.params,messageid:a.prevMessageId,offset:Math.max(0,(a.params.offset||0)-1)}:{...a.params,messageid:void 0,offset:Math.max(0,(a.params.offset||0)-a.preferences.perpage),search:a.params.search?{...a.params.search,startid:a.listMessages[0].id,reverse:!0}:void 0}:void 0),l.$$.dirty&4&&t(3,o=a.message?a.params.search||a.viewportSize<ae.SM?Fe((a.params.offset||0)+1):Ie(a.strings.pagingsingle,{index:Fe((a.messageOffset||0)+1),total:Fe(a.totalCount)}):a.listMessages.length==0?"":a.params.search||a.viewportSize<ae.SM?Ie(a.strings.pagingrange,{first:Fe((a.params.offset||0)+1),last:Fe((a.params.offset||0)+a.listMessages.length)}):Ie(a.strings.pagingrangetotal,{first:Fe((a.params.offset||0)+1),last:Fe((a.params.offset||0)+a.listMessages.length),total:Fe(a.totalCount)}))},[u,d,a,o,r,i,n,s,_,b]}class an extends oe{constructor(e){super(),fe(this,e,ki,vi,re,{store:0,bottom:1})}}function ns(l){let e,t;return e=new Xe({props:{title:l[2].strings.restore,cancelText:l[2].strings.cancel,confirmText:l[2].strings.restore,onCancel:l[5],onConfirm:l[3],$$slots:{default:[wi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.restore),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.restore),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function wi(l){let e=l[2].strings.restoremessageconfirm+"",t;return{c(){t=R(e)},m(s,n){y(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings.restoremessageconfirm+"")&&F(t,e)},d(s){s&&M(t)}}}function $i(l){let e,t,s,n,i,r,o,a,f,c=l[2].params.dialog=="restore"&&ns(l);return{c(){e=h("button"),t=h("i"),i=L(),c&&c.c(),r=ge(),m(t,"class","fa fa-fw fa-undo"),m(e,"type","button"),m(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,m(e,"title",n=l[2].strings.restore),O(e,"btn-secondary",!l[1]),O(e,"btn-light",l[1])},m(u,d){y(u,e,d),g(e,t),y(u,i,d),c&&c.m(u,d),y(u,r,d),o=!0,a||(f=W(e,"click",l[4]),a=!0)},p(u,[d]){(!o||d&4&&s!==(s=!u[2].selectedMessages.size))&&(e.disabled=s),(!o||d&4&&n!==(n=u[2].strings.restore))&&m(e,"title",n),(!o||d&2)&&O(e,"btn-secondary",!u[1]),(!o||d&2)&&O(e,"btn-light",u[1]),u[2].params.dialog=="restore"?c?(c.p(u,d),d&4&&S(c,1)):(c=ns(u),c.c(),S(c,1),c.m(r.parentNode,r)):c&&(ne(),z(c,1,1,()=>{c=null}),ie())},i(u){o||(S(c),o=!0)},o(u){z(c),o=!1},d(u){u&&(M(e),M(i),M(r)),c&&c.d(u),a=!1,f()}}}function yi(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,u=>t(2,s=u)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{bottom:o=!1}=e;const a=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Ke.NotDeleted,!0)},f=()=>r.showDialog("restore"),c=()=>r.hideDialog();return l.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"bottom"in u&&t(1,o=u.bottom)},[r,o,s,a,f,c]}class on extends oe{constructor(e){super(),fe(this,e,yi,$i,re,{store:0,bottom:1})}}function Mi(l){let e,t,s,n;return e=new nn({props:{store:l[0],bottom:!0}}),s=new tn({props:{store:l[0],bottom:!0}}),{c(){J(e.$$.fragment),t=L(),J(s.$$.fragment)},m(i,r){K(e,i,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(S(e.$$.fragment,i),S(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(e,i),V(s,i)}}}function Ci(l){let e,t,s,n;return e=new on({props:{store:l[0],bottom:!0}}),s=new sn({props:{store:l[0],bottom:!0}}),{c(){J(e.$$.fragment),t=L(),J(s.$$.fragment)},m(i,r){K(e,i,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(S(e.$$.fragment,i),S(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(e,i),V(s,i)}}}function Si(l){let e,t,s,n,i,r,o,a,f;const c=[Ci,Mi],u=[];function d(_,b){return _[1].params.tray=="trash"?0:1}return s=d(l),n=u[s]=c[s](l),r=new rn({props:{store:l[0],bottom:!0}}),a=new an({props:{store:l[0],bottom:!0}}),{c(){e=h("div"),t=h("div"),n.c(),i=L(),J(r.$$.fragment),o=L(),J(a.$$.fragment),m(t,"class","d-flex justify-content-around"),m(t,"role","group"),m(e,"role","toolbar"),m(e,"class","local-mail-toolbar px-2 py-3 bg-light border-top border-bottom svelte-1938vm6")},m(_,b){y(_,e,b),g(e,t),u[s].m(t,null),g(t,i),K(r,t,null),g(t,o),K(a,t,null),f=!0},p(_,[b]){let p=s;s=d(_),s===p?u[s].p(_,b):(ne(),z(u[p],1,1,()=>{u[p]=null}),ie(),n=u[s],n?n.p(_,b):(n=u[s]=c[s](_),n.c()),S(n,1),n.m(t,i));const $={};b&1&&($.store=_[0]),r.$set($);const w={};b&1&&(w.store=_[0]),a.$set(w)},i(_){f||(S(n),S(r.$$.fragment,_),S(a.$$.fragment,_),f=!0)},o(_){z(n),z(r.$$.fragment,_),z(a.$$.fragment,_),f=!1},d(_){_&&M(e),u[s].d(),V(r),V(a)}}}function Di(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;return i(),l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s]}class Ti extends oe{constructor(e){super(),fe(this,e,Di,Si,re,{store:0})}}function fn(l,{from:e,to:t},s={}){const n=getComputedStyle(l),i=n.transform==="none"?"":n.transform,[r,o]=n.transformOrigin.split(" ").map(parseFloat),a=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*o/t.height-(t.top+o),{delay:c=0,duration:u=_=>Math.sqrt(_)*120,easing:d=en}=s;return{delay:c,duration:De(u)?u(Math.sqrt(a*a+f*f)):u,easing:d,css:(_,b)=>{const p=b*a,$=b*f,w=_+b*e.width/t.width,k=_+b*e.height/t.height;return`transform: ${i} translate(${p}px, ${$}px) scale(${w}, ${k});`}}}function Li(l){let e,t,s,n,i,r,o;return{c(){e=h("button"),t=h("i"),m(t,"class",s="fa align-middle "+l[3]),m(e,"type","button"),m(e,"class","btn px-2"),m(e,"role","checkbox"),m(e,"aria-checked",n=!!l[2].selectedMessages.has(l[1].id)),m(e,"title",i=l[2].strings.select)},m(a,f){y(a,e,f),g(e,t),r||(o=W(e,"click",Hl(Be(l[4]))),r=!0)},p(a,[f]){f&8&&s!==(s="fa align-middle "+a[3])&&m(t,"class",s),f&6&&n!==(n=!!a[2].selectedMessages.has(a[1].id))&&m(e,"aria-checked",n),f&4&&i!==(i=a[2].strings.select)&&m(e,"title",i)},i:G,o:G,d(a){a&&M(e),r=!1,o()}}}function zi(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,c=>t(2,n=c)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;const f=()=>o.toggleSelected(a.id);return l.$$set=c=>{"store"in c&&r(t(0,o=c.store)),"message"in c&&t(1,a=c.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=n.selectedMessages.has(a.id)?"fa-check-square-o":"fa-square-o")},[o,a,n,s,f]}class un extends oe{constructor(e){super(),fe(this,e,zi,Li,re,{store:0,message:1})}}function ji(l){let e,t,s,n,i,r,o,a;return{c(){e=h("button"),t=h("i"),m(t,"class",s="fa "+l[2]),m(e,"type","button"),m(e,"class","btn px-2"),m(e,"role","checkbox"),m(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,m(e,"title",r=l[1].deleted?l[3].strings[l[1].starred?"starred":"unstarred"]:l[3].strings[l[1].starred?"markasunstarred":"markasstarred"])},m(f,c){y(f,e,c),g(e,t),o||(a=W(e,"click",Hl(Be(l[4]))),o=!0)},p(f,[c]){c&4&&s!==(s="fa "+f[2])&&m(t,"class",s),c&2&&n!==(n=f[1].starred)&&m(e,"aria-checked",n),c&2&&i!==(i=f[1].deleted)&&(e.disabled=i),c&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&m(e,"title",r)},i:G,o:G,d(f){f&&M(e),o=!1,a()}}}function Ni(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,c=>t(3,n=c)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;const f=()=>o.setStarred([a.id],!a.starred);return l.$$set=c=>{"store"in c&&r(t(0,o=c.store)),"message"in c&&t(1,a=c.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=a.starred?"fa-star text-warning":"fa-star-o")},[o,a,s,n,f]}class cn extends oe{constructor(e){super(),fe(this,e,Ni,ji,re,{store:0,message:1})}}function Ii(l){let e,t=l[1].join(", ")+"",s,n,i,r;return{c(){e=h("div"),s=R(t)},m(o,a){y(o,e,a),g(e,s),i||(r=je(n=Ve.call(null,e,l[1].join(`
`))),i=!0)},p(o,[a]){a&2&&t!==(t=o[1].join(", ")+"")&&F(s,t),n&&De(n.update)&&a&2&&n.update.call(null,o[1].join(`
`))},i:G,o:G,d(o){o&&M(e),i=!1,r()}}}function Ai(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,f=>t(3,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(2,a=f.message)},l.$$.update=()=>{l.$$.dirty&12&&t(1,s=n.params.tray=="sent"||n.params.tray=="drafts"?a.recipients.length>0?a.recipients.map(f=>f.fullname):[n.strings.norecipient]:[a.sender.fullname])},[o,s,a,n]}class wt extends oe{constructor(e){super(),fe(this,e,Ai,Ii,re,{store:0,message:2})}}function is(l){let e,t=l[2].strings.draft+"",s;return{c(){e=h("span"),s=R(t),m(e,"class","mr-2 text-danger")},m(n,i){y(n,e,i),g(e,s)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&F(s,t)},d(n){n&&M(e)}}}function Bi(l){let e,t,s=(l[1].subject||l[2].strings.nosubject)+"",n,i,r,o,a=l[1].draft&&is(l);return{c(){e=h("div"),a&&a.c(),t=L(),n=R(s)},m(f,c){y(f,e,c),a&&a.m(e,null),g(e,t),g(e,n),r||(o=je(i=Ve.call(null,e,l[1].subject||l[2].strings.nosubject)),r=!0)},p(f,[c]){f[1].draft?a?a.p(f,c):(a=is(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null),c&6&&s!==(s=(f[1].subject||f[2].strings.nosubject)+"")&&F(n,s),i&&De(i.update)&&c&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:G,o:G,d(f){f&&M(e),a&&a.d(),r=!1,o()}}}function qi(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class $t extends oe{constructor(e){super(),fe(this,e,qi,Bi,re,{store:0,message:1})}}function rs(l){let e,t,s,n,i;return{c(){e=h("span"),t=R(l[2]),m(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2 svelte-zl9zhm"),he(e,"min-width","3rem"),he(e,"max-width","calc("+l[1]+"ch + 1.5rem)")},m(r,o){y(r,e,o),g(e,t),n||(i=je(s=Ve.call(null,e,l[2])),n=!0)},p(r,o){o&4&&F(t,r[2]),o&2&&he(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),s&&De(s.update)&&o&4&&s.update.call(null,r[2])},d(r){r&&M(e),n=!1,i()}}}function Pi(l){let e=["shortname","fullname"].includes(l[0].coursebadges),t,s=e&&rs(l);return{c(){s&&s.c(),t=ge()},m(n,i){s&&s.m(n,i),y(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?s?s.p(n,i):(s=rs(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:G,o:G,d(n){n&&M(t),s&&s.d(n)}}}function Ei(l,e,t){let s,n,{course:i}=e,{settings:r}=e;return l.$$set=o=>{"course"in o&&t(3,i=o.course),"settings"in o&&t(0,r=o.settings)},l.$$.update=()=>{l.$$.dirty&9&&t(2,s=et(i,r.coursebadges)),l.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,s,i]}class yt extends oe{constructor(e){super(),fe(this,e,Ei,Pi,re,{course:3,settings:0})}}function Ri(l){let e,t=l[0].name+"",s,n;return{c(){e=h("span"),s=R(t),m(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2 svelte-1xmrn49"),m(e,"style",n=`color: var(--local-mail-color-${l[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${l[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){y(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&F(s,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&m(e,"style",n)},i:G,o:G,d(i){i&&M(e)}}}function Fi(l,e,t){let s,{label:n}=e;return l.$$set=i=>{"label"in i&&t(0,n=i.label)},l.$$.update=()=>{l.$$.dirty&1&&t(1,s=ut.includes(n.color)?n.color:"gray")},[n,s]}class Mt extends oe{constructor(e){super(),fe(this,e,Fi,Ri,re,{label:0})}}function as(l,e,t){const s=l.slice();return s[3]=e[t],s}function os(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&fs(l);return{c(){s&&s.c(),e=ge()},m(n,i){s&&s.m(n,i),y(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&S(s,1)):(s=fs(n),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(S(s),t=!0)},o(n){z(s),t=!1},d(n){n&&M(e),s&&s.d(n)}}}function fs(l){let e,t;return e=new yt({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function us(l){let e,t;return e=new Mt({props:{label:l[3]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.label=s[3]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function cs(l,e){let t,s,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&us(e);return{key:l,first:null,c(){t=ge(),i&&i.c(),s=ge(),this.first=t},m(r,o){y(r,t,o),i&&i.m(r,o),y(r,s,o),n=!0},p(r,o){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,o),o&6&&S(i,1)):(i=us(e),i.c(),S(i,1),i.m(s.parentNode,s)):i&&(ne(),z(i,1,1,()=>{i=null}),ie())},i(r){n||(S(i),n=!0)},o(r){z(i),n=!1},d(r){r&&(M(t),M(s)),i&&i.d(r)}}}function ms(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&ds(l);return{c(){s&&s.c(),e=ge()},m(n,i){s&&s.m(n,i),y(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&S(s,1)):(s=ds(n),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(S(s),t=!0)},o(n){z(s),t=!1},d(n){n&&M(e),s&&s.d(n)}}}function ds(l){let e,t;return e=new yt({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Gi(l){let e,t=[],s=new Map,n,i,r,o=l[2].viewportSize<ae.MD&&os(l),a=ue(l[1].labels);const f=u=>u[3].id;for(let u=0;u<a.length;u+=1){let d=as(l,a,u),_=f(d);s.set(_,t[u]=cs(_,d))}let c=l[2].viewportSize>=ae.MD&&ms(l);return{c(){o&&o.c(),e=L();for(let u=0;u<t.length;u+=1)t[u].c();n=L(),c&&c.c(),i=ge()},m(u,d){o&&o.m(u,d),y(u,e,d);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(u,d);y(u,n,d),c&&c.m(u,d),y(u,i,d),r=!0},p(u,[d]){u[2].viewportSize<ae.MD?o?(o.p(u,d),d&4&&S(o,1)):(o=os(u),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(ne(),z(o,1,1,()=>{o=null}),ie()),d&6&&(a=ue(u[1].labels),ne(),t=ze(t,d,f,1,u,a,s,n.parentNode,We,cs,n,as),ie()),u[2].viewportSize>=ae.MD?c?(c.p(u,d),d&4&&S(c,1)):(c=ms(u),c.c(),S(c,1),c.m(i.parentNode,i)):c&&(ne(),z(c,1,1,()=>{c=null}),ie())},i(u){if(!r){S(o);for(let d=0;d<a.length;d+=1)S(t[d]);S(c),r=!0}},o(u){z(o);for(let d=0;d<t.length;d+=1)z(t[d]);z(c),r=!1},d(u){u&&(M(e),M(n),M(i)),o&&o.d(u);for(let d=0;d<t.length;d+=1)t[d].d(u);c&&c.d(u)}}}function Ui(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class mn extends oe{constructor(e){super(),fe(this,e,Ui,Gi,re,{store:0,message:1})}}function _s(l){let e,t,s,n,i;return{c(){e=h("span"),t=h("i"),m(t,"class",s="fa fa-fw "+(l[1].numattachments>0?"fa-paperclip":"")),m(t,"aria-hidden",!0),m(e,"class","-shrink-0 mr-2"),m(e,"aria-hidden",n=l[1].numattachments==0),m(e,"title",i=l[1].numattachments>0?l[2].strings.hasattachments:void 0)},m(r,o){y(r,e,o),g(e,t)},p(r,o){o&2&&s!==(s="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&m(t,"class",s),o&2&&n!==(n=r[1].numattachments==0)&&m(e,"aria-hidden",n),o&6&&i!==(i=r[1].numattachments>0?r[2].strings.hasattachments:void 0)&&m(e,"title",i)},d(r){r&&M(e)}}}function Hi(l){let e,t=(l[1].numattachments>0||l[2].viewportSize>=ae.MD)&&_s(l);return{c(){t&&t.c(),e=ge()},m(s,n){t&&t.m(s,n),y(s,e,n)},p(s,[n]){s[1].numattachments>0||s[2].viewportSize>=ae.MD?t?t.p(s,n):(t=_s(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(s){s&&M(e),t&&t.d(s)}}}function Oi(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class dn extends oe{constructor(e){super(),fe(this,e,Oi,Hi,re,{store:0,message:1})}}function Ji(l){let e,t=l[0].shorttime+"",s,n;return{c(){e=h("span"),s=R(t),m(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right svelte-phmq8k"),m(e,"title",n=l[0].fulltime),O(e,"local-mail-list-message-time-md",l[2].viewportSize>=ae.MD)},m(i,r){y(i,e,r),g(e,s)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&F(s,t),r&1&&n!==(n=i[0].fulltime)&&m(e,"title",n),r&4&&O(e,"local-mail-list-message-time-md",i[2].viewportSize>=ae.MD)},i:G,o:G,d(i){i&&M(e)}}}function Ki(l,e,t){let s,n=G,i=()=>(n(),n=_e(o,a=>t(2,s=a)),o);l.$$.on_destroy.push(()=>n());let{message:r}=e,{store:o}=e;return i(),l.$$set=a=>{"message"in a&&t(0,r=a.message),"store"in a&&i(t(1,o=a.store))},[r,o,s]}class _n extends oe{constructor(e){super(),fe(this,e,Ki,Ji,re,{message:0,store:1})}}function gs(l){let e,t,s=l[1].strings.nomessagesfound+"",n,i,r,o=l[1].totalCount>0&&ps(l);return{c(){e=h("div"),t=h("div"),n=R(s),i=L(),o&&o.c(),m(e,"class","alert alert-info")},m(a,f){y(a,e,f),g(e,t),g(t,n),g(e,i),o&&o.m(e,null)},p(a,f){f&2&&s!==(s=a[1].strings.nomessagesfound+"")&&F(n,s),a[1].totalCount>0?o?o.p(a,f):(o=ps(a),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(a){a&&(r||Ae(()=>{r=vt(e,Pe,{delay:400}),r.start()}))},o:G,d(a){a&&M(e),o&&o.d()}}}function ps(l){let e,t=l[1].strings.showrecentmessages+"",s,n,i,r;return{c(){e=h("a"),s=R(t),m(e,"class","btn btn-info text-white mt-3"),m(e,"href",n=Oe(l[2]))},m(o,a){y(o,e,a),g(e,s),i||(r=W(e,"click",Be(l[3])),i=!0)},p(o,a){a&2&&t!==(t=o[1].strings.showrecentmessages+"")&&F(s,t),a&4&&n!==(n=Oe(o[2]))&&m(e,"href",n)},d(o){o&&M(e),i=!1,r()}}}function Vi(l){let e,t=!l[1].listMessages.length&&gs(l);return{c(){t&&t.c(),e=ge()},m(s,n){t&&t.m(s,n),y(s,e,n)},p(s,[n]){s[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(s,n),n&2&&S(t,1)):(t=gs(s),t.c(),S(t,1),t.m(e.parentNode,e))},i(s){S(t)},o:G,d(s){s&&M(e),t&&t.d(s)}}}function Wi(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,f=>t(1,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();const a=()=>o.navigate(s);return l.$$set=f=>{"store"in f&&r(t(0,o=f.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[o,n,s,a]}class Xi extends oe{constructor(e){super(),fe(this,e,Wi,Vi,re,{store:0})}}function bs(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}function Yi(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p,$,w,k,C,v,T;return t=new un({props:{store:l[0],message:l[4]}}),r=new wt({props:{store:l[0],message:l[4]}}),a=new dn({props:{store:l[0],message:l[4]}}),u=new _n({props:{store:l[0],message:l[4]}}),p=new $t({props:{store:l[0],message:l[4]}}),w=new cn({props:{store:l[0],message:l[4]}}),v=new mn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),J(t.$$.fragment),s=L(),n=h("div"),i=h("div"),J(r.$$.fragment),o=L(),J(a.$$.fragment),f=L(),c=h("div"),J(u.$$.fragment),d=L(),_=h("div"),b=h("div"),J(p.$$.fragment),$=L(),J(w.$$.fragment),k=L(),C=h("div"),J(v.$$.fragment),m(c,"class","ml-auto mr-2"),m(i,"class","d-flex mt-2"),m(b,"class","d-flex w-100 my-2 mr-2"),he(b,"min-width","0"),m(_,"class","d-flex"),m(C,"class","d-flex flex-wrap ml-n2 mr-2"),m(n,"class","w-100 ml-1"),he(n,"min-width","0"),m(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(A,D){y(A,e,D),K(t,e,null),g(e,s),g(e,n),g(n,i),K(r,i,null),g(i,o),K(a,i,null),g(i,f),g(i,c),K(u,c,null),g(n,d),g(n,_),g(_,b),K(p,b,null),g(_,$),K(w,_,null),g(n,k),g(n,C),K(v,C,null),T=!0},p(A,D){const N={};D&1&&(N.store=A[0]),D&2&&(N.message=A[4]),t.$set(N);const I={};D&1&&(I.store=A[0]),D&2&&(I.message=A[4]),r.$set(I);const H={};D&1&&(H.store=A[0]),D&2&&(H.message=A[4]),a.$set(H);const P={};D&1&&(P.store=A[0]),D&2&&(P.message=A[4]),u.$set(P);const q={};D&1&&(q.store=A[0]),D&2&&(q.message=A[4]),p.$set(q);const Z={};D&1&&(Z.store=A[0]),D&2&&(Z.message=A[4]),w.$set(Z);const se={};D&1&&(se.store=A[0]),D&2&&(se.message=A[4]),v.$set(se)},i(A){T||(S(t.$$.fragment,A),S(r.$$.fragment,A),S(a.$$.fragment,A),S(u.$$.fragment,A),S(p.$$.fragment,A),S(w.$$.fragment,A),S(v.$$.fragment,A),T=!0)},o(A){z(t.$$.fragment,A),z(r.$$.fragment,A),z(a.$$.fragment,A),z(u.$$.fragment,A),z(p.$$.fragment,A),z(w.$$.fragment,A),z(v.$$.fragment,A),T=!1},d(A){A&&M(e),V(t),V(r),V(a),V(u),V(p),V(w),V(v)}}}function Qi(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p,$,w,k,C;return t=new un({props:{store:l[0],message:l[4]}}),n=new cn({props:{store:l[0],message:l[4]}}),a=new wt({props:{store:l[0],message:l[4]}}),u=new $t({props:{store:l[0],message:l[4]}}),b=new mn({props:{store:l[0],message:l[4]}}),$=new dn({props:{store:l[0],message:l[4]}}),k=new _n({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),J(t.$$.fragment),s=L(),J(n.$$.fragment),i=L(),r=h("div"),o=h("div"),J(a.$$.fragment),f=L(),c=h("div"),J(u.$$.fragment),d=L(),_=h("div"),J(b.$$.fragment),p=L(),J($.$$.fragment),w=L(),J(k.$$.fragment),m(o,"class","flex-grow-1 mx-2"),he(o,"width","25%"),he(o,"min-width","0"),m(_,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),he(_,"max-width","80%"),m(c,"class","flex-grow-1 d-flex my-2 mx-2"),he(c,"width","75%"),he(c,"min-width","0"),m(r,"class","d-flex w-100 flex-grow-1 align-items-center"),he(r,"min-width","0"),m(e,"class","d-flex align-items-center pl-1 pr-3")},m(v,T){y(v,e,T),K(t,e,null),g(e,s),K(n,e,null),g(e,i),g(e,r),g(r,o),K(a,o,null),g(r,f),g(r,c),K(u,c,null),g(c,d),g(c,_),K(b,_,null),g(e,p),K($,e,null),g(e,w),K(k,e,null),C=!0},p(v,T){const A={};T&1&&(A.store=v[0]),T&2&&(A.message=v[4]),t.$set(A);const D={};T&1&&(D.store=v[0]),T&2&&(D.message=v[4]),n.$set(D);const N={};T&1&&(N.store=v[0]),T&2&&(N.message=v[4]),a.$set(N);const I={};T&1&&(I.store=v[0]),T&2&&(I.message=v[4]),u.$set(I);const H={};T&1&&(H.store=v[0]),T&2&&(H.message=v[4]),b.$set(H);const P={};T&1&&(P.store=v[0]),T&2&&(P.message=v[4]),$.$set(P);const q={};T&1&&(q.store=v[0]),T&2&&(q.message=v[4]),k.$set(q)},i(v){C||(S(t.$$.fragment,v),S(n.$$.fragment,v),S(a.$$.fragment,v),S(u.$$.fragment,v),S(b.$$.fragment,v),S($.$$.fragment,v),S(k.$$.fragment,v),C=!0)},o(v){z(t.$$.fragment,v),z(n.$$.fragment,v),z(a.$$.fragment,v),z(u.$$.fragment,v),z(b.$$.fragment,v),z($.$$.fragment,v),z(k.$$.fragment,v),C=!1},d(v){v&&M(e),V(t),V(n),V(a),V(u),V(b),V($),V(k)}}}function hs(l,e){let t,s,n,i,r,o,a,f=G,c,u,d;const _=[Qi,Yi],b=[];function p(w,k){return w[1].viewportSize>=ae.MD?0:1}s=p(e),n=b[s]=_[s](e);function $(){return e[3](e[4],e[6])}return{key:l,first:null,c(){t=h("a"),n.c(),m(t,"class","local-mail-list-message list-group-item list-group-item-action p-0 svelte-1wmukfr"),m(t,"href",i=Oe(e[2](e[4],e[6]))),O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),O(t,"font-weight-bold",e[4].unread),this.first=t},m(w,k){y(w,t,k),b[s].m(t,null),c=!0,u||(d=W(t,"click",Be($)),u=!0)},p(w,k){e=w;let C=s;s=p(e),s===C?b[s].p(e,k):(ne(),z(b[C],1,1,()=>{b[C]=null}),ie(),n=b[s],n?n.p(e,k):(n=b[s]=_[s](e),n.c()),S(n,1),n.m(t,null)),(!c||k&2&&i!==(i=Oe(e[2](e[4],e[6]))))&&m(t,"href",i),(!c||k&2)&&O(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!c||k&2)&&O(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!c||k&2)&&O(t,"font-weight-bold",e[4].unread)},r(){a=t.getBoundingClientRect()},f(){Zl(t),f(),kt(t,a)},a(){f(),f=Ql(t,a,fn,{delay:400,duration:400})},i(w){c||(S(n),w&&Ae(()=>{c&&(o&&o.end(1),r=vt(t,Pe,{delay:400}),r.start())}),c=!0)},o(w){z(n),r&&r.invalidate(),w&&(o=Jl(t,Pe,{duration:400})),c=!1},d(w){w&&M(t),b[s].d(),w&&o&&o.end(),u=!1,d()}}}function vs(l){let e,t=[],s=new Map,n,i,r,o=ue(l[1].listMessages);const a=f=>f[4].id;for(let f=0;f<o.length;f+=1){let c=bs(l,o,f),u=a(c);s.set(u,t[f]=hs(u,c))}return i=new Xi({props:{store:l[0]}}),{c(){e=h("div");for(let f=0;f<t.length;f+=1)t[f].c();n=L(),J(i.$$.fragment),m(e,"class","list-group")},m(f,c){y(f,e,c);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);g(e,n),K(i,e,null),r=!0},p(f,c){if(c&7){o=ue(f[1].listMessages),ne();for(let d=0;d<t.length;d+=1)t[d].r();t=ze(t,c,a,1,f,o,s,e,Ol,hs,n,bs);for(let d=0;d<t.length;d+=1)t[d].a();ie()}const u={};c&1&&(u.store=f[0]),i.$set(u)},i(f){if(!r){for(let c=0;c<o.length;c+=1)S(t[c]);S(i.$$.fragment,f),r=!0}},o(f){for(let c=0;c<t.length;c+=1)z(t[c]);z(i.$$.fragment,f),r=!1},d(f){f&&M(e);for(let c=0;c<t.length;c+=1)t[c].d();V(i)}}}function Zi(l){let e=l[1].navigationId,t,s,n=vs(l);return{c(){n.c(),t=ge()},m(i,r){n.m(i,r),y(i,t,r),s=!0},p(i,[r]){r&2&&re(e,e=i[1].navigationId)?(ne(),z(n,1,1,G),ie(),n=vs(i),n.c(),S(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){s||(S(n),s=!0)},o(i){z(n),s=!1},d(i){i&&M(t),n.d(i)}}}function xi(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=(f,c)=>({...s.params,messageid:f.id,offset:(s.params.offset||0)+c}),a=(f,c)=>r.navigate(o(f,c));return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,o,a]}class er extends oe{constructor(e){super(),fe(this,e,xi,Zi,re,{store:0})}}function tr(l,e,t){let{javascript:s}=e,n;const i=async r=>{const o=await _t("core/fragment");n==null||n.remove(),n=void 0,await nt(),n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.innerHTML=o.processCollectedJavascript(r),document.head.append(n)};return ht(()=>{n==null||n.remove()}),l.$$set=r=>{"javascript"in r&&t(0,s=r.javascript)},l.$$.update=()=>{l.$$.dirty&1&&i(s||"")},[s]}class gn extends oe{constructor(e){super(),fe(this,e,tr,null,re,{javascript:0})}}function ks(l){let e,t,s,n,i,r,o,a=l[3]&&ws(l);return{c(){e=h("div"),t=h("button"),s=h("i"),i=L(),a&&a.c(),m(s,"class","fa fa-fw fa-ellipsis-v align-middle"),m(t,"type","button"),m(t,"class","btn"),m(t,"aria-expanded",l[3]),m(t,"title",n=l[5].strings.more),m(e,"class","dropdown")},m(f,c){y(f,e,c),g(e,t),g(t,s),g(e,i),a&&a.m(e,null),r||(o=[W(t,"click",l[6]),je(it.call(null,e,l[7]))],r=!0)},p(f,c){c&8&&m(t,"aria-expanded",f[3]),c&32&&n!==(n=f[5].strings.more)&&m(t,"title",n),f[3]?a?a.p(f,c):(a=ws(f),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(f){f&&M(e),a&&a.d(),r=!1,Me(o)}}}function ws(l){let e,t,s,n,i=l[5].strings.reply+"",r,o,a,f,c,u=l[5].strings.replyall+"",d,_,b,p,$,w,k=l[5].strings.forward+"",C,v,T;return{c(){e=h("div"),t=h("button"),s=h("i"),n=L(),r=R(i),o=L(),a=h("button"),f=h("i"),c=L(),d=R(u),b=L(),p=h("button"),$=h("i"),w=L(),C=R(k),m(s,"class","fa fa-fw fa-reply"),m(s,"aria-hidden","true"),m(t,"type","button"),m(t,"class","dropdown-item"),m(f,"class","fa fa-fw fa-reply-all"),m(f,"aria-hidden","true"),m(a,"type","button"),a.disabled=_=!l[2],m(a,"class","dropdown-item"),O(a,"disabled",!l[2]),m($,"class","fa fa-fw fa-share"),m($,"aria-hidden","true"),m(p,"type","button"),m(p,"class","dropdown-item"),m(e,"class","dropdown-menu dropdown-menu-right show")},m(A,D){y(A,e,D),g(e,t),g(t,s),g(t,n),g(t,r),g(e,o),g(e,a),g(a,f),g(a,c),g(a,d),g(e,b),g(e,p),g(p,$),g(p,w),g(p,C),v||(T=[W(t,"click",l[9]),W(a,"click",l[10]),W(p,"click",l[11])],v=!0)},p(A,D){D&32&&i!==(i=A[5].strings.reply+"")&&F(r,i),D&32&&u!==(u=A[5].strings.replyall+"")&&F(d,u),D&4&&_!==(_=!A[2])&&(a.disabled=_),D&4&&O(a,"disabled",!A[2]),D&32&&k!==(k=A[5].strings.forward+"")&&F(C,k)},d(A){A&&M(e),v=!1,Me(T)}}}function $s(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b;return{c(){e=h("button"),t=h("i"),n=L(),i=h("button"),r=h("i"),f=L(),c=h("button"),u=h("i"),m(t,"class","fa fa-fw fa-reply"),m(t,"aria-hidden","true"),m(e,"type","button"),m(e,"title",s=l[5].strings.reply),m(e,"class","btn py-2 border-0"),m(r,"class","fa fa-fw fa-reply-all"),m(r,"aria-hidden","true"),m(i,"type","button"),i.disabled=o=!l[2],m(i,"title",a=l[5].strings.replyall),m(i,"class","btn py-2 border-0"),O(i,"disabled",!l[2]),m(u,"class","fa fa-fw fa-share"),m(u,"aria-hidden","true"),m(c,"type","button"),m(c,"title",d=l[5].strings.forward),m(c,"class","btn py-2 border-0")},m(p,$){y(p,e,$),g(e,t),y(p,n,$),y(p,i,$),g(i,r),y(p,f,$),y(p,c,$),g(c,u),_||(b=[W(e,"click",l[12]),W(i,"click",l[13]),W(c,"click",l[14])],_=!0)},p(p,$){$&32&&s!==(s=p[5].strings.reply)&&m(e,"title",s),$&4&&o!==(o=!p[2])&&(i.disabled=o),$&32&&a!==(a=p[5].strings.replyall)&&m(i,"title",a),$&4&&O(i,"disabled",!p[2]),$&32&&d!==(d=p[5].strings.forward)&&m(c,"title",d)},d(p){p&&(M(e),M(n),M(i),M(f),M(c)),_=!1,Me(b)}}}function sr(l){let e,t,s,n,i,r,o,a,f,c,u,d=l[5].viewportSize<ae.SM&&ks(l),_=l[5].viewportSize>=ae.SM&&$s(l);return{c(){e=h("button"),t=h("i"),o=L(),d&&d.c(),a=L(),_&&_.c(),f=ge(),m(t,"class",s="fa "+l[4]),m(e,"type","button"),m(e,"class","btn py-2 border-0"),m(e,"role","checkbox"),m(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,m(e,"title",r=l[1].starred?l[5].strings.markasunstarred:l[5].strings.markasstarred)},m(b,p){y(b,e,p),g(e,t),y(b,o,p),d&&d.m(b,p),y(b,a,p),_&&_.m(b,p),y(b,f,p),c||(u=W(e,"click",l[8]),c=!0)},p(b,[p]){p&16&&s!==(s="fa "+b[4])&&m(t,"class",s),p&2&&n!==(n=b[1].starred)&&m(e,"aria-checked",n),p&2&&i!==(i=b[1].deleted)&&(e.disabled=i),p&34&&r!==(r=b[1].starred?b[5].strings.markasunstarred:b[5].strings.markasstarred)&&m(e,"title",r),b[5].viewportSize<ae.SM?d?d.p(b,p):(d=ks(b),d.c(),d.m(a.parentNode,a)):d&&(d.d(1),d=null),b[5].viewportSize>=ae.SM?_?_.p(b,p):(_=$s(b),_.c(),_.m(f.parentNode,f)):_&&(_.d(1),_=null)},i:G,o:G,d(b){b&&(M(e),M(o),M(a),M(f)),d&&d.d(b),_&&_.d(b),c=!1,u()}}}function lr(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,v=>t(5,n=v)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e,{canReplyAll:f}=e,c=!1;const u=()=>{t(3,c=!c)},d=()=>{t(3,c=!1)},_=()=>o.setStarred([a.id],!a.starred),b=()=>o.reply(a,!1),p=()=>o.reply(a,!0),$=()=>o.forward(a),w=()=>o.reply(a,!1),k=()=>o.reply(a,!0),C=()=>o.forward(a);return l.$$set=v=>{"store"in v&&r(t(0,o=v.store)),"message"in v&&t(1,a=v.message),"canReplyAll"in v&&t(2,f=v.canReplyAll)},l.$$.update=()=>{l.$$.dirty&2&&t(4,s=a.starred?"fa-star text-warning":"fa-star-o")},[o,a,f,c,s,n,u,d,_,b,p,$,w,k,C]}class nr extends oe{constructor(e){super(),fe(this,e,lr,sr,re,{store:0,message:1,canReplyAll:2})}}function ys(l,e,t){const s=l.slice();return s[3]=e[t],s}function Ms(l){let e,t,s,n,i,r,o,a,f,c=l[2](l[3])+"",u,d,_,b,p=zt(l[3].filesize)+"",$,w,k,C;return{c(){e=h("a"),t=h("img"),i=L(),r=h("i"),o=L(),a=h("div"),f=h("div"),u=R(c),_=L(),b=h("div"),$=R(p),m(t,"aria-hidden","true"),m(t,"alt",s=l[3].filename),ct(t.src,n=l[3].iconurl)||m(t,"src",n),m(t,"width","24"),m(t,"height","24"),m(t,"class","flex-shrink-0 svelte-19vi34"),m(r,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0 svelte-19vi34"),m(r,"aria-hidden","true"),he(r,"width","24px"),he(r,"height","24px"),m(b,"class","text-left text-muted"),m(a,"class","ml-2 mr-1"),he(a,"min-width","0"),m(e,"href",w=l[3].fileurl),m(e,"class","local-mail-message-attachments-file btn btn-light d-flex align-items-center px-2 py-1 mr-3 mb-3 svelte-19vi34")},m(v,T){y(v,e,T),g(e,t),g(e,i),g(e,r),g(e,o),g(e,a),g(a,f),g(f,u),g(a,_),g(a,b),g(b,$),k||(C=je(d=Ve.call(null,f,l[2](l[3]))),k=!0)},p(v,T){l=v,T&2&&s!==(s=l[3].filename)&&m(t,"alt",s),T&2&&!ct(t.src,n=l[3].iconurl)&&m(t,"src",n),T&2&&c!==(c=l[2](l[3])+"")&&F(u,c),d&&De(d.update)&&T&2&&d.update.call(null,l[2](l[3])),T&2&&p!==(p=zt(l[3].filesize)+"")&&F($,p),T&2&&w!==(w=l[3].fileurl)&&m(e,"href",w)},d(v){v&&M(e),k=!1,C()}}}function Cs(l){let e,t,s,n,i=l[0].downloadall+"",r,o;return{c(){e=h("a"),t=h("i"),s=L(),n=h("div"),r=R(i),m(t,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),m(t,"aria-hidden","true"),he(t,"width","24px"),he(t,"height","24px"),m(n,"class","text-truncate ml-2"),m(e,"href",o=jt(l[1].id)),m(e,"class","btn btn-light d-flex align-items-center p-2 mr-3 mb-3 svelte-19vi34")},m(a,f){y(a,e,f),g(e,t),g(e,s),g(e,n),g(n,r)},p(a,f){f&1&&i!==(i=a[0].downloadall+"")&&F(r,i),f&2&&o!==(o=jt(a[1].id))&&m(e,"href",o)},d(a){a&&M(e)}}}function ir(l){let e,t,s=ue(l[1].attachments),n=[];for(let r=0;r<s.length;r+=1)n[r]=Ms(ys(l,s,r));let i=l[1].attachments.length>1&&Cs(l);return{c(){e=h("div");for(let r=0;r<n.length;r+=1)n[r].c();t=L(),i&&i.c(),m(e,"class","local-mail-message-attachments d-sm-flex flex-wrap mr-n3 mt-3 mb-sm-n3 svelte-19vi34")},m(r,o){y(r,e,o);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);g(e,t),i&&i.m(e,null)},p(r,[o]){if(o&6){s=ue(r[1].attachments);let a;for(a=0;a<s.length;a+=1){const f=ys(r,s,a);n[a]?n[a].p(f,o):(n[a]=Ms(f),n[a].c(),n[a].m(e,t))}for(;a<n.length;a+=1)n[a].d(1);n.length=s.length}r[1].attachments.length>1?i?i.p(r,o):(i=Cs(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:G,o:G,d(r){r&&M(e),Ee(n,r),i&&i.d()}}}function rr(l,e,t){let{strings:s}=e,{message:n}=e;const i=r=>(r.filepath+r.filename).replace(/^\//,"");return l.$$set=r=>{"strings"in r&&t(0,s=r.strings),"message"in r&&t(1,n=r.message)},[s,n,i]}class pn extends oe{constructor(e){super(),fe(this,e,rr,ir,re,{strings:0,message:1})}}function ar(l){let e,t,s,n=l[3].strings.reply+"",i,r,o,a,f,c=l[3].strings.replyall+"",u,d,_,b,p,$,w=l[3].strings.forward+"",k,C,v;return{c(){e=h("button"),t=h("i"),s=L(),i=R(n),r=L(),o=h("button"),a=h("i"),f=L(),u=R(c),_=L(),b=h("button"),p=h("i"),$=L(),k=R(w),m(t,"class","fa fa-fw fa-reply mr-2"),m(e,"type","button"),m(e,"class","btn btn-primary mr-3 mb-3"),m(a,"class","fa fa-fw fa-reply-all mr-2"),m(o,"type","button"),o.disabled=d=!l[2],m(o,"class","btn mr-3 mb-3"),O(o,"disabled",!l[2]),O(o,"btn-primary",l[2]),O(o,"btn-secondary",!l[2]),m(p,"class","fa fa-fw fa-share mr-2"),m(b,"type","button"),m(b,"class","btn btn-primary mr-3 mb-3")},m(T,A){y(T,e,A),g(e,t),g(e,s),g(e,i),y(T,r,A),y(T,o,A),g(o,a),g(o,f),g(o,u),y(T,_,A),y(T,b,A),g(b,p),g(b,$),g(b,k),C||(v=[W(e,"click",l[4]),W(o,"click",l[5]),W(b,"click",l[6])],C=!0)},p(T,[A]){A&8&&n!==(n=T[3].strings.reply+"")&&F(i,n),A&8&&c!==(c=T[3].strings.replyall+"")&&F(u,c),A&4&&d!==(d=!T[2])&&(o.disabled=d),A&4&&O(o,"disabled",!T[2]),A&4&&O(o,"btn-primary",T[2]),A&4&&O(o,"btn-secondary",!T[2]),A&8&&w!==(w=T[3].strings.forward+"")&&F(k,w)},i:G,o:G,d(T){T&&(M(e),M(r),M(o),M(_),M(b)),C=!1,Me(v)}}}function or(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,d=>t(3,s=d)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e,{canReplyAll:a}=e;const f=()=>r.reply(o,!1),c=()=>r.reply(o,!0),u=()=>r.forward(o);return l.$$set=d=>{"store"in d&&i(t(0,r=d.store)),"message"in d&&t(1,o=d.message),"canReplyAll"in d&&t(2,a=d.canReplyAll)},[r,o,a,s,f,c,u]}class fr extends oe{constructor(e){super(),fe(this,e,or,ar,re,{store:0,message:1,canReplyAll:2})}}function ur(l){let e;return{c(){e=h("div"),m(e,"class","local-mail-message-content svelte-18ecame")},m(t,s){y(t,e,s),e.innerHTML=l[0],l[2](e)},p(t,[s]){s&1&&(e.innerHTML=t[0])},i:G,o:G,d(t){t&&M(e),l[2](null)}}}function cr(l,e,t){let{content:s}=e,n;Kl(async()=>{(await _t("core_filters/events")).notifyFilterContentUpdated([n])});function i(r){Se[r?"unshift":"push"](()=>{n=r,t(1,n)})}return l.$$set=r=>{"content"in r&&t(0,s=r.content)},[s,n,i]}class bn extends oe{constructor(e){super(),fe(this,e,cr,ur,re,{content:0})}}function Ss(l,e,t){const s=l.slice();return s[3]=e[t],s}function Ds(l){let e,t;return e=new yt({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ts(l,e){let t,s,n;return s=new Mt({props:{label:e[3]}}),{key:l,first:null,c(){t=ge(),J(s.$$.fragment),this.first=t},m(i,r){y(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&2&&(o.label=e[3]),s.$set(o)},i(i){n||(S(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(s,i)}}}function mr(l){let e,t=[],s=new Map,n,i,r=l[1].course.id!=l[2].params.courseid&&Ds(l),o=ue(l[1].labels);const a=f=>f[3].id;for(let f=0;f<o.length;f+=1){let c=Ss(l,o,f),u=a(c);s.set(u,t[f]=Ts(u,c))}return{c(){r&&r.c(),e=L();for(let f=0;f<t.length;f+=1)t[f].c();n=ge()},m(f,c){r&&r.m(f,c),y(f,e,c);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(f,c);y(f,n,c),i=!0},p(f,[c]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,c),c&6&&S(r,1)):(r=Ds(f),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(ne(),z(r,1,1,()=>{r=null}),ie()),c&2&&(o=ue(f[1].labels),ne(),t=ze(t,c,a,1,f,o,s,n.parentNode,We,Ts,n,Ss),ie())},i(f){if(!i){S(r);for(let c=0;c<o.length;c+=1)S(t[c]);i=!0}},o(f){z(r);for(let c=0;c<t.length;c+=1)z(t[c]);i=!1},d(f){f&&(M(e),M(n)),r&&r.d(f);for(let c=0;c<t.length;c+=1)t[c].d(f)}}}function dr(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class _r extends oe{constructor(e){super(),fe(this,e,dr,mr,re,{store:0,message:1})}}function gr(l){let e;function t(i,r){if(i[0])return hr;if(i[1])return br}let s=t(l),n=s&&s(l);return{c(){e=h("span"),n&&n.c(),m(e,"class","local-mail-user-picture-fallback m-0 svelte-1ebin1")},m(i,r){y(i,e,r),n&&n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n&&n.d(1),n=s&&s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&M(e),n&&n.d()}}}function pr(l){let e,t;return{c(){e=h("img"),ct(e.src,t=l[0].pictureurl)||m(e,"src",t),m(e,"width","35"),m(e,"height","35"),m(e,"alt",""),m(e,"aria-hidden","true"),m(e,"class","rounded-circle")},m(s,n){y(s,e,n)},p(s,n){n&1&&!ct(e.src,t=s[0].pictureurl)&&m(e,"src",t)},d(s){s&&M(e)}}}function br(l){let e,t;return{c(){e=h("i"),m(e,"class",t="fa "+l[1]+" svelte-1ebin1")},m(s,n){y(s,e,n)},p(s,n){n&2&&t!==(t="fa "+s[1]+" svelte-1ebin1")&&m(e,"class",t)},d(s){s&&M(e)}}}function hr(l){let e=l[0].firstname.slice(0,1)+"",t,s=l[0].lastname.slice(0,1)+"",n;return{c(){t=R(e),n=R(s)},m(i,r){y(i,t,r),y(i,n,r)},p(i,r){r&1&&e!==(e=i[0].firstname.slice(0,1)+"")&&F(t,e),r&1&&s!==(s=i[0].lastname.slice(0,1)+"")&&F(n,s)},d(i){i&&(M(t),M(n))}}}function vr(l){let e;function t(i,r){var o;return(o=i[0])!=null&&o.pictureurl?pr:gr}let s=t(l),n=s(l);return{c(){n.c(),e=ge()},m(i,r){n.m(i,r),y(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:G,o:G,d(i){i&&M(e),n.d(i)}}}function kr(l,e,t){let{user:s=void 0}=e,{icon:n=void 0}=e;return l.$$set=i=>{"user"in i&&t(0,s=i.user),"icon"in i&&t(1,n=i.icon)},[s,n]}class ot extends oe{constructor(e){super(),fe(this,e,kr,vr,re,{user:0,icon:1})}}function Ls(l){let e,t,s,n;return s=new pn({props:{strings:l[0],message:l[1]}}),{c(){e=h("hr"),t=L(),J(s.$$.fragment)},m(i,r){y(i,e,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.strings=i[0]),r&2&&(o.message=i[1]),s.$set(o)},i(i){n||(S(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(M(e),M(t)),V(s,i)}}}function wr(l){let e,t,s,n=l[1].subject+"",i,r,o,a,f,c,u,d,_,b=l[1].sender.fullname+"",p,$,w,k,C=l[1].fulltime+"",v,T,A,D,N,I,H;c=new ot({props:{user:l[1].sender}}),N=new bn({props:{content:l[1].content}});let P=l[1].attachments.length>0&&Ls(l);return{c(){e=h("div"),t=h("div"),s=h("h5"),i=R(n),r=L(),o=h("div"),a=h("div"),f=h("div"),J(c.$$.fragment),u=L(),d=h("div"),_=h("a"),p=R(b),w=L(),k=h("div"),v=R(C),T=L(),A=h("hr"),D=L(),J(N.$$.fragment),I=L(),P&&P.c(),m(s,"class","h5 card-title mb-3"),m(f,"class","mr-3"),m(_,"href",$=l[1].sender.profileurl),m(d,"class","mt-1"),m(a,"class","d-flex mb-3 mb-sm-0"),m(k,"class","mt-1 ml-auto"),m(o,"class","d-sm-flex mb-n1"),m(t,"class","card-body p-3 px-xl-4"),m(e,"class","card mb-4")},m(q,Z){y(q,e,Z),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),g(a,f),K(c,f,null),g(a,u),g(a,d),g(d,_),g(_,p),g(o,w),g(o,k),g(k,v),g(t,T),g(t,A),g(t,D),K(N,t,null),g(t,I),P&&P.m(t,null),H=!0},p(q,[Z]){(!H||Z&2)&&n!==(n=q[1].subject+"")&&F(i,n);const se={};Z&2&&(se.user=q[1].sender),c.$set(se),(!H||Z&2)&&b!==(b=q[1].sender.fullname+"")&&F(p,b),(!H||Z&2&&$!==($=q[1].sender.profileurl))&&m(_,"href",$),(!H||Z&2)&&C!==(C=q[1].fulltime+"")&&F(v,C);const X={};Z&2&&(X.content=q[1].content),N.$set(X),q[1].attachments.length>0?P?(P.p(q,Z),Z&2&&S(P,1)):(P=Ls(q),P.c(),S(P,1),P.m(t,null)):P&&(ne(),z(P,1,1,()=>{P=null}),ie())},i(q){H||(S(c.$$.fragment,q),S(N.$$.fragment,q),S(P),H=!0)},o(q){z(c.$$.fragment,q),z(N.$$.fragment,q),z(P),H=!1},d(q){q&&M(e),V(c),V(N),P&&P.d()}}}function $r(l,e,t){let{strings:s}=e,{reference:n}=e;return l.$$set=i=>{"strings"in i&&t(0,s=i.strings),"reference"in i&&t(1,n=i.reference)},[s,n]}class hn extends oe{constructor(e){super(),fe(this,e,$r,wr,re,{strings:0,reference:1})}}function zs(l,e,t){const s=l.slice();return s[4]=e[t],s}function js(l,e,t){const s=l.slice();return s[7]=e[t],s[9]=t,s}function Ns(l){let e,t,s=l[3].strings[l[4]]+"",n,i,r,o=[],a=new Map,f,c=ue(l[2](l[4]));const u=d=>d[7].id;for(let d=0;d<c.length;d+=1){let _=js(l,c,d),b=u(_);a.set(b,o[d]=As(b,_))}return{c(){e=h("div"),t=h("span"),n=R(s),i=R(":"),r=L();for(let d=0;d<o.length;d+=1)o[d].c();f=L(),m(e,"class","mb-2")},m(d,_){y(d,e,_),g(e,t),g(t,n),g(t,i),g(e,r);for(let b=0;b<o.length;b+=1)o[b]&&o[b].m(e,null);g(e,f)},p(d,_){_&8&&s!==(s=d[3].strings[d[4]]+"")&&F(n,s),_&4&&(c=ue(d[2](d[4])),o=ze(o,_,u,1,d,c,a,e,rt,As,f,js))},d(d){d&&M(e);for(let _=0;_<o.length;_+=1)o[_].d()}}}function Is(l){let e;return{c(){e=R(",")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function As(l,e){let t,s,n,i=e[7].fullname+"",r,o,a=e[9]>0&&Is();return{key:l,first:null,c(){t=ge(),a&&a.c(),s=L(),n=h("a"),r=R(i),m(n,"href",o=e[7].profileurl),this.first=t},m(f,c){y(f,t,c),a&&a.m(f,c),y(f,s,c),y(f,n,c),g(n,r)},p(f,c){e=f,e[9]>0?a||(a=Is(),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null),c&4&&i!==(i=e[7].fullname+"")&&F(r,i),c&4&&o!==(o=e[7].profileurl)&&m(n,"href",o)},d(f){f&&(M(t),M(s),M(n)),a&&a.d(f)}}}function Bs(l){let e=l[2](l[4]).length>0,t,s=e&&Ns(l);return{c(){s&&s.c(),t=ge()},m(n,i){s&&s.m(n,i),y(n,t,i)},p(n,i){i&4&&(e=n[2](n[4]).length>0),e?s?s.p(n,i):(s=Ns(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(n){n&&M(t),s&&s.d(n)}}}function yr(l){let e,t,s,n,i,r,o,a=l[1].sender.fullname+"",f,c,u,d;s=new ot({props:{user:l[1].sender}});let _=ue(Object.values(qe)),b=[];for(let p=0;p<_.length;p+=1)b[p]=Bs(zs(l,_,p));return{c(){e=h("div"),t=h("div"),J(s.$$.fragment),n=L(),i=h("div"),r=h("div"),o=h("a"),f=R(a),u=L();for(let p=0;p<b.length;p+=1)b[p].c();m(t,"class","mr-3"),m(o,"href",c=l[1].sender.profileurl),m(r,"class","mt-1 mb-2"),m(i,"class","d-flex flex-column"),m(e,"class","local-mail-message-users d-flex mb-n2")},m(p,$){y(p,e,$),g(e,t),K(s,t,null),g(e,n),g(e,i),g(i,r),g(r,o),g(o,f),g(i,u);for(let w=0;w<b.length;w+=1)b[w]&&b[w].m(i,null);d=!0},p(p,[$]){const w={};if($&2&&(w.user=p[1].sender),s.$set(w),(!d||$&2)&&a!==(a=p[1].sender.fullname+"")&&F(f,a),(!d||$&2&&c!==(c=p[1].sender.profileurl))&&m(o,"href",c),$&12){_=ue(Object.values(qe));let k;for(k=0;k<_.length;k+=1){const C=zs(p,_,k);b[k]?b[k].p(C,$):(b[k]=Bs(C),b[k].c(),b[k].m(i,null))}for(;k<b.length;k+=1)b[k].d(1);b.length=_.length}},i(p){d||(S(s.$$.fragment,p),d=!0)},o(p){z(s.$$.fragment,p),d=!1},d(p){p&&M(e),V(s),Ee(b,p)}}}function Mr(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,f=>t(3,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(1,a=f.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=f=>a.recipients.filter(c=>c.type==f))},[o,a,s,n]}class Cr extends oe{constructor(e){super(),fe(this,e,Mr,yr,re,{store:0,message:1})}}function qs(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ps(l){let e,t,s,n;return s=new pn({props:{strings:l[2].strings,message:l[1]}}),{c(){e=h("hr"),t=L(),J(s.$$.fragment)},m(i,r){y(i,e,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&4&&(o.strings=i[2].strings),r&2&&(o.message=i[1]),s.$set(o)},i(i){n||(S(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&(M(e),M(t)),V(s,i)}}}function Es(l){let e,t=l[2].strings.references+"",s,n,i=[],r=new Map,o,a,f=ue(l[1].references);const c=u=>u[4].id;for(let u=0;u<f.length;u+=1){let d=qs(l,f,u),_=c(d);r.set(_,i[u]=Rs(_,d))}return{c(){e=h("div"),s=R(t),n=L();for(let u=0;u<i.length;u+=1)i[u].c();o=ge(),m(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(u,d){y(u,e,d),g(e,s),y(u,n,d);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(u,d);y(u,o,d),a=!0},p(u,d){(!a||d&4)&&t!==(t=u[2].strings.references+"")&&F(s,t),d&6&&(f=ue(u[1].references),ne(),i=ze(i,d,c,1,u,f,r,o.parentNode,We,Rs,o,qs),ie())},i(u){if(!a){for(let d=0;d<f.length;d+=1)S(i[d]);a=!0}},o(u){for(let d=0;d<i.length;d+=1)z(i[d]);a=!1},d(u){u&&(M(e),M(n),M(o));for(let d=0;d<i.length;d+=1)i[d].d(u)}}}function Rs(l,e){let t,s,n;return s=new hn({props:{strings:e[2].strings,reference:e[4]}}),{key:l,first:null,c(){t=ge(),J(s.$$.fragment),this.first=t},m(i,r){y(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&4&&(o.strings=e[2].strings),r&2&&(o.reference=e[4]),s.$set(o)},i(i){n||(S(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(s,i)}}}function Sr(l){let e,t,s,n,i,r=l[1].subject+"",o,a,f,c,u,d,_,b,p=l[1].fulltime+"",$,w,k,C,v,T,A,D,N,I,H,P,q,Z,se,X,ee,U,te;e=new gn({props:{javascript:l[1].javascript}}),u=new _r({props:{store:l[0],message:l[1]}}),C=new nr({props:{store:l[0],message:l[1],canReplyAll:l[3]}}),T=new Cr({props:{store:l[0],message:l[1]}}),I=new bn({props:{content:l[1].content}});let le=l[1].attachments.length>0&&Ps(l);X=new fr({props:{store:l[0],message:l[1],canReplyAll:l[3]}});let j=l[1].references.length>0&&Es(l);return{c(){J(e.$$.fragment),t=L(),s=h("div"),n=h("div"),i=h("h3"),o=R(r),a=L(),f=h("div"),c=h("div"),J(u.$$.fragment),d=L(),_=h("div"),b=h("div"),$=R(p),w=L(),k=h("div"),J(C.$$.fragment),v=L(),J(T.$$.fragment),A=L(),D=h("hr"),N=L(),J(I.$$.fragment),H=L(),le&&le.c(),P=L(),q=h("hr"),Z=L(),se=h("div"),J(X.$$.fragment),ee=L(),j&&j.c(),U=ge(),m(i,"class","h4 card-title mb-3 mb-md-2"),m(c,"class","d-flex flex-wrap mx-n2 mt-2"),he(c,"min-width","0"),m(b,"class","my-2 text-truncate"),m(k,"class","d-flex flex-shrink-0 ml-3 mr-n2"),m(_,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),m(f,"class","d-md-flex align-items-start mb-2"),m(se,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),m(n,"class","card-body p-3 px-xl-4"),m(s,"class","card")},m(B,Y){K(e,B,Y),y(B,t,Y),y(B,s,Y),g(s,n),g(n,i),g(i,o),g(n,a),g(n,f),g(f,c),K(u,c,null),g(f,d),g(f,_),g(_,b),g(b,$),g(_,w),g(_,k),K(C,k,null),g(n,v),K(T,n,null),g(n,A),g(n,D),g(n,N),K(I,n,null),g(n,H),le&&le.m(n,null),g(n,P),g(n,q),g(n,Z),g(n,se),K(X,se,null),y(B,ee,Y),j&&j.m(B,Y),y(B,U,Y),te=!0},p(B,[Y]){const E={};Y&2&&(E.javascript=B[1].javascript),e.$set(E),(!te||Y&2)&&r!==(r=B[1].subject+"")&&F(o,r);const de={};Y&1&&(de.store=B[0]),Y&2&&(de.message=B[1]),u.$set(de),(!te||Y&2)&&p!==(p=B[1].fulltime+"")&&F($,p);const x={};Y&1&&(x.store=B[0]),Y&2&&(x.message=B[1]),Y&8&&(x.canReplyAll=B[3]),C.$set(x);const ve={};Y&1&&(ve.store=B[0]),Y&2&&(ve.message=B[1]),T.$set(ve);const we={};Y&2&&(we.content=B[1].content),I.$set(we),B[1].attachments.length>0?le?(le.p(B,Y),Y&2&&S(le,1)):(le=Ps(B),le.c(),S(le,1),le.m(n,P)):le&&(ne(),z(le,1,1,()=>{le=null}),ie());const ke={};Y&1&&(ke.store=B[0]),Y&2&&(ke.message=B[1]),Y&8&&(ke.canReplyAll=B[3]),X.$set(ke),B[1].references.length>0?j?(j.p(B,Y),Y&2&&S(j,1)):(j=Es(B),j.c(),S(j,1),j.m(U.parentNode,U)):j&&(ne(),z(j,1,1,()=>{j=null}),ie())},i(B){te||(S(e.$$.fragment,B),S(u.$$.fragment,B),S(C.$$.fragment,B),S(T.$$.fragment,B),S(I.$$.fragment,B),S(le),S(X.$$.fragment,B),S(j),te=!0)},o(B){z(e.$$.fragment,B),z(u.$$.fragment,B),z(C.$$.fragment,B),z(T.$$.fragment,B),z(I.$$.fragment,B),z(le),z(X.$$.fragment,B),z(j),te=!1},d(B){B&&(M(t),M(s),M(ee),M(U)),V(e,B),V(u),V(C),V(T),V(I),le&&le.d(),V(X),j&&j.d(B)}}}function Dr(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,f=>t(2,n=f)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{message:a}=e;return l.$$set=f=>{"store"in f&&r(t(0,o=f.store)),"message"in f&&t(1,a=f.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=a.sender.id==n.userid?a.recipients.filter(f=>f.type=="cc").length>0:a.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[o,a,n,s]}class Tr extends oe{constructor(e){super(),fe(this,e,Dr,Sr,re,{store:0,message:1})}}function Fs(l,e,t){const s=l.slice();s[6]=e[t];const n=Array.from(s[1].values()).filter(function(...r){return l[5](s[6],...r)});return s[7]=n,s}function Gs(l,e,t){const s=l.slice();return s[10]=e[t],s}function Us(l){let e,t,s=l[3].strings[l[6]]+"",n,i,r,o,a=[],f=new Map,c,u,d,_=ue(l[7]);const b=p=>p[10].id;for(let p=0;p<_.length;p+=1){let $=Gs(l,_,p),w=b($);f.set(w,a[p]=Hs(w,$))}return{c(){e=h("div"),t=h("div"),n=R(s),i=R(":"),r=L(),o=h("div");for(let p=0;p<a.length;p+=1)a[p].c();c=L(),m(t,"class","local-mail-draft-form-recipients-type flex-shrink-0 py-2 mr-2 svelte-orcw73"),m(o,"class","d-flex flex-wrap"),he(o,"min-width","0"),m(e,"class","d-flex mb-2")},m(p,$){y(p,e,$),g(e,t),g(t,n),g(t,i),g(e,r),g(e,o);for(let w=0;w<a.length;w+=1)a[w]&&a[w].m(o,null);g(e,c),d=!0},p(p,$){(!d||$&8)&&s!==(s=p[3].strings[p[6]]+"")&&F(n,s),$&14&&(_=ue(p[7]),ne(),a=ze(a,$,b,1,p,_,f,o,We,Hs,null,Gs),ie())},i(p){if(!d){for(let $=0;$<_.length;$+=1)S(a[$]);p&&Ae(()=>{d&&(u||(u=He(e,Pe,{},!0)),u.run(1))}),d=!0}},o(p){for(let $=0;$<a.length;$+=1)z(a[$]);p&&(u||(u=He(e,Pe,{},!1)),u.run(0)),d=!1},d(p){p&&M(e);for(let $=0;$<a.length;$+=1)a[$].d();p&&u&&u.end()}}}function Lr(l){let e,t,s;return{c(){e=h("div"),t=h("i"),m(t,"class","fa fa-exclamation-circle"),m(e,"class","m-0 d-flex justify-content-center align-items-center"),he(e,"width","35px"),he(e,"height","35px"),m(e,"title",s=l[3].strings.cannotsendmailtouser)},m(n,i){y(n,e,i),g(e,t)},p(n,i){i&8&&s!==(s=n[3].strings.cannotsendmailtouser)&&m(e,"title",s)},i:G,o:G,d(n){n&&M(e)}}}function zr(l){let e,t;return e=new ot({props:{user:l[10]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.user=s[10]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Hs(l,e){let t,s,n,i,r,o,a=e[10].fullname+"",f,c,u,d,_,b,p,$,w,k,C,v;const T=[zr,Lr],A=[];function D(I,H){return I[10].isvalid?0:1}n=D(e),i=A[n]=T[n](e);function N(){return e[4](e[10])}return{key:l,first:null,c(){t=h("div"),s=h("div"),i.c(),r=L(),o=h("div"),f=R(a),u=L(),d=h("button"),_=h("i"),p=L(),m(s,"class","d-flex m-1 mr-2"),m(o,"class","py-2"),m(_,"class","fa fa-fw fa-times"),m(d,"type","button"),m(d,"class","btn align-self-middle p-2 align-bottom svelte-orcw73"),m(d,"title",b=e[3].strings.delete),m(t,"class","local-mail-draft-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2 svelte-orcw73"),O(t,"alert-danger",!e[10].isvalid),this.first=t},m(I,H){y(I,t,H),g(t,s),A[n].m(s,null),g(t,r),g(t,o),g(o,f),g(t,u),g(t,d),g(d,_),g(t,p),k=!0,C||(v=[je(c=Ve.call(null,o,e[10].fullname)),W(d,"click",N),je($=Ve.call(null,t,e[10].fullname))],C=!0)},p(I,H){e=I;let P=n;n=D(e),n===P?A[n].p(e,H):(ne(),z(A[P],1,1,()=>{A[P]=null}),ie(),i=A[n],i?i.p(e,H):(i=A[n]=T[n](e),i.c()),S(i,1),i.m(s,null)),(!k||H&2)&&a!==(a=e[10].fullname+"")&&F(f,a),c&&De(c.update)&&H&2&&c.update.call(null,e[10].fullname),(!k||H&8&&b!==(b=e[3].strings.delete))&&m(d,"title",b),$&&De($.update)&&H&2&&$.update.call(null,e[10].fullname),(!k||H&2)&&O(t,"alert-danger",!e[10].isvalid)},i(I){k||(S(i),I&&Ae(()=>{k&&(w||(w=He(t,Pe,{},!0)),w.run(1))}),k=!0)},o(I){z(i),I&&(w||(w=He(t,Pe,{},!1)),w.run(0)),k=!1},d(I){I&&M(t),A[n].d(),I&&w&&w.end(),C=!1,Me(v)}}}function Os(l){let e,t,s=l[7].length&&Us(l);return{c(){s&&s.c(),e=ge()},m(n,i){s&&s.m(n,i),y(n,e,i),t=!0},p(n,i){n[7].length?s?(s.p(n,i),i&2&&S(s,1)):(s=Us(n),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(S(s),t=!0)},o(n){z(s),t=!1},d(n){n&&M(e),s&&s.d(n)}}}function jr(l){let e,t,s=ue(Object.values(qe)),n=[];for(let r=0;r<s.length;r+=1)n[r]=Os(Fs(l,s,r));const i=r=>z(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ge()},m(r,o){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(r,o);y(r,e,o),t=!0},p(r,[o]){if(o&14){s=ue(Object.values(qe));let a;for(a=0;a<s.length;a+=1){const f=Fs(r,s,a);n[a]?(n[a].p(f,o),S(n[a],1)):(n[a]=Os(f),n[a].c(),S(n[a],1),n[a].m(e.parentNode,e))}for(ne(),a=s.length;a<n.length;a+=1)i(a);ie()}},i(r){if(!t){for(let o=0;o<s.length;o+=1)S(n[o]);t=!0}},o(r){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)z(n[o]);t=!1},d(r){r&&M(e),Ee(n,r)}}}function Nr(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,u=>t(3,s=u)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:o}=e,{onDelete:a}=e;const f=u=>a(u),c=(u,d)=>d.type==u;return l.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"recipients"in u&&t(1,o=u.recipients),"onDelete"in u&&t(2,a=u.onDelete)},[r,o,a,s,f,c]}class Ir extends oe{constructor(e){super(),fe(this,e,Nr,jr,re,{store:0,recipients:1,onDelete:2})}}function Js(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ar(l){let e,t,s=l[1].shorttime+"",n;return{c(){e=h("i"),t=L(),n=R(s),m(e,"class","fa fa-clock-o mr-1"),m(e,"aria-hidden","true")},m(i,r){y(i,e,r),y(i,t,r),y(i,n,r)},p(i,r){r&2&&s!==(s=i[1].shorttime+"")&&F(n,s)},d(i){i&&(M(e),M(t),M(n))}}}function Br(l){let e,t,s=l[2].strings.draftsaved+"",n;return{c(){e=h("i"),t=L(),n=R(s),m(e,"class","fa fa-check mr-1"),m(e,"aria-hidden","true")},m(i,r){y(i,e,r),y(i,t,r),y(i,n,r)},p(i,r){r&4&&s!==(s=i[2].strings.draftsaved+"")&&F(n,s)},d(i){i&&(M(e),M(t),M(n))}}}function Ks(l){let e,t=[],s=new Map,n,i=ue(l[1].labels);const r=o=>o[4].id;for(let o=0;o<i.length;o+=1){let a=Js(l,i,o),f=r(a);s.set(f,t[o]=Vs(f,a))}return{c(){e=h("div");for(let o=0;o<t.length;o+=1)t[o].c();m(e,"class","d-flex flex-wrap mt-2 mr-2"),he(e,"min-width","0")},m(o,a){y(o,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(o,a){a&2&&(i=ue(o[1].labels),ne(),t=ze(t,a,r,1,o,i,s,e,We,Vs,null,Js),ie())},i(o){if(!n){for(let a=0;a<i.length;a+=1)S(t[a]);n=!0}},o(o){for(let a=0;a<t.length;a+=1)z(t[a]);n=!1},d(o){o&&M(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Vs(l,e){let t,s,n;return s=new Mt({props:{label:e[4]}}),{key:l,first:null,c(){t=ge(),J(s.$$.fragment),this.first=t},m(i,r){y(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&2&&(o.label=e[4]),s.$set(o)},i(i){n||(S(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(s,i)}}}function qr(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p;function $(v,T){return v[2].draftSaved?Br:Ar}let w=$(l),k=w(l),C=l[1].labels&&Ks(l);return{c(){e=h("div"),t=h("div"),s=h("div"),k.c(),i=L(),r=h("button"),o=h("i"),d=L(),C&&C.c(),m(s,"class","align-self-center alert-info px-2 text-truncate"),m(s,"title",n=l[1].fulltime),m(o,"class",a="fa "+(l[1].starred?"fa-star text-warning":"fa-star-o")),m(r,"type","button"),m(r,"class","btn border-0 py-2 ml-auto mr-3 mr-sm-2"),m(r,"role","checkbox"),m(r,"aria-checked",f=l[1].starred),r.disabled=c=l[1].deleted,m(r,"title",u=l[1].starred?l[2].strings.markasunstarred:l[2].strings.markasstarred),m(t,"class","d-flex flex-grow-1"),m(e,"class","d-sm-flex justify-content-between mb-2 mr-n3")},m(v,T){y(v,e,T),g(e,t),g(t,s),k.m(s,null),g(t,i),g(t,r),g(r,o),g(e,d),C&&C.m(e,null),_=!0,b||(p=W(r,"click",l[3]),b=!0)},p(v,[T]){w===(w=$(v))&&k?k.p(v,T):(k.d(1),k=w(v),k&&(k.c(),k.m(s,null))),(!_||T&2&&n!==(n=v[1].fulltime))&&m(s,"title",n),(!_||T&2&&a!==(a="fa "+(v[1].starred?"fa-star text-warning":"fa-star-o")))&&m(o,"class",a),(!_||T&2&&f!==(f=v[1].starred))&&m(r,"aria-checked",f),(!_||T&2&&c!==(c=v[1].deleted))&&(r.disabled=c),(!_||T&6&&u!==(u=v[1].starred?v[2].strings.markasunstarred:v[2].strings.markasstarred))&&m(r,"title",u),v[1].labels?C?(C.p(v,T),T&2&&S(C,1)):(C=Ks(v),C.c(),S(C,1),C.m(e,null)):C&&(ne(),z(C,1,1,()=>{C=null}),ie())},i(v){_||(S(C),_=!0)},o(v){z(C),_=!1},d(v){v&&M(e),k.d(),C&&C.d(),b=!1,p()}}}function Pr(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;const a=()=>r.setStarred([o.id],!o.starred);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,o=f.message)},[r,o,s,a]}class Er extends oe{constructor(e){super(),fe(this,e,Pr,qr,re,{store:0,message:1})}}let Je;const Rr=new Set(["get_courses","get_labels","count_messages","search_messages","get_message","view_message","get_roles","get_groups","search_users","get_message_form"]);function Ct(l){let e=!1;const t=async()=>{const s=await _t("core/ajax"),n=l.filter(r=>!e||!Rr.has(r.methodname)).map(({methodname:r,...o})=>({methodname:`local_mail_${r}`,args:o}));let i=[];if(n.length>0)try{i=await Promise.all(s.call(n))}catch(r){throw typeof r=="string"?{message:r}:r}return e?null:i};return Je==null||Je.cancel(),Je={promise:Je?Je.promise.then(t,t):t(),cancel:()=>{e=!0}},Je.promise}function Ws(l,e,t){var i;const s=l.slice();s[28]=e[t];const n=(i=s[1].get(s[28].id))==null?void 0:i.type;return s[29]=n,s}function Xs(l,e,t){const s=l.slice();return s[32]=e[t],s}function Ys(l,e,t){const s=l.slice();s[32]=e[t];const n=s[10].every(function(...r){return l[21](s[32],...r)});return s[35]=n,s}function Qs(l,e,t){const s=l.slice();return s[38]=e[t],s}function Zs(l,e,t){const s=l.slice();return s[41]=e[t],s}function xs(l,e){let t,s=e[41].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=R(s),i=L(),t.__value=r=e[41].id,Le(t,t.__value),this.first=t},m(o,a){y(o,t,a),g(t,n),g(t,i)},p(o,a){e=o,a[0]&32&&s!==(s=e[41].name+"")&&F(n,s),a[0]&32&&r!==(r=e[41].id)&&(t.__value=r,Le(t,t.__value))},d(o){o&&M(t)}}}function el(l){let e,t,s=[],n=new Map,i,r,o,a=ue(l[5].draftGroups??[]);const f=c=>c[38].id;for(let c=0;c<a.length;c+=1){let u=Qs(l,a,c),d=f(u);n.set(d,s[c]=tl(d,u))}return{c(){e=h("div"),t=h("select");for(let c=0;c<s.length;c+=1)s[c].c();m(t,"class","form-control text-truncate"),he(t,"min-width","0"),t.disabled=i=(l[5].draftGroups??[]).length==1,l[4]===void 0&&Ae(()=>l[18].call(t)),m(e,"class","flex-grow-1 mx-2 mt-2 mt-sm-0")},m(c,u){y(c,e,u),g(e,t);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(t,null);tt(t,l[4],!0),r||(o=[W(t,"change",l[18]),W(t,"change",l[19])],r=!0)},p(c,u){u[0]&32&&(a=ue(c[5].draftGroups??[]),s=ze(s,u,f,1,c,a,n,t,rt,tl,null,Qs)),u[0]&32&&i!==(i=(c[5].draftGroups??[]).length==1)&&(t.disabled=i),u[0]&48&&tt(t,c[4])},d(c){c&&M(e);for(let u=0;u<s.length;u+=1)s[u].d();r=!1,Me(o)}}}function tl(l,e){let t,s=e[38].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=R(s),i=L(),t.__value=r=e[38].id,Le(t,t.__value),m(t,"class","text-truncate"),this.first=t},m(o,a){y(o,t,a),g(t,n),g(t,i)},p(o,a){e=o,a[0]&32&&s!==(s=e[38].name+"")&&F(n,s),a[0]&32&&r!==(r=e[38].id)&&(t.__value=r,Le(t,t.__value))},d(o){o&&M(t)}}}function Fr(l){let e,t,s,n,i,r,o=l[5].strings.allusers+"",a,f,c,u,d,_=[],b=new Map,p,$,w,k;s=new ot({props:{icon:"fa-users"}});let C=ue(Object.values(qe)),v=[];for(let D=0;D<C.length;D+=1)v[D]=sl(Ys(l,C,D));let T=ue(l[10]);const A=D=>D[28].id;for(let D=0;D<T.length;D+=1){let N=Ws(l,T,D),I=A(N);b.set(I,_[D]=nl(I,N))}return{c(){e=h("div"),t=h("div"),J(s.$$.fragment),n=L(),i=h("div"),r=h("div"),a=R(o),c=L(),u=h("div");for(let D=0;D<v.length;D+=1)v[D].c();d=L();for(let D=0;D<_.length;D+=1)_[D].c();p=ge(),m(t,"class","mx-3 my-2"),m(r,"class","py-2 mr-3"),m(u,"class","d-flex ml-auto mr-2"),m(i,"class","d-sm-flex align-items-center flex-grow-1"),m(e,"class","list-group-item d-flex align-items-sm-center p-0")},m(D,N){y(D,e,N),g(e,t),K(s,t,null),g(e,n),g(e,i),g(i,r),g(r,a),g(i,c),g(i,u);for(let I=0;I<v.length;I+=1)v[I]&&v[I].m(u,null);y(D,d,N);for(let I=0;I<_.length;I+=1)_[I]&&_[I].m(D,N);y(D,p,N),$=!0,w||(k=je(f=Ve.call(null,r,l[5].strings.allusers)),w=!0)},p(D,N){if((!$||N[0]&32)&&o!==(o=D[5].strings.allusers+"")&&F(a,o),f&&De(f.update)&&N[0]&32&&f.update.call(null,D[5].strings.allusers),N[0]&1062){C=ue(Object.values(qe));let I;for(I=0;I<C.length;I+=1){const H=Ys(D,C,I);v[I]?v[I].p(H,N):(v[I]=sl(H),v[I].c(),v[I].m(u,null))}for(;I<v.length;I+=1)v[I].d(1);v.length=C.length}N[0]&1062&&(T=ue(D[10]),ne(),_=ze(_,N,A,1,D,T,b,p.parentNode,We,nl,p,Ws),ie())},i(D){if(!$){S(s.$$.fragment,D);for(let N=0;N<T.length;N+=1)S(_[N]);$=!0}},o(D){z(s.$$.fragment,D);for(let N=0;N<_.length;N+=1)z(_[N]);$=!1},d(D){D&&(M(e),M(d),M(p)),V(s),Ee(v,D);for(let N=0;N<_.length;N+=1)_[N].d(D);w=!1,k()}}}function Gr(l){let e,t;return{c(){e=h("div"),t=R(l[11]),m(e,"class","list-group-item text-danger")},m(s,n){y(s,e,n),g(e,t)},p(s,n){n[0]&2048&&F(t,s[11])},i:G,o:G,d(s){s&&M(e)}}}function sl(l){let e,t=l[5].strings[l[32]]+"",s,n,i,r,o;function a(){return l[20](l[35],l[32])}return{c(){e=h("button"),s=R(t),n=L(),m(e,"type","button"),m(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),m(e,"aria-pressed",i=l[35]),O(e,"btn-primary",l[35]),O(e,"btn-secondary",!l[35])},m(f,c){y(f,e,c),g(e,s),g(e,n),r||(o=W(e,"click",a),r=!0)},p(f,c){l=f,c[0]&32&&t!==(t=l[5].strings[l[32]]+"")&&F(s,t),c[0]&1026&&i!==(i=l[35])&&m(e,"aria-pressed",i),c[0]&1026&&O(e,"btn-primary",l[35]),c[0]&1026&&O(e,"btn-secondary",!l[35])},d(f){f&&M(e),r=!1,o()}}}function ll(l){let e,t=l[5].strings[l[32]]+"",s,n,i,r,o;function a(){return l[22](l[28],l[29],l[32])}return{c(){e=h("button"),s=R(t),n=L(),m(e,"type","button"),m(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),m(e,"aria-pressed",i=l[29]==l[32]),O(e,"btn-primary",l[29]==l[32]),O(e,"btn-secondary",l[29]!=l[32])},m(f,c){y(f,e,c),g(e,s),g(e,n),r||(o=W(e,"click",a),r=!0)},p(f,c){l=f,c[0]&32&&t!==(t=l[5].strings[l[32]]+"")&&F(s,t),c[0]&1026&&i!==(i=l[29]==l[32])&&m(e,"aria-pressed",i),c[0]&1026&&O(e,"btn-primary",l[29]==l[32]),c[0]&1026&&O(e,"btn-secondary",l[29]!=l[32])},d(f){f&&M(e),r=!1,o()}}}function nl(l,e){let t,s,n,i,r,o,a=e[28].fullname+"",f,c,u,d,_;n=new ot({props:{user:e[28]}});let b=ue(Object.values(qe)),p=[];for(let $=0;$<b.length;$+=1)p[$]=ll(Xs(e,b,$));return{key:l,first:null,c(){t=h("div"),s=h("div"),J(n.$$.fragment),i=L(),r=h("div"),o=h("div"),f=R(a),c=L(),u=h("div");for(let $=0;$<p.length;$+=1)p[$].c();d=L(),m(s,"class","mx-3 my-2"),m(o,"class","py-2 mr-3 align-self-center"),m(u,"class","d-flex ml-auto mr-2 align-self-start"),m(r,"class","d-sm-flex flex-grow-1"),m(t,"class","list-group-item d-flex p-0"),this.first=t},m($,w){y($,t,w),g(t,s),K(n,s,null),g(t,i),g(t,r),g(r,o),g(o,f),g(r,c),g(r,u);for(let k=0;k<p.length;k+=1)p[k]&&p[k].m(u,null);g(t,d),_=!0},p($,w){e=$;const k={};if(w[0]&1024&&(k.user=e[28]),n.$set(k),(!_||w[0]&1024)&&a!==(a=e[28].fullname+"")&&F(f,a),w[0]&1062){b=ue(Object.values(qe));let C;for(C=0;C<b.length;C+=1){const v=Xs(e,b,C);p[C]?p[C].p(v,w):(p[C]=ll(v),p[C].c(),p[C].m(u,null))}for(;C<p.length;C+=1)p[C].d(1);p.length=b.length}},i($){_||(S(n.$$.fragment,$),_=!0)},o($){z(n.$$.fragment,$),_=!1},d($){$&&M(t),V(n),Ee(p,$)}}}function Ur(l){let e,t,s,n,i,r=l[5].strings.allroles+"",o,a=[],f=new Map,c,u,d,_,b,p,$,w=ue(l[5].draftRoles??[]);const k=D=>D[41].id;for(let D=0;D<w.length;D+=1){let N=Zs(l,w,D),I=k(N);f.set(I,a[D]=xs(I,N))}let C=(l[5].draftGroups??[]).length>0&&el(l);const v=[Gr,Fr],T=[];function A(D,N){return D[11]?0:1}return d=A(l),_=T[d]=v[d](l),{c(){e=h("div"),t=h("div"),s=h("div"),n=h("select"),i=h("option"),o=R(r);for(let D=0;D<a.length;D+=1)a[D].c();c=L(),C&&C.c(),u=L(),_.c(),i.__value=0,Le(i,i.__value),m(n,"class","form-control text-truncate"),l[3]===void 0&&Ae(()=>l[16].call(n)),m(s,"class","flex-grow-1 mx-2"),m(t,"class","list-group-item d-sm-flex px-2 py-2"),m(e,"class","local-mail-draft-form-user-search-dropdown dropdown-menu dropdown-menu-left p-0 w-100 svelte-1lx0syh"),he(e,"min-width","18rem"),O(e,"show",l[6])},m(D,N){y(D,e,N),g(e,t),g(t,s),g(s,n),g(n,i),g(i,o);for(let I=0;I<a.length;I+=1)a[I]&&a[I].m(n,null);tt(n,l[3],!0),g(t,c),C&&C.m(t,null),g(e,u),T[d].m(e,null),b=!0,p||($=[W(n,"change",l[16]),W(n,"change",l[17])],p=!0)},p(D,N){(!b||N[0]&32)&&r!==(r=D[5].strings.allroles+"")&&F(o,r),N[0]&32&&(w=ue(D[5].draftRoles??[]),a=ze(a,N,k,1,D,w,f,n,rt,xs,null,Zs)),N[0]&40&&tt(n,D[3]),(D[5].draftGroups??[]).length>0?C?C.p(D,N):(C=el(D),C.c(),C.m(t,null)):C&&(C.d(1),C=null);let I=d;d=A(D),d===I?T[d].p(D,N):(ne(),z(T[I],1,1,()=>{T[I]=null}),ie(),_=T[d],_?_.p(D,N):(_=T[d]=v[d](D),_.c()),S(_,1),_.m(e,null)),(!b||N[0]&64)&&O(e,"show",D[6])},i(D){b||(S(_),b=!0)},o(D){z(_),b=!1},d(D){D&&M(e);for(let N=0;N<a.length;N+=1)a[N].d();C&&C.d(),T[d].d(),p=!1,Me($)}}}function Hr(l){let e,t,s,n;function i(o){l[25](o)}let r={mode:"input",inputPlaceholder:l[5].strings.addrecipients,leftIconClass:l[9]?"fa-spinner fa-pulse":"fa-user",rightIconClass:l[7]?"fa-times":l[6]?"fa-caret-up":"fa-caret-down",rightIconLabel:l[5].strings.addrecipients,onRightIconClick:l[12],invalid:!l[1].size,onFocus:l[15],onBlur:l[14],onInput:l[23],$$slots:{default:[Ur]},$$scope:{ctx:l}};return l[7]!==void 0&&(r.inputText=l[7]),t=new Vl({props:r}),l[24](t),Se.push(()=>Ge(t,"inputText",i)),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","form-group")},m(o,a){y(o,e,a),K(t,e,null),n=!0},p(o,a){const f={};a[0]&32&&(f.inputPlaceholder=o[5].strings.addrecipients),a[0]&512&&(f.leftIconClass=o[9]?"fa-spinner fa-pulse":"fa-user"),a[0]&192&&(f.rightIconClass=o[7]?"fa-times":o[6]?"fa-caret-up":"fa-caret-down"),a[0]&32&&(f.rightIconLabel=o[5].strings.addrecipients),a[0]&2&&(f.invalid=!o[1].size),a[0]&3198|a[1]&8192&&(f.$$scope={dirty:a,ctx:o}),!s&&a[0]&128&&(s=!0,f.inputText=o[7],Ue(()=>s=!1)),t.$set(f)},i(o){n||(S(t.$$.fragment,o),n=!0)},o(o){z(t.$$.fragment,o),n=!1},d(o){o&&M(e),l[24](null),V(t)}}}const Or=500;function Jr(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,U=>t(5,n=U)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{recipients:a}=e,{onChange:f}=e,c=!1,u="",d,_=!1,b,p=[],$="",w=0,k=0;const C=async()=>{c?(t(7,u=""),t(6,c=!1),window.clearTimeout(b)):(v(!1),d.focus())},v=async U=>{var le;const te=n.settings.usersearchlimit;if(t(9,_=!0),window.clearTimeout(b),(s==null?void 0:s.groupmode)!=xl.No&&!((le=n.draftGroups)!=null&&le.length)){t(9,_=!1),t(6,c=!0),t(11,$=n.strings.errornogroups);return}b=window.setTimeout(async()=>{const j={methodname:"search_users",query:{courseid:(s==null?void 0:s.id)||0,fullname:u,roleid:w,groupid:k},limit:te+1};let B;try{B=await Ct([j])}catch(Y){o.setError(Y);return}B!=null&&(t(10,p=B.pop()),p.length?p.length>te?t(11,$=n.strings.toomanyusersfound):t(11,$=""):t(11,$=n.strings.nousersfound),t(10,p=p.slice(0,te)),t(9,_=!1),t(6,c=!0))},U?Or:0)},T=()=>{t(7,u=""),t(6,c=!1)},A=()=>{c||v(!1)};function D(){w=bt(this),t(3,w),t(5,n)}const N=()=>v(!1);function I(){k=bt(this),t(4,k),t(5,n)}const H=()=>v(!1),P=(U,te)=>f(p,U?null:te),q=(U,te)=>{var le;return((le=a.get(te.id))==null?void 0:le.type)==U},Z=(U,te,le)=>f([U],te==le?null:le),se=()=>v(!0);function X(U){Se[U?"unshift":"push"](()=>{d=U,t(8,d)})}function ee(U){u=U,t(7,u)}return l.$$set=U=>{"store"in U&&r(t(0,o=U.store)),"recipients"in U&&t(1,a=U.recipients),"onChange"in U&&t(2,f=U.onChange)},l.$$.update=()=>{var U,te,le,j,B;l.$$.dirty[0]&32&&(s=(U=n.message)==null?void 0:U.course),l.$$.dirty[0]&40&&t(3,w=(te=n.draftRoles)!=null&&te.find(Y=>Y.id==w)?w:0),l.$$.dirty[0]&48&&t(4,k=(le=n.draftGroups)!=null&&le.find(Y=>Y.id==k)?k:((B=(j=n.draftGroups)==null?void 0:j[0])==null?void 0:B.id)||0)},[o,a,f,w,k,n,c,u,d,_,p,$,C,v,T,A,D,N,I,H,P,q,Z,se,X,ee]}class Kr extends oe{constructor(e){super(),fe(this,e,Jr,Hr,re,{store:0,recipients:1,onChange:2},null,[-1,-1])}}function Vr(l){let e,t,s,n=l[1].strings.send+"",i,r,o,a;return{c(){e=h("button"),t=h("i"),s=L(),i=R(n),m(t,"class","fa fa-send mr-2"),m(e,"type","button"),m(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),m(e,"title",r=l[1].strings.send)},m(f,c){y(f,e,c),g(e,t),g(e,s),g(e,i),o||(a=W(e,"click",l[2]),o=!0)},p(f,[c]){c&2&&n!==(n=f[1].strings.send+"")&&F(i,n),c&2&&r!==(r=f[1].strings.send)&&m(e,"title",r)},i:G,o:G,d(f){f&&M(e),o=!1,a()}}}function Wr(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.sendMessage();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class vn extends oe{constructor(e){super(),fe(this,e,Wr,Vr,re,{store:0})}}const{Map:Xr}=at;function il(l,e,t){const s=l.slice();return s[18]=e[t],s}function rl(l){let e,t,s,n=l[7].strings.errorinvalidrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=R(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,o){y(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&F(i,n)},d(r){r&&M(e)}}}function Yr(l){let e,t,s,n=Ie(l[7].strings.errortoomanyrecipients,l[7].settings.maxrecipients)+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=R(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,o){y(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=Ie(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&F(i,n)},d(r){r&&M(e)}}}function Qr(l){let e,t,s,n=l[7].strings.erroremptyrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=R(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,o){y(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&F(i,n)},d(r){r&&M(e)}}}function al(l){let e,t,s,n=l[7].strings.erroremptysubject+"",i;return{c(){e=h("div"),t=h("i"),s=L(),i=R(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,o){y(r,e,o),g(e,t),g(e,s),g(e,i)},p(r,o){o&128&&n!==(n=r[7].strings.erroremptysubject+"")&&F(i,n)},d(r){r&&M(e)}}}function ol(l){let e,t=l[7].strings.references+"",s,n,i=[],r=new Xr,o,a,f=ue(l[1].references);const c=u=>u[18].id;for(let u=0;u<f.length;u+=1){let d=il(l,f,u),_=c(d);r.set(_,i[u]=fl(_,d))}return{c(){e=h("div"),s=R(t),n=L();for(let u=0;u<i.length;u+=1)i[u].c();o=ge(),m(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(u,d){y(u,e,d),g(e,s),y(u,n,d);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(u,d);y(u,o,d),a=!0},p(u,d){(!a||d&128)&&t!==(t=u[7].strings.references+"")&&F(s,t),d&130&&(f=ue(u[1].references),ne(),i=ze(i,d,c,1,u,f,r,o.parentNode,We,fl,o,il),ie())},i(u){if(!a){for(let d=0;d<f.length;d+=1)S(i[d]);a=!0}},o(u){for(let d=0;d<i.length;d+=1)z(i[d]);a=!1},d(u){u&&(M(e),M(n),M(o));for(let d=0;d<i.length;d+=1)i[d].d(u)}}}function fl(l,e){let t,s,n;return s=new hn({props:{strings:e[7].strings,reference:e[18]}}),{key:l,first:null,c(){t=ge(),J(s.$$.fragment),this.first=t},m(i,r){y(i,t,r),K(s,i,r),n=!0},p(i,r){e=i;const o={};r&128&&(o.strings=e[7].strings),r&2&&(o.reference=e[18]),s.$set(o)},i(i){n||(S(s.$$.fragment,i),n=!0)},o(i){z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(s,i)}}}function Zr(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p,$,w,k,C,v,T,A,D=l[2].editorhtml+"",N,I,H=l[2].filemanagerhtml+"",P,q=Array.from(l[5].values()).some(ul),Z,se,X=!l[4].trim(),ee,U,te,le=l[7].strings.save+"",j,B,Y,E,de,x,ve,we,ke;e=new gn({props:{javascript:l[2].javascript}}),r=new Er({props:{store:l[0],message:l[1]}}),c=new Wl({props:{settings:l[7].settings,strings:l[7].strings,courses:l[7].courses,label:l[7].strings.course,selected:l[6],required:!0,readonly:l[1].references.length>0,onChange:l[8]}}),_=new Kr({props:{store:l[0],recipients:l[5],onChange:l[9]}}),p=new Ir({props:{store:l[0],recipients:l[5],onDelete:l[10]}});let ce=q&&rl(l);function Ce(Q,me){if(Q[5].size==0)return Qr;if(Q[5].size>Q[7].settings.maxrecipients)return Yr}let Te=Ce(l),$e=Te&&Te(l),be=X&&al(l);E=new vn({props:{store:l[0]}});let pe=l[1].references.length>0&&ol(l);return{c(){J(e.$$.fragment),t=L(),s=h("hr"),n=L(),i=h("form"),J(r.$$.fragment),o=L(),a=h("div"),f=h("div"),J(c.$$.fragment),u=L(),d=h("div"),J(_.$$.fragment),b=L(),J(p.$$.fragment),$=L(),w=h("div"),k=h("input"),T=L(),A=h("div"),N=L(),I=h("div"),P=L(),ce&&ce.c(),Z=L(),$e&&$e.c(),se=L(),be&&be.c(),ee=L(),U=h("div"),te=h("button"),j=R(le),Y=L(),J(E.$$.fragment),de=L(),pe&&pe.c(),x=ge(),m(s,"class","d-lg-none mt-0 mb-3 mb-sm-2"),m(f,"class","form-group col-12 col-xl-5"),m(d,"class","col-12 col-xl-7"),m(a,"class","row"),m(k,"type","text"),m(k,"id","local-mail-message-form-subject"),m(k,"class","form-control"),m(k,"placeholder",C=l[7].strings.subject),m(k,"aria-label",v=l[7].strings.subject),m(k,"autocomplete","off"),m(k,"maxlength","100"),O(k,"is-invalid",!l[4].trim()),m(w,"class","form-group"),m(A,"class","form-group"),m(I,"class","form-group"),m(te,"type","submit"),m(te,"class","btn btn-secondary flex-shrink-0 text-nowrap px-3 text-truncate"),m(te,"title",B=l[7].strings.send),m(U,"class","d-flex justify-content-end align-items-center"),m(i,"class","pt-lg-2 pb-3 px-lg-4"),O(i,"card",l[7].viewportSize>=ae.LG)},m(Q,me){K(e,Q,me),y(Q,t,me),y(Q,s,me),y(Q,n,me),y(Q,i,me),K(r,i,null),g(i,o),g(i,a),g(a,f),K(c,f,null),g(a,u),g(a,d),K(_,d,null),g(i,b),K(p,i,null),g(i,$),g(i,w),g(w,k),Le(k,l[4]),g(i,T),g(i,A),A.innerHTML=D,g(i,N),g(i,I),I.innerHTML=H,g(i,P),ce&&ce.m(i,null),g(i,Z),$e&&$e.m(i,null),g(i,se),be&&be.m(i,null),g(i,ee),g(i,U),g(U,te),g(te,j),g(U,Y),K(E,U,null),l[16](i),y(Q,de,me),pe&&pe.m(Q,me),y(Q,x,me),ve=!0,we||(ke=[W(k,"input",l[13]),W(k,"input",l[14]),W(A,"change",l[15]),W(i,"submit",Be(l[11]))],we=!0)},p(Q,[me]){const st={};me&4&&(st.javascript=Q[2].javascript),e.$set(st);const Ye={};me&1&&(Ye.store=Q[0]),me&2&&(Ye.message=Q[1]),r.$set(Ye);const Ne={};me&128&&(Ne.settings=Q[7].settings),me&128&&(Ne.strings=Q[7].strings),me&128&&(Ne.courses=Q[7].courses),me&128&&(Ne.label=Q[7].strings.course),me&64&&(Ne.selected=Q[6]),me&2&&(Ne.readonly=Q[1].references.length>0),c.$set(Ne);const Qe={};me&1&&(Qe.store=Q[0]),me&32&&(Qe.recipients=Q[5]),_.$set(Qe);const Ze={};me&1&&(Ze.store=Q[0]),me&32&&(Ze.recipients=Q[5]),p.$set(Ze),(!ve||me&128&&C!==(C=Q[7].strings.subject))&&m(k,"placeholder",C),(!ve||me&128&&v!==(v=Q[7].strings.subject))&&m(k,"aria-label",v),me&16&&k.value!==Q[4]&&Le(k,Q[4]),(!ve||me&16)&&O(k,"is-invalid",!Q[4].trim()),(!ve||me&4)&&D!==(D=Q[2].editorhtml+"")&&(A.innerHTML=D),(!ve||me&4)&&H!==(H=Q[2].filemanagerhtml+"")&&(I.innerHTML=H),me&32&&(q=Array.from(Q[5].values()).some(ul)),q?ce?ce.p(Q,me):(ce=rl(Q),ce.c(),ce.m(i,Z)):ce&&(ce.d(1),ce=null),Te===(Te=Ce(Q))&&$e?$e.p(Q,me):($e&&$e.d(1),$e=Te&&Te(Q),$e&&($e.c(),$e.m(i,se))),me&16&&(X=!Q[4].trim()),X?be?be.p(Q,me):(be=al(Q),be.c(),be.m(i,ee)):be&&(be.d(1),be=null),(!ve||me&128)&&le!==(le=Q[7].strings.save+"")&&F(j,le),(!ve||me&128&&B!==(B=Q[7].strings.send))&&m(te,"title",B);const lt={};me&1&&(lt.store=Q[0]),E.$set(lt),(!ve||me&128)&&O(i,"card",Q[7].viewportSize>=ae.LG),Q[1].references.length>0?pe?(pe.p(Q,me),me&2&&S(pe,1)):(pe=ol(Q),pe.c(),S(pe,1),pe.m(x.parentNode,x)):pe&&(ne(),z(pe,1,1,()=>{pe=null}),ie())},i(Q){ve||(S(e.$$.fragment,Q),S(r.$$.fragment,Q),S(c.$$.fragment,Q),S(_.$$.fragment,Q),S(p.$$.fragment,Q),S(E.$$.fragment,Q),S(pe),ve=!0)},o(Q){z(e.$$.fragment,Q),z(r.$$.fragment,Q),z(c.$$.fragment,Q),z(_.$$.fragment,Q),z(p.$$.fragment,Q),z(E.$$.fragment,Q),z(pe),ve=!1},d(Q){Q&&(M(t),M(s),M(n),M(i),M(de),M(x)),V(e,Q),V(r),V(c),V(_),V(p),ce&&ce.d(),$e&&$e.d(),be&&be.d(),V(E),l[16](null),pe&&pe.d(Q),we=!1,Me(ke)}}}const ul=l=>!l.isvalid;function xr(l,e,t){let s,n,i,r,o=G,a=()=>(o(),o=_e(f,D=>t(7,r=D)),f);l.$$.on_destroy.push(()=>o());let{store:f}=e;a();let{message:c}=e,{form:u}=e,d;dt(()=>{d==null||d.addEventListener("core_form/uploadChanged",()=>k());const D=_();return()=>{D()}});const _=()=>{let D,N;const I=()=>{N==null||N.options.set("tiny_autosave/plugin:autosaveHasReset",!0),N==null||N.save(),k()},H=q=>{q.command!="mceFocus"&&I()},P=q=>{q.editor.id==`local-mail-compose-editor-${c.id}`&&(N==null||N.off("input",I),N==null||N.off("ExecCommand",H),N=q.editor,q.editor.on("input",I),q.editor.on("ExecCommand",H))};return _t("editor_tiny/loader").then(async q=>{D=await q.getTinyMCE(),D.EditorManager.get().forEach(Z=>P({editor:Z})),D.EditorManager.on("SetupEditor",P)}),()=>{D==null||D.EditorManager.off("SetupEditor",P),N==null||N.off("input",I),N==null||N.off("ExecCommand",H)}},b=D=>{t(6,s=D||r.courses[0].id),k(),f.navigate({...r.params,courseid:r.params.courseid?s:void 0},!0)},p=(D,N)=>{const I=new Map(i);for(const P of D)N?I.set(P.id,{...P,type:N,isvalid:!0}):I.delete(P.id);const H=Array.from(I.values());H.sort((P,q)=>P.sortorder.localeCompare(q.sortorder)),t(5,i=new Map(H.map(P=>[P.id,P]))),k()},$=D=>{p([D],null)},w=()=>{k(),f.navigateToList()},k=()=>{var I,H,P;if(!d)return;const D=new FormData(d),N={courseid:s,to:Array.from(i.values()).filter(q=>q.type=="to").map(q=>q.id),cc:Array.from(i.values()).filter(q=>q.type=="cc").map(q=>q.id),bcc:Array.from(i.values()).filter(q=>q.type=="bcc").map(q=>q.id),subject:n,content:((I=D.get("content[text]"))==null?void 0:I.toString())||"",format:parseInt(((H=D.get("content[format]"))==null?void 0:H.toString())||"")||1,draftitemid:parseInt(((P=D.get("content[itemid]"))==null?void 0:P.toString())||"")||0};f.updateDraft(N,!1)};function C(){n=this.value,t(4,n),t(1,c)}const v=()=>k(),T=()=>k();function A(D){Se[D?"unshift":"push"](()=>{d=D,t(3,d)})}return l.$$set=D=>{"store"in D&&a(t(0,f=D.store)),"message"in D&&t(1,c=D.message),"form"in D&&t(2,u=D.form)},l.$$.update=()=>{l.$$.dirty&2&&t(6,s=c.course.id),l.$$.dirty&2&&t(4,n=c.subject),l.$$.dirty&2&&t(5,i=new Map(c.recipients.map(D=>[D.id,D])))},[f,c,u,d,n,i,s,r,b,p,$,w,k,C,v,T,A]}class ea extends oe{constructor(e){super(),fe(this,e,xr,Zr,re,{store:0,message:1,form:2})}}function cl(l,e,t){const s=l.slice();return s[7]=e[t],s}function ml(l){let e,t=l[7]+"",s,n;return{c(){e=h("option"),s=R(t),e.__value=n=l[7],Le(e,e.__value)},m(i,r){y(i,e,r),g(e,s)},p(i,r){r&8&&t!==(t=i[7]+"")&&F(s,t),r&8&&n!==(n=i[7])&&(e.__value=n,Le(e,e.__value))},d(i){i&&M(e)}}}function ta(l){let e,t,s,n=l[1].strings.messagesperpage+"",i,r,o,a,f,c,u=ue(l[3]),d=[];for(let _=0;_<u.length;_+=1)d[_]=ml(cl(l,u,_));return{c(){e=h("div"),t=h("div"),s=h("label"),i=R(n),r=R(":"),o=L(),a=h("select");for(let _=0;_<d.length;_+=1)d[_].c();m(s,"for","local-mail-perpage-select"),m(a,"id","local-mail-perpage-select"),m(a,"class","custom-select"),l[2]===void 0&&Ae(()=>l[4].call(a)),m(t,"class","form-group"),m(e,"class","form-inline justify-content-end mt-3")},m(_,b){y(_,e,b),g(e,t),g(t,s),g(s,i),g(s,r),g(t,o),g(t,a);for(let p=0;p<d.length;p+=1)d[p]&&d[p].m(a,null);tt(a,l[2],!0),f||(c=[W(a,"change",l[4]),W(a,"change",l[5])],f=!0)},p(_,[b]){if(b&2&&n!==(n=_[1].strings.messagesperpage+"")&&F(i,n),b&8){u=ue(_[3]);let p;for(p=0;p<u.length;p+=1){const $=cl(_,u,p);d[p]?d[p].p($,b):(d[p]=ml($),d[p].c(),d[p].m(a,null))}for(;p<d.length;p+=1)d[p].d(1);d.length=u.length}b&12&&tt(a,_[2])},i:G,o:G,d(_){_&&M(e),Ee(d,_),f=!1,Me(c)}}}function sa(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,d=>t(1,n=d)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();const a=[5,10,20,50,100];let f=n.preferences.perpage;function c(){f=bt(this),t(2,f),t(3,s),t(1,n)}const u=()=>o.savePreferences({perpage:f});return l.$$set=d=>{"store"in d&&r(t(0,o=d.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=a.includes(n.preferences.perpage)?a:a.concat([n.preferences.perpage]).sort((d,_)=>d-_))},[o,n,f,s,c,u]}class la extends oe{constructor(e){super(),fe(this,e,sa,ta,re,{store:0})}}function dl(l,e,t){const s=l.slice();return s[9]=e[t],s}function _l(l){let e,t,s=l[4].strings.locked+"",n,i;return{c(){e=h("span"),t=R("("),n=R(s),i=R(")"),m(e,"class","ml-1")},m(r,o){y(r,e,o),g(e,t),g(e,n),g(e,i)},p(r,o){o&16&&s!==(s=r[4].strings.locked+"")&&F(n,s)},d(r){r&&M(e)}}}function gl(l){let e,t,s,n,i,r,o,a=l[9].displayname+"",f,c,u,d,_;function b(){return l[8](l[9])}let p=l[9].locked&&_l(l);return{c(){e=h("div"),t=h("input"),r=L(),o=h("label"),f=R(a),c=L(),p&&p.c(),m(t,"id",s="local-mail-preferences-messageprocessor-"+l[9].name),m(t,"class","custom-control-input"),m(t,"type","checkbox"),t.checked=n=l[9].locked?l[9].enabled:l[3].includes(l[9].name),t.disabled=i=l[9].locked,m(o,"for",u="local-mail-preferences-messageprocessor-"+l[9].name),m(o,"class","custom-control-label pl-1"),m(e,"class","custom-control custom-switch my-2")},m($,w){y($,e,w),g(e,t),g(e,r),g(e,o),g(o,f),g(o,c),p&&p.m(o,null),d||(_=W(t,"click",b),d=!0)},p($,w){l=$,w&16&&s!==(s="local-mail-preferences-messageprocessor-"+l[9].name)&&m(t,"id",s),w&24&&n!==(n=l[9].locked?l[9].enabled:l[3].includes(l[9].name))&&(t.checked=n),w&16&&i!==(i=l[9].locked)&&(t.disabled=i),w&16&&a!==(a=l[9].displayname+"")&&F(f,a),l[9].locked?p?p.p(l,w):(p=_l(l),p.c(),p.m(o,null)):p&&(p.d(1),p=null),w&16&&u!==(u="local-mail-preferences-messageprocessor-"+l[9].name)&&m(o,"for",u)},d($){$&&M(e),p&&p.d(),d=!1,_()}}}function na(l){let e,t=l[4].strings.notifications+"",s,n,i,r,o,a,f,c,u,d=l[4].strings.markmessagesasread+"",_,b,p,$=ue(l[4].settings.messageprocessors),w=[];for(let k=0;k<$.length;k+=1)w[k]=gl(dl(l,$,k));return{c(){e=h("h6"),s=R(t),n=L();for(let k=0;k<w.length;k+=1)w[k].c();i=L(),r=h("div"),o=h("input"),c=L(),u=h("label"),_=R(d),m(e,"class","mb-3"),m(o,"id","local-mail-preferences-markasread"),m(o,"class","custom-control-input"),m(o,"type","checkbox"),o.checked=a=l[2]&&l[3].length>0,o.disabled=f=l[3].length==0,m(u,"for","local-mail-preferences-markasread"),m(u,"class","custom-control-label pl-1"),m(r,"class","custom-control custom-switch my-2 mt-3")},m(k,C){y(k,e,C),g(e,s),y(k,n,C);for(let v=0;v<w.length;v+=1)w[v]&&w[v].m(k,C);y(k,i,C),y(k,r,C),g(r,o),g(r,c),g(r,u),g(u,_),b||(p=W(o,"click",l[6]),b=!0)},p(k,C){if(C&16&&t!==(t=k[4].strings.notifications+"")&&F(s,t),C&152){$=ue(k[4].settings.messageprocessors);let v;for(v=0;v<$.length;v+=1){const T=dl(k,$,v);w[v]?w[v].p(T,C):(w[v]=gl(T),w[v].c(),w[v].m(i.parentNode,i))}for(;v<w.length;v+=1)w[v].d(1);w.length=$.length}C&12&&a!==(a=k[2]&&k[3].length>0)&&(o.checked=a),C&8&&f!==(f=k[3].length==0)&&(o.disabled=f),C&16&&d!==(d=k[4].strings.markmessagesasread+"")&&F(_,d)},d(k){k&&(M(e),M(n),M(i),M(r)),Ee(w,k),b=!1,p()}}}function ia(l){let e,t;return e=new Xe({props:{title:l[4].strings.preferences,confirmText:l[4].strings.save,cancelText:l[4].strings.cancel,onConfirm:l[5],onCancel:l[1],$$slots:{default:[na]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,[n]){const i={};n&16&&(i.title=s[4].strings.preferences),n&16&&(i.confirmText=s[4].strings.save),n&16&&(i.cancelText=s[4].strings.cancel),n&2&&(i.onCancel=s[1]),n&4124&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function ra(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,b=>t(4,s=b)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:o}=e,a=s.preferences.markasread,f=s.settings.messageprocessors.map(b=>b.name).filter(b=>s.preferences.notifications.includes(b));const c=()=>{o(),r.savePreferences({markasread:a,notifications:f})},u=()=>{t(2,a=!a)},d=b=>{t(3,f=f.includes(b)?f.filter(p=>p!=b):[...f,b])},_=b=>d(b.name);return l.$$set=b=>{"store"in b&&i(t(0,r=b.store)),"onCancel"in b&&t(1,o=b.onCancel)},[r,o,a,f,s,c,u,d,_]}class aa extends oe{constructor(e){super(),fe(this,e,ra,ia,re,{store:0,onCancel:1})}}function oa(l){let e,t,s,n;return{c(){e=h("button"),t=h("i"),m(t,"class","fa fa-fw fa-question-circle text-info"),m(t,"role","img"),m(t,"title",s=l[2].strings.help),m(e,"type","button"),m(e,"class","btn btn-help p-0"),m(e,"data-container","body"),m(e,"data-toggle","popover"),m(e,"data-placement","top"),m(e,"data-content",l[1]),m(e,"data-trigger","focus"),m(e,"aria-label",n=l[2].strings.help)},m(i,r){y(i,e,r),g(e,t)},p(i,[r]){r&4&&s!==(s=i[2].strings.help)&&m(t,"title",s),r&2&&m(e,"data-content",i[1]),r&4&&n!==(n=i[2].strings.help)&&m(e,"aria-label",n)},i:G,o:G,d(i){i&&M(e)}}}function fa(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(2,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:o}=e;return l.$$set=a=>{"store"in a&&i(t(0,r=a.store)),"message"in a&&t(1,o=a.message)},[r,o,s]}class ua extends oe{constructor(e){super(),fe(this,e,fa,oa,re,{store:0,message:1})}}function ca(l){let e,t,s,n=l[8].strings.searchfrom+"",i,r,o,a,f,c,u,d=l[8].strings.searchto+"",_,b,p,$,w,k,C,v=l[8].strings.searchdate+"",T,A,D,N,I,H,P,q,Z,se,X,ee,U=l[8].strings.searchunreadonly+"",te,le,j,B,Y,E,de=l[8].strings.searchhasattachments+"",x,ve,we,ke=l[8].strings.search+"",ce,Ce,Te,$e;return D=new ua({props:{store:l[4],message:l[8].strings.searchdatehelp}}),{c(){e=h("div"),t=h("div"),s=h("label"),i=R(n),r=L(),o=h("div"),a=h("input"),f=L(),c=h("div"),u=h("label"),_=R(d),b=L(),p=h("div"),$=h("input"),w=L(),k=h("div"),C=h("label"),T=R(v),A=L(),J(D.$$.fragment),N=L(),I=h("div"),H=h("input"),P=L(),q=h("div"),Z=h("div"),se=h("input"),X=L(),ee=h("label"),te=R(U),le=L(),j=h("div"),B=h("input"),Y=L(),E=h("label"),x=R(de),ve=L(),we=h("button"),ce=R(ke),m(s,"for","local-mail-search-input-sendername"),m(s,"class","col-4 col-form-label pr-0"),m(a,"type","text"),m(a,"class","form-control"),m(a,"id","local-mail-search-input-sendername"),m(o,"class","col-8"),m(t,"class","form-group row"),m(u,"for","local-mail-search-input-recipientname"),m(u,"class","col-4 col-form-label pr-0"),m($,"type","text"),m($,"class","form-control"),m($,"id","local-mail-search-input-recipientname"),m(p,"class","col-8 p"),m(c,"class","form-group row"),m(C,"for","local-mail-search-input-maxdate"),m(C,"class","col-4 col-form-label pr-0"),m(H,"type","date"),m(H,"class","form-control"),m(H,"id","local-mail-search-input-maxdate"),m(H,"max",l[9]),H.value=l[7],m(I,"class","col-8"),m(k,"class","form-group row"),m(se,"class","form-check-input"),m(se,"type","checkbox"),m(se,"id","local-mail-search-input-unread"),m(ee,"class","form-check-label"),m(ee,"for","local-mail-search-input-unread"),m(Z,"class","form-check"),m(B,"class","form-check-input"),m(B,"type","checkbox"),m(B,"id","local-mail-search-input-withfilesonly"),m(E,"class","form-check-label"),m(E,"for","local-mail-search-input-withfilesonly"),m(j,"class","form-check"),m(we,"type","button"),m(we,"class","btn btn-primary px-3 ml-auto"),m(q,"class","d-flex flex-wrap align-items-center"),he(q,"column-gap","2rem"),he(q,"row-gap","1rem"),m(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),he(e,"min-width","18rem")},m(be,pe){y(be,e,pe),g(e,t),g(t,s),g(s,i),g(t,r),g(t,o),g(o,a),Le(a,l[0]),l[16](a),g(e,f),g(e,c),g(c,u),g(u,_),g(c,b),g(c,p),g(p,$),Le($,l[1]),g(e,w),g(e,k),g(k,C),g(C,T),g(C,A),K(D,C,null),g(k,N),g(k,I),g(I,H),g(e,P),g(e,q),g(q,Z),g(Z,se),se.checked=l[2],g(Z,X),g(Z,ee),g(ee,te),g(q,le),g(q,j),g(j,B),B.checked=l[3],g(j,Y),g(j,E),g(E,x),g(q,ve),g(q,we),g(we,ce),Ce=!0,Te||($e=[W(a,"input",l[15]),W(a,"keyup",l[11]),W($,"input",l[17]),W($,"keyup",l[11]),W(H,"input",l[10]),W(H,"keyup",l[11]),W(se,"change",l[18]),W(se,"keyup",l[11]),W(B,"change",l[19]),W(B,"keyup",l[11]),W(we,"click",function(){De(l[5])&&l[5].apply(this,arguments)}),W(we,"keyup",l[11])],Te=!0)},p(be,[pe]){l=be,(!Ce||pe&256)&&n!==(n=l[8].strings.searchfrom+"")&&F(i,n),pe&1&&a.value!==l[0]&&Le(a,l[0]),(!Ce||pe&256)&&d!==(d=l[8].strings.searchto+"")&&F(_,d),pe&2&&$.value!==l[1]&&Le($,l[1]),(!Ce||pe&256)&&v!==(v=l[8].strings.searchdate+"")&&F(T,v);const Q={};pe&16&&(Q.store=l[4]),pe&256&&(Q.message=l[8].strings.searchdatehelp),D.$set(Q),(!Ce||pe&128)&&(H.value=l[7]),pe&4&&(se.checked=l[2]),(!Ce||pe&256)&&U!==(U=l[8].strings.searchunreadonly+"")&&F(te,U),pe&8&&(B.checked=l[3]),(!Ce||pe&256)&&de!==(de=l[8].strings.searchhasattachments+"")&&F(x,de),(!Ce||pe&256)&&ke!==(ke=l[8].strings.search+"")&&F(ce,ke)},i(be){Ce||(S(D.$$.fragment,be),Ce=!0)},o(be){z(D.$$.fragment,be),Ce=!1},d(be){be&&M(e),l[16](null),V(D),Te=!1,Me($e)}}}function ma(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,I=>t(8,n=I)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let{sendername:a=""}=e,{recipientname:f=""}=e,{unread:c=!1}=e,{withfilesonly:u=!1}=e,{maxtime:d=0}=e,{onSubmit:_}=e,{onCancel:b}=e;function p(){$.focus()}let $,w=Nt(Math.floor(new Date().getTime()/1e3));const k=I=>{t(12,d=Tn(I.target.value))},C=I=>{I.key=="Enter"?_():I.key=="Escape"&&b()};function v(){a=this.value,t(0,a)}function T(I){Se[I?"unshift":"push"](()=>{$=I,t(6,$)})}function A(){f=this.value,t(1,f)}function D(){c=this.checked,t(2,c)}function N(){u=this.checked,t(3,u)}return l.$$set=I=>{"store"in I&&r(t(4,o=I.store)),"sendername"in I&&t(0,a=I.sendername),"recipientname"in I&&t(1,f=I.recipientname),"unread"in I&&t(2,c=I.unread),"withfilesonly"in I&&t(3,u=I.withfilesonly),"maxtime"in I&&t(12,d=I.maxtime),"onSubmit"in I&&t(5,_=I.onSubmit),"onCancel"in I&&t(13,b=I.onCancel)},l.$$.update=()=>{l.$$.dirty&4096&&t(7,s=Nt(d))},[a,f,c,u,o,_,$,s,n,w,k,C,d,b,p,v,T,A,D,N]}class da extends oe{constructor(e){super(),fe(this,e,ma,ca,re,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,onSubmit:5,onCancel:13,focus:14})}get focus(){return this.$$.ctx[14]}}const{Boolean:_a}=at;function pl(l,e,t){const s=l.slice();return s[14]=e[t],s[16]=t,s}function bl(l){let e,t,s,n=ue(l[4]),i=[];for(let c=0;c<n.length;c+=1)i[c]=hl(pl(l,n,c));const r=c=>z(i[c],1,1,()=>{i[c]=null});function o(c,u){if(c[5])return ba;if(!c[4].length)return pa}let a=o(l),f=a&&a(l);return{c(){e=h("div");for(let c=0;c<i.length;c+=1)i[c].c();t=L(),f&&f.c(),m(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),he(e,"min-width","18rem")},m(c,u){y(c,e,u);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null);g(e,t),f&&f.m(e,null),s=!0},p(c,u){if(u&401){n=ue(c[4]);let d;for(d=0;d<n.length;d+=1){const _=pl(c,n,d);i[d]?(i[d].p(_,u),S(i[d],1)):(i[d]=hl(_),i[d].c(),S(i[d],1),i[d].m(e,t))}for(ne(),d=n.length;d<i.length;d+=1)r(d);ie()}a===(a=o(c))&&f?f.p(c,u):(f&&f.d(1),f=a&&a(c),f&&(f.c(),f.m(e,null)))},i(c){if(!s){for(let u=0;u<n.length;u+=1)S(i[u]);s=!0}},o(c){i=i.filter(_a);for(let u=0;u<i.length;u+=1)z(i[u]);s=!1},d(c){c&&M(e),Ee(i,c),f&&f.d()}}}function ga(l){let e;return{c(){e=h("div"),m(e,"class","dropdown-divider my-0")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function hl(l){let e,t,s,n,i,r,o,a,f=l[14].shorttime+"",c,u,d,_,b,p,$=l[16]>0&&ga();return s=new $t({props:{store:l[0],message:l[14]}}),r=new wt({props:{store:l[0],message:l[14]}}),{c(){$&&$.c(),e=L(),t=h("a"),J(s.$$.fragment),n=L(),i=h("div"),J(r.$$.fragment),o=L(),a=h("div"),c=R(f),m(a,"title",u=l[14].fulltime),m(a,"class","ml-auto"),m(i,"class","local-mail-incremental-search-muted d-flex svelte-sdeam0"),m(t,"class","dropdown-item local-mail-incremental-search-item"),m(t,"href",d=Oe(l[7](l[14],l[16]))),O(t,"font-weight-bold",l[14].unread)},m(w,k){$&&$.m(w,k),y(w,e,k),y(w,t,k),K(s,t,null),g(t,n),g(t,i),K(r,i,null),g(i,o),g(i,a),g(a,c),_=!0,b||(p=W(t,"click",function(){De(l[8](l[14],l[16]))&&l[8](l[14],l[16]).apply(this,arguments)}),b=!0)},p(w,k){l=w;const C={};k&1&&(C.store=l[0]),k&16&&(C.message=l[14]),s.$set(C);const v={};k&1&&(v.store=l[0]),k&16&&(v.message=l[14]),r.$set(v),(!_||k&16)&&f!==(f=l[14].shorttime+"")&&F(c,f),(!_||k&16&&u!==(u=l[14].fulltime))&&m(a,"title",u),(!_||k&144&&d!==(d=Oe(l[7](l[14],l[16]))))&&m(t,"href",d),(!_||k&16)&&O(t,"font-weight-bold",l[14].unread)},i(w){_||(S(s.$$.fragment,w),S(r.$$.fragment,w),_=!0)},o(w){z(s.$$.fragment,w),z(r.$$.fragment,w),_=!1},d(w){w&&(M(e),M(t)),$&&$.d(w),V(s),V(r),b=!1,p()}}}function pa(l){let e,t=l[3].strings.nomessagesfound+"",s;return{c(){e=h("div"),s=R(t),m(e,"class","px-4 py-2 text-danger")},m(n,i){y(n,e,i),g(e,s)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&F(s,t)},d(n){n&&M(e)}}}function ba(l){let e,t,s,n=l[3].strings.searchallmessages+"",i,r,o,a;return{c(){e=h("div"),t=L(),s=h("a"),i=R(n),m(e,"class","dropdown-divider my-0"),m(s,"class","dropdown-item py-2"),m(s,"href",r=Oe(l[6]))},m(f,c){y(f,e,c),y(f,t,c),y(f,s,c),g(s,i),o||(a=W(s,"click",Be(l[12])),o=!0)},p(f,c){c&8&&n!==(n=f[3].strings.searchallmessages+"")&&F(i,n),c&64&&r!==(r=Oe(f[6]))&&m(s,"href",r)},d(f){f&&(M(e),M(t),M(s)),o=!1,a()}}}function ha(l){let e,t,s=l[1]&&l[4]!=null&&bl(l);return{c(){s&&s.c(),e=ge()},m(n,i){s&&s.m(n,i),y(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?s?(s.p(n,i),i&18&&S(s,1)):(s=bl(n),s.c(),S(s,1),s.m(e.parentNode,e)):s&&(ne(),z(s,1,1,()=>{s=null}),ie())},i(n){t||(S(s),t=!0)},o(n){z(s),t=!1},d(n){n&&M(e),s&&s.d(n)}}}const pt=10,va=500;function ka(l,e,t){let s,n,i,r=G,o=()=>(r(),r=_e(a,C=>t(3,i=C)),a);l.$$.on_destroy.push(()=>r());let{store:a}=e;o();let{enabled:f}=e,{content:c}=e,{loading:u=!1}=e,{onClick:d}=e,_,b,p=!1;const $=async C=>{t(9,u=!0),window.clearTimeout(_),t(11,_=window.setTimeout(async()=>{const v=i.params,A={methodname:"search_messages",query:{courseid:v.courseid,labelid:v.tray=="label"?v.labelid:void 0,draft:v.tray=="drafts"?!0:v.tray=="sent"?!1:void 0,roles:v.tray=="inbox"?Object.values(qe):v.tray=="sent"?["from"]:void 0,starred:v.tray=="starred"?!0:void 0,deleted:v.tray=="trash",content:C.trim(),stopid:i.incrementalSearchStopId},limit:pt+1};let D;try{D=await Ct([A])}catch(N){a.setError(N);return}D!=null&&(t(9,u=!1),t(4,b=D[0]),t(5,p=b.length>pt||!!i.incrementalSearchStopId),t(4,b=b.slice(0,pt)))},va))},w=(C,v)=>T=>{C.draft||(T.preventDefault(),d(s(C,v)))};ht(()=>{window.clearTimeout(_)});const k=()=>d(n);return l.$$set=C=>{"store"in C&&o(t(0,a=C.store)),"enabled"in C&&t(1,f=C.enabled),"content"in C&&t(10,c=C.content),"loading"in C&&t(9,u=C.loading),"onClick"in C&&t(2,d=C.onClick)},l.$$.update=()=>{l.$$.dirty&3074&&(f?$(c):(t(4,b=void 0),t(9,u=!1),window.clearTimeout(_))),l.$$.dirty&1032&&t(7,s=(C,v)=>({...i.params,messageid:C.id,offset:v,search:{content:c.trim()}})),l.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:c.trim()}})},[a,f,d,i,b,p,n,s,w,u,c,_,k]}class wa extends oe{constructor(e){super(),fe(this,e,ka,ha,re,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function vl(l,e,t){const s=l.slice();return s[34]=e[t].label,s[35]=e[t].value,s[37]=t,s}function kl(l){let e,t,s,n,i,r,o;function a(b){l[25](b)}function f(b){l[26](b)}function c(b){l[27](b)}function u(b){l[28](b)}function d(b){l[29](b)}let _={store:l[0],onSubmit:l[15]?l[20]:l[19],onCancel:l[19]};return l[2]!==void 0&&(_.sendername=l[2]),l[3]!==void 0&&(_.recipientname=l[3]),l[4]!==void 0&&(_.unread=l[4]),l[5]!==void 0&&(_.withfilesonly=l[5]),l[6]!==void 0&&(_.maxtime=l[6]),e=new da({props:_}),l[24](e),Se.push(()=>Ge(e,"sendername",a)),Se.push(()=>Ge(e,"recipientname",f)),Se.push(()=>Ge(e,"unread",c)),Se.push(()=>Ge(e,"withfilesonly",u)),Se.push(()=>Ge(e,"maxtime",d)),{c(){J(e.$$.fragment)},m(b,p){K(e,b,p),o=!0},p(b,p){const $={};p[0]&1&&($.store=b[0]),p[0]&32768&&($.onSubmit=b[15]?b[20]:b[19]),!t&&p[0]&4&&(t=!0,$.sendername=b[2],Ue(()=>t=!1)),!s&&p[0]&8&&(s=!0,$.recipientname=b[3],Ue(()=>s=!1)),!n&&p[0]&16&&(n=!0,$.unread=b[4],Ue(()=>n=!1)),!i&&p[0]&32&&(i=!0,$.withfilesonly=b[5],Ue(()=>i=!1)),!r&&p[0]&64&&(r=!0,$.maxtime=b[6],Ue(()=>r=!1)),e.$set($)},i(b){o||(S(e.$$.fragment,b),o=!0)},o(b){z(e.$$.fragment,b),o=!1},d(b){l[24](null),V(e,b)}}}function wl(l){let e,t,s;function n(r){l[30](r)}let i={store:l[0],enabled:l[8]&&!l[9]&&!!l[1].trim(),content:l[1],onClick:l[21]};return l[12]!==void 0&&(i.loading=l[12]),e=new wa({props:i}),Se.push(()=>Ge(e,"loading",n)),{c(){J(e.$$.fragment)},m(r,o){K(e,r,o),s=!0},p(r,o){const a={};o[0]&1&&(a.store=r[0]),o[0]&770&&(a.enabled=r[8]&&!r[9]&&!!r[1].trim()),o[0]&2&&(a.content=r[1]),!t&&o[0]&4096&&(t=!0,a.loading=r[12],Ue(()=>t=!1)),e.$set(a)},i(r){s||(S(e.$$.fragment,r),s=!0)},o(r){z(e.$$.fragment,r),s=!1},d(r){V(e,r)}}}function $a(l){let e,t,s,n=l[9]&&kl(l),i=l[7].settings.incrementalsearch&&wl(l);return{c(){n&&n.c(),e=L(),i&&i.c(),t=ge()},m(r,o){n&&n.m(r,o),y(r,e,o),i&&i.m(r,o),y(r,t,o),s=!0},p(r,o){r[9]?n?(n.p(r,o),o[0]&512&&S(n,1)):(n=kl(r),n.c(),S(n,1),n.m(e.parentNode,e)):n&&(ne(),z(n,1,1,()=>{n=null}),ie()),r[7].settings.incrementalsearch?i?(i.p(r,o),o[0]&128&&S(i,1)):(i=wl(r),i.c(),S(i,1),i.m(t.parentNode,t)):i&&(ne(),z(i,1,1,()=>{i=null}),ie())},i(r){s||(S(n),S(i),s=!0)},o(r){z(n),z(i),s=!1},d(r){r&&(M(e),M(t)),n&&n.d(r),i&&i.d(r)}}}function ya(l){let e;return{c(){e=h("span"),e.textContent=", ",m(e,"class","dimmed_text")},m(t,s){y(t,e,s)},d(t){t&&M(e)}}}function Ma(l){let e,t=l[35]+"",s,n=l[34]&&$l(l);return{c(){n&&n.c(),e=L(),s=R(t)},m(i,r){n&&n.m(i,r),y(i,e,r),y(i,s,r)},p(i,r){i[34]?n?n.p(i,r):(n=$l(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&16384&&t!==(t=i[35]+"")&&F(s,t)},d(i){i&&(M(e),M(s)),n&&n.d(i)}}}function Ca(l){let e,t=l[34]+"",s;return{c(){e=h("span"),s=R(t),m(e,"class","dimmed_text")},m(n,i){y(n,e,i),g(e,s)},p(n,i){i[0]&16384&&t!==(t=n[34]+"")&&F(s,t)},d(n){n&&M(e)}}}function $l(l){let e,t=l[34]+"",s,n;return{c(){e=h("span"),s=R(t),n=R(":"),m(e,"class","dimmed_text")},m(i,r){y(i,e,r),g(e,s),g(e,n)},p(i,r){r[0]&16384&&t!==(t=i[34]+"")&&F(s,t)},d(i){i&&M(e)}}}function yl(l){let e,t,s=l[37]>0&&ya();function n(o,a){return o[35]===!0?Ca:Ma}let i=n(l),r=i(l);return{c(){s&&s.c(),e=L(),r.c(),t=ge()},m(o,a){s&&s.m(o,a),y(o,e,a),r.m(o,a),y(o,t,a)},p(o,a){i===(i=n(o))&&r?r.p(o,a):(r.d(1),r=i(o),r&&(r.c(),r.m(t.parentNode,t)))},d(o){o&&(M(e),M(t)),s&&s.d(o),r.d(o)}}}function Sa(l){let e,t=ue(l[14]),s=[];for(let n=0;n<t.length;n+=1)s[n]=yl(vl(l,t,n));return{c(){e=h("span");for(let n=0;n<s.length;n+=1)s[n].c();m(e,"slot","buttonContent")},m(n,i){y(n,e,i);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(n,i){if(i[0]&16384){t=ue(n[14]);let r;for(r=0;r<t.length;r+=1){const o=vl(n,t,r);s[r]?s[r].p(o,i):(s[r]=yl(o),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},d(n){n&&M(e),Ee(s,n)}}}function Da(l){let e,t,s;function n(r){l[32](r)}let i={mode:l[8]?"input":"button",inputPlaceholder:l[7].strings.search,leftIconClass:l[12]?"fa-spinner fa-pulse":"fa-search",rightIconClass:l[9]?"fa-caret-up":"fa-sliders",rightIconLabel:l[7].strings.searchoptions,middleIconClass:l[13]||l[15]?"fa-times":void 0,middleIconLabel:l[7].strings.clearsearch,buttonClass:"alert-primary",onBlur:l[17],onEnter:l[15]?l[20]:l[19],onRightIconClick:l[18],onMiddleIconClick:l[19],onButtonClick:l[16],$$slots:{buttonContent:[Sa],default:[$a]},$$scope:{ctx:l}};return l[1]!==void 0&&(i.inputText=l[1]),e=new Vl({props:i}),l[31](e),Se.push(()=>Ge(e,"inputText",n)),{c(){J(e.$$.fragment)},m(r,o){K(e,r,o),s=!0},p(r,o){const a={};o[0]&256&&(a.mode=r[8]?"input":"button"),o[0]&128&&(a.inputPlaceholder=r[7].strings.search),o[0]&4096&&(a.leftIconClass=r[12]?"fa-spinner fa-pulse":"fa-search"),o[0]&512&&(a.rightIconClass=r[9]?"fa-caret-up":"fa-sliders"),o[0]&128&&(a.rightIconLabel=r[7].strings.searchoptions),o[0]&40960&&(a.middleIconClass=r[13]||r[15]?"fa-times":void 0),o[0]&128&&(a.middleIconLabel=r[7].strings.clearsearch),o[0]&32768&&(a.onEnter=r[15]?r[20]:r[19]),o[0]&56319|o[1]&128&&(a.$$scope={dirty:o,ctx:r}),!t&&o[0]&2&&(t=!0,a.inputText=r[1],Ue(()=>t=!1)),e.$set(a)},i(r){s||(S(e.$$.fragment,r),s=!0)},o(r){z(e.$$.fragment,r),s=!1},d(r){l[31](null),V(e,r)}}}function Ta(l,e,t){let s,n,i,r,o,a,f=G,c=()=>(f(),f=_e(u,E=>t(7,a=E)),u);l.$$.on_destroy.push(()=>f());let{store:u}=e;c();let d=!a.params.search,_=!1,b,p,$="",w="",k="",C=!1,v=!1,T=0,A=!1;const D=E=>{t(1,$=(E==null?void 0:E.content)||""),t(2,w=(E==null?void 0:E.sendername)||""),t(3,k=(E==null?void 0:E.recipientname)||""),t(4,C=(E==null?void 0:E.unread)||!1),t(5,v=(E==null?void 0:E.withfilesonly)||!1),t(6,T=(E==null?void 0:E.maxtime)||0)},N=async()=>{t(8,d=!0),n&&t(9,_=!0),await nt(),b.focus()},I=async()=>{t(8,d=!i),t(9,_=!1),D(s)},H=async()=>{_?(t(9,_=!1),await nt(),b.focus()):(t(8,d=!0),t(9,_=!0),await nt(),p.focus())},P=async()=>{t(8,d=!0),t(9,_=!1),D(),await u.navigate({...a.params,offset:void 0,search:void 0}),await nt(),b.focus()},q=async()=>{await u.navigate({...a.params,messageid:void 0,offset:void 0,search:_?{content:$.trim(),sendername:w.trim(),recipientname:k.trim(),unread:C,withfilesonly:v,maxtime:T}:{content:$.trim()}}),t(9,_=!1),t(8,d=!1)},Z=async E=>{await u.navigate(E),t(9,_=!1),t(8,d=!1)};function se(E){Se[E?"unshift":"push"](()=>{p=E,t(11,p)})}function X(E){w=E,t(2,w)}function ee(E){k=E,t(3,k)}function U(E){C=E,t(4,C)}function te(E){v=E,t(5,v)}function le(E){T=E,t(6,T)}function j(E){A=E,t(12,A)}function B(E){Se[E?"unshift":"push"](()=>{b=E,t(10,b)})}function Y(E){$=E,t(1,$)}return l.$$set=E=>{"store"in E&&c(t(0,u=E.store))},l.$$.update=()=>{l.$$.dirty[0]&128&&t(22,s=a.params.search),l.$$.dirty[0]&4194304&&D(s),l.$$.dirty[0]&4194304&&t(23,n=!!(s!=null&&s.sendername||s!=null&&s.recipientname||s!=null&&s.unread||s!=null&&s.withfilesonly||s!=null&&s.maxtime)),l.$$.dirty[0]&12582912&&t(13,i=!!(s!=null&&s.content)||n),l.$$.dirty[0]&126&&t(15,r=!!($.trim()||w.trim()||k.trim()||C||v||T)),l.$$.dirty[0]&254&&t(14,o=[{label:"",value:$},{label:a.strings.searchfrom,value:w},{label:a.strings.searchto,value:k},{label:a.strings.searchdate,value:T>0?new Date(T*1e3).toLocaleDateString():""},{label:a.strings.searchunreadonly,value:C},{label:a.strings.searchhasattachments,value:v}].filter(({value:E})=>!!E))},[u,$,w,k,C,v,T,a,d,_,b,p,A,i,o,r,N,I,H,P,q,Z,s,n,se,X,ee,U,te,le,j,B,Y]}class La extends oe{constructor(e){super(),fe(this,e,Ta,Da,re,{store:0},null,[-1,-1])}}function Ml(l,e,t){const s=l.slice();return s[4]=e[t],s}function Cl(l){let e,t=l[1].strings.undo+"",s,n,i;function r(){return l[2](l[4])}return{c(){e=h("button"),s=R(t),m(e,"type","button"),m(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3 svelte-5dhscv")},m(o,a){y(o,e,a),g(e,s),n||(i=W(e,"click",r),n=!0)},p(o,a){l=o,a&2&&t!==(t=l[1].strings.undo+"")&&F(s,t)},d(o){o&&M(e),n=!1,i()}}}function Sl(l,e){let t,s,n,i=e[4].text+"",r,o,a,f,c,u,d,_,b,p,$=G,w,k,C,v=e[4].undo&&Cl(e);function T(){return e[3](e[4])}return{key:l,first:null,c(){t=h("div"),s=h("div"),n=h("div"),r=R(i),o=L(),v&&v.c(),a=L(),f=h("button"),c=h("i"),d=L(),m(n,"class","px-1 mr-auto"),m(c,"class","fa fa-times"),m(f,"type","button"),m(f,"class","btn px-2 py-0 ml-2 text-white-50"),m(f,"title",u=e[1].strings.close),m(s,"class","toast-body d-flex align-items-center p-2"),m(t,"class","toast mt-2 mb-0 svelte-5dhscv"),m(t,"role","alert"),m(t,"aria-live","assertive"),m(t,"aria-atomic","true"),m(t,"data-autohide","false"),this.first=t},m(A,D){y(A,t,D),g(t,s),g(s,n),g(n,r),g(s,o),v&&v.m(s,null),g(s,a),g(s,f),g(f,c),g(t,d),w=!0,k||(C=W(f,"click",T),k=!0)},p(A,D){e=A,(!w||D&2)&&i!==(i=e[4].text+"")&&F(r,i),e[4].undo?v?v.p(e,D):(v=Cl(e),v.c(),v.m(s,a)):v&&(v.d(1),v=null),(!w||D&2&&u!==(u=e[1].strings.close))&&m(f,"title",u)},r(){p=t.getBoundingClientRect()},f(){Zl(t),$(),kt(t,p)},a(){$(),$=Ql(t,p,fn,{})},i(A){w||(Ae(()=>{w&&(b&&b.end(1),_=vt(t,mt,{y:50,delay:200}),_.start())}),w=!0)},o(A){_&&_.invalidate(),b=Jl(t,mt,{y:50,duration:400}),w=!1},d(A){A&&M(t),v&&v.d(),A&&b&&b.end(),k=!1,C()}}}function za(l){let e,t=[],s=new Map,n,i=ue(l[1].toasts);const r=o=>o[4];for(let o=0;o<i.length;o+=1){let a=Ml(l,i,o),f=r(a);s.set(f,t[o]=Sl(f,a))}return{c(){e=h("div");for(let o=0;o<t.length;o+=1)t[o].c();m(e,"aria-live","polite"),m(e,"aria-atomic","true"),m(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3 svelte-5dhscv")},m(o,a){y(o,e,a);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(o,[a]){if(a&3){i=ue(o[1].toasts),ne();for(let f=0;f<t.length;f+=1)t[f].r();t=ze(t,a,r,1,o,i,s,e,Ol,Sl,null,Ml);for(let f=0;f<t.length;f+=1)t[f].a();ie()}},i(o){if(!n){for(let a=0;a<i.length;a+=1)S(t[a]);n=!0}},o(o){for(let a=0;a<t.length;a+=1)z(t[a]);n=!1},d(o){o&&M(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function ja(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=f=>r.undo(f),a=f=>r.hideToast(f);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,o,a]}class Na extends oe{constructor(e){super(),fe(this,e,ja,za,re,{store:0})}}function Ia(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),m(t,"class","fa fa fa-fw fa-arrow-left"),m(e,"type","button"),m(e,"class","local-mail-back-button btn btn-secondary svelte-h5ths1"),m(e,"title",s=l[1].strings.messagelist)},m(r,o){y(r,e,o),g(e,t),n||(i=W(e,"click",l[2]),n=!0)},p(r,[o]){o&2&&s!==(s=r[1].strings.messagelist)&&m(e,"title",s)},i:G,o:G,d(r){r&&M(e),n=!1,i()}}}function Aa(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=()=>r.navigateToList();return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Ba extends oe{constructor(e){super(),fe(this,e,Aa,Ia,re,{store:0})}}function Dl(l){let e,t,s=l[1].strings.all+"",n,i,r,o=l[1].strings.none+"",a,f,c,u=l[1].strings.read+"",d,_,b,p=l[1].strings.unread+"",$,w,k,C=l[1].strings.starred+"",v,T,A,D=l[1].strings.unstarred+"",N,I,H;return{c(){e=h("div"),t=h("button"),n=R(s),i=L(),r=h("button"),a=R(o),f=L(),c=h("button"),d=R(u),_=L(),b=h("button"),$=R(p),w=L(),k=h("button"),v=R(C),T=L(),A=h("button"),N=R(D),m(t,"type","button"),m(t,"class","dropdown-item"),m(r,"type","button"),m(r,"class","dropdown-item"),m(c,"type","button"),m(c,"class","dropdown-item"),m(b,"type","button"),m(b,"class","dropdown-item"),m(k,"type","button"),m(k,"class","dropdown-item"),m(A,"type","button"),m(A,"class","dropdown-item"),m(e,"class","dropdown-menu show")},m(P,q){y(P,e,q),g(e,t),g(t,n),g(e,i),g(e,r),g(r,a),g(e,f),g(e,c),g(c,d),g(e,_),g(e,b),g(b,$),g(e,w),g(e,k),g(k,v),g(e,T),g(e,A),g(A,N),I||(H=[W(t,"click",l[7]),W(r,"click",l[8]),W(c,"click",l[9]),W(b,"click",l[10]),W(k,"click",l[11]),W(A,"click",l[12])],I=!0)},p(P,q){q&2&&s!==(s=P[1].strings.all+"")&&F(n,s),q&2&&o!==(o=P[1].strings.none+"")&&F(a,o),q&2&&u!==(u=P[1].strings.read+"")&&F(d,u),q&2&&p!==(p=P[1].strings.unread+"")&&F($,p),q&2&&C!==(C=P[1].strings.starred+"")&&F(v,C),q&2&&D!==(D=P[1].strings.unstarred+"")&&F(N,D)},d(P){P&&M(e),I=!1,Me(H)}}}function qa(l){let e,t,s,n,i,r,o,a,f=l[2]&&Dl(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=L(),f&&f.c(),m(s,"class",n="fa fa-fw "+l[3]),m(t,"class","btn btn-secondary dropdown-toggle"),m(t,"aria-expanded",l[2]),m(t,"title",i=l[1].strings.select),m(e,"class","btn-group"),m(e,"role","group")},m(c,u){y(c,e,u),g(e,t),g(t,s),g(e,r),f&&f.m(e,null),o||(a=[W(t,"click",l[5]),je(it.call(null,e,l[4]))],o=!0)},p(c,[u]){u&8&&n!==(n="fa fa-fw "+c[3])&&m(s,"class",n),u&4&&m(t,"aria-expanded",c[2]),u&2&&i!==(i=c[1].strings.select)&&m(t,"title",i),c[2]?f?f.p(c,u):(f=Dl(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:G,o:G,d(c){c&&M(e),f&&f.d(),o=!1,Me(a)}}}function Pa(l,e,t){let s,n,i=G,r=()=>(i(),i=_e(o,k=>t(1,n=k)),o);l.$$.on_destroy.push(()=>i());let{store:o}=e;r();let a=!1;const f=()=>{t(2,a=!1)},c=()=>{t(2,a=!a)},u=k=>{f(),o.selectAll(k)},d=()=>u("all"),_=()=>u("none"),b=()=>u("read"),p=()=>u("unread"),$=()=>u("starred"),w=()=>u("unstarred");return l.$$set=k=>{"store"in k&&r(t(0,o=k.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[o,n,a,s,f,c,u,d,_,b,p,$,w]}class Ea extends oe{constructor(e){super(),fe(this,e,Pa,qa,re,{store:0})}}function Ra(l){let e,t;return e=new Ea({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Fa(l){let e,t;return e=new Ba({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Tl(l){let e,t,s,n,i,r;const o=[Ua,Ga],a=[];function f(c,u){return c[1].params.tray=="trash"?0:1}return t=f(l),s=a[t]=o[t](l),i=new rn({props:{store:l[0]}}),{c(){e=h("div"),s.c(),n=L(),J(i.$$.fragment),m(e,"class","btn-group"),m(e,"role","group")},m(c,u){y(c,e,u),a[t].m(e,null),g(e,n),K(i,e,null),r=!0},p(c,u){let d=t;t=f(c),t===d?a[t].p(c,u):(ne(),z(a[d],1,1,()=>{a[d]=null}),ie(),s=a[t],s?s.p(c,u):(s=a[t]=o[t](c),s.c()),S(s,1),s.m(e,n));const _={};u&1&&(_.store=c[0]),i.$set(_)},i(c){r||(S(s),S(i.$$.fragment,c),r=!0)},o(c){z(s),z(i.$$.fragment,c),r=!1},d(c){c&&M(e),a[t].d(),V(i)}}}function Ga(l){let e,t,s,n;return e=new nn({props:{store:l[0]}}),s=new tn({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=L(),J(s.$$.fragment)},m(i,r){K(e,i,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(S(e.$$.fragment,i),S(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(e,i),V(s,i)}}}function Ua(l){let e,t,s,n;return e=new on({props:{store:l[0]}}),s=new sn({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=L(),J(s.$$.fragment)},m(i,r){K(e,i,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(S(e.$$.fragment,i),S(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(e,i),V(s,i)}}}function Ll(l){let e,t,s;return t=new Wl({props:{settings:l[1].settings,strings:l[1].strings,courses:l[1].courses,label:l[1].strings.allcourses,selected:l[1].params.courseid,readonly:l[1].params.tray=="course",buttonClass:"alert-primary",dropdownAlign:l[1].viewportSize<ae.MD?"right":"left",onChange:l[2]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),he(e,"max-width","20rem"),he(e,"min-width","0")},m(n,i){y(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&2&&(r.settings=n[1].settings),i&2&&(r.strings=n[1].strings),i&2&&(r.courses=n[1].courses),i&2&&(r.label=n[1].strings.allcourses),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&2&&(r.dropdownAlign=n[1].viewportSize<ae.MD?"right":"left"),i&1&&(r.onChange=n[2]),t.$set(r)},i(n){s||(S(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&M(e),V(t)}}}function Ha(l){let e,t;return e=new vn({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Oa(l){let e,t;return e=new an({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ja(l){var C;let e,t,s,n,i,r=!((C=l[1].message)!=null&&C.draft)&&["shortname","fullname"].includes(l[1].settings.filterbycourse)&&l[1].viewportSize<ae.LG,o,a,f,c;const u=[Fa,Ra],d=[];function _(v,T){return v[1].message?0:1}t=_(l),s=d[t]=u[t](l);let b=l[1].viewportSize>=ae.MD&&Tl(l),p=r&&Ll(l);const $=[Oa,Ha],w=[];function k(v,T){var A;return v[1].viewportSize>=ae.MD?0:(A=v[1].message)!=null&&A.draft?1:-1}return~(a=k(l))&&(f=w[a]=$[a](l)),{c(){e=h("div"),s.c(),n=L(),b&&b.c(),i=L(),p&&p.c(),o=L(),f&&f.c(),m(e,"role","toolbar"),m(e,"class","local-mail-toolbar d-flex w-100 svelte-kqp7rd")},m(v,T){y(v,e,T),d[t].m(e,null),g(e,n),b&&b.m(e,null),g(e,i),p&&p.m(e,null),g(e,o),~a&&w[a].m(e,null),c=!0},p(v,[T]){var N;let A=t;t=_(v),t===A?d[t].p(v,T):(ne(),z(d[A],1,1,()=>{d[A]=null}),ie(),s=d[t],s?s.p(v,T):(s=d[t]=u[t](v),s.c()),S(s,1),s.m(e,n)),v[1].viewportSize>=ae.MD?b?(b.p(v,T),T&2&&S(b,1)):(b=Tl(v),b.c(),S(b,1),b.m(e,i)):b&&(ne(),z(b,1,1,()=>{b=null}),ie()),T&2&&(r=!((N=v[1].message)!=null&&N.draft)&&["shortname","fullname"].includes(v[1].settings.filterbycourse)&&v[1].viewportSize<ae.LG),r?p?(p.p(v,T),T&2&&S(p,1)):(p=Ll(v),p.c(),S(p,1),p.m(e,o)):p&&(ne(),z(p,1,1,()=>{p=null}),ie());let D=a;a=k(v),a===D?~a&&w[a].p(v,T):(f&&(ne(),z(w[D],1,1,()=>{w[D]=null}),ie()),~a?(f=w[a],f?f.p(v,T):(f=w[a]=$[a](v),f.c()),S(f,1),f.m(e,null)):f=null)},i(v){c||(S(s),S(b),S(p),S(f),c=!0)},o(v){z(s),z(b),z(p),z(f),c=!1},d(v){v&&M(e),d[t].d(),b&&b.d(),p&&p.d(),~a&&w[a].d()}}}function Ka(l,e,t){let s,n=G,i=()=>(n(),n=_e(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const o=a=>r.selectCourse(a);return l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s,o]}class Va extends oe{constructor(e){super(),fe(this,e,Ka,Ja,re,{store:0})}}const{window:ft}=at;function zl(l){let e,t;return e=new En({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Wa(l){let e,t=l[3].strings.pluginname+"",s,n,i=l[2]&&l[3].viewportSize<ae.LG&&jl(l);return{c(){e=h("h1"),s=R(t),n=L(),i&&i.c(),m(e,"class","h2 local-mail-view-side-column text-truncate mb-3 mb-md-4 svelte-1uxxomv")},m(r,o){y(r,e,o),g(e,s),g(e,n),i&&i.m(e,null)},p(r,o){o&8&&t!==(t=r[3].strings.pluginname+"")&&F(s,t),r[2]&&r[3].viewportSize<ae.LG?i?i.p(r,o):(i=jl(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&M(e),i&&i.d()}}}function Xa(l){let e;return{c(){e=h("div"),m(e,"class","local-mail-view-side-column svelte-1uxxomv")},m(t,s){y(t,e,s)},p:G,d(t){t&&M(e)}}}function jl(l){let e,t,s;return{c(){e=h("i"),t=L(),s=R(l[2]),m(e,"class","fa fa-angle-right mx-1"),m(e,"aria-hidden","true")},m(n,i){y(n,e,i),y(n,t,i),y(n,s,i)},p(n,i){i&4&&F(s,n[2])},d(n){n&&(M(e),M(t),M(s))}}}function Nl(l){let e,t,s;return t=new La({props:{store:l[0]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-search svelte-1uxxomv")},m(n,i){y(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(S(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&M(e),V(t)}}}function Il(l){let e,t,s,n;e=new Xl({props:{strings:l[3].strings,iconOnly:l[1]&&l[3].viewportSize<ae.SM,onClick:l[16]}});let i=!l[1]&&Al(l);return{c(){J(e.$$.fragment),t=L(),i&&i.c(),s=ge()},m(r,o){K(e,r,o),y(r,t,o),i&&i.m(r,o),y(r,s,o),n=!0},p(r,o){const a={};o&8&&(a.strings=r[3].strings),o&10&&(a.iconOnly=r[1]&&r[3].viewportSize<ae.SM),o&9&&(a.onClick=r[16]),e.$set(a),r[1]?i&&(ne(),z(i,1,1,()=>{i=null}),ie()):i?(i.p(r,o),o&2&&S(i,1)):(i=Al(r),i.c(),S(i,1),i.m(s.parentNode,s))},i(r){n||(S(e.$$.fragment,r),S(i),n=!0)},o(r){z(e.$$.fragment,r),z(i),n=!1},d(r){r&&(M(t),M(s)),V(e,r),i&&i.d(r)}}}function Al(l){let e,t,s;return t=new zn({props:{strings:l[3].strings,onClick:l[17]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","ml-auto")},m(n,i){y(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[17]),t.$set(r)},i(n){s||(S(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&M(e),V(t)}}}function Bl(l){let e,t,s,n=l[3].viewportSize>=ae.LG&&ql(l),i=l[1]&&Pl(l);return{c(){e=h("div"),n&&n.c(),t=L(),i&&i.c(),m(e,"class","row mb-3")},m(r,o){y(r,e,o),n&&n.m(e,null),g(e,t),i&&i.m(e,null),s=!0},p(r,o){r[3].viewportSize>=ae.LG?n?(n.p(r,o),o&8&&S(n,1)):(n=ql(r),n.c(),S(n,1),n.m(e,t)):n&&(ne(),z(n,1,1,()=>{n=null}),ie()),r[1]?i?(i.p(r,o),o&2&&S(i,1)):(i=Pl(r),i.c(),S(i,1),i.m(e,null)):i&&(ne(),z(i,1,1,()=>{i=null}),ie())},i(r){s||(S(n),S(i),s=!0)},o(r){z(n),z(i),s=!1},d(r){r&&M(e),n&&n.d(),i&&i.d()}}}function ql(l){let e,t,s;return t=new Xl({props:{strings:l[3].strings,onClick:l[18]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-side-column svelte-1uxxomv")},m(n,i){y(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&9&&(r.onClick=n[18]),t.$set(r)},i(n){s||(S(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&M(e),V(t)}}}function Pl(l){let e,t,s;return t=new Va({props:{store:l[0]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-main-column d-flex svelte-1uxxomv")},m(n,i){y(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(S(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&M(e),V(t)}}}function El(l){let e,t,s;return t=new jn({props:{settings:l[3].settings,strings:l[3].strings,courses:l[3].courses,labels:l[3].labels,params:l[3].params,onClick:l[0].navigate,onCourseChange:l[0].selectCourse}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-side-column svelte-1uxxomv")},m(n,i){y(n,e,i),K(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[0].navigate),i&1&&(r.onCourseChange=n[0].selectCourse),t.$set(r)},i(n){s||(S(t.$$.fragment,n),s=!0)},o(n){z(t.$$.fragment,n),s=!1},d(n){n&&M(e),V(t)}}}function Rl(l){let e,t,s,n;const i=[Za,Qa,Ya],r=[];function o(a,f){var c;return(c=a[3].message)!=null&&c.draft&&a[3].draftForm?0:a[3].message?1:2}return t=o(l),s=r[t]=i[t](l),{c(){e=h("div"),s.c(),m(e,"class","local-mail-view-main-column svelte-1uxxomv")},m(a,f){y(a,e,f),r[t].m(e,null),n=!0},p(a,f){let c=t;t=o(a),t===c?r[t].p(a,f):(ne(),z(r[c],1,1,()=>{r[c]=null}),ie(),s=r[t],s?s.p(a,f):(s=r[t]=i[t](a),s.c()),S(s,1),s.m(e,null))},i(a){n||(S(s),n=!0)},o(a){z(s),n=!1},d(a){a&&M(e),r[t].d()}}}function Ya(l){let e,t,s,n;return e=new er({props:{store:l[0]}}),s=new la({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=L(),J(s.$$.fragment)},m(i,r){K(e,i,r),y(i,t,r),K(s,i,r),n=!0},p(i,r){const o={};r&1&&(o.store=i[0]),e.$set(o);const a={};r&1&&(a.store=i[0]),s.$set(a)},i(i){n||(S(e.$$.fragment,i),S(s.$$.fragment,i),n=!0)},o(i){z(e.$$.fragment,i),z(s.$$.fragment,i),n=!1},d(i){i&&M(t),V(e,i),V(s,i)}}}function Qa(l){let e,t;return e=new Tr({props:{store:l[0],message:l[3].message}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Za(l){let e,t;return e=new ea({props:{store:l[0],message:l[3].message,form:l[3].draftForm}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),n&8&&(i.form=s[3].draftForm),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Fl(l){let e,t;return e=new Ti({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Gl(l){let e,t;return e=new aa({props:{store:l[0],onCancel:l[19]}}),{c(){J(e.$$.fragment)},m(s,n){K(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[19]),e.$set(i)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function xa(l){let e,t,s,n,i,r,o,a,f,c,u,d,_,b,p,$,w,k,C,v,T,A,D;document.title=t=l[5]+" - "+l[3].strings.pluginname;let N=!l[3].mobile&&zl(l);function I(le,j){return le[3].mobile&&le[3].viewportSize<ae.LG?Xa:Wa}let H=I(l),P=H(l),q=l[1]&&Nl(l),Z=l[3].viewportSize<ae.LG&&Il(l),se=(l[1]||l[3].viewportSize>=ae.LG)&&Bl(l),X=(!l[1]||l[3].viewportSize>=ae.LG)&&El(l),ee=l[1]&&Rl(l),U=l[1]&&l[3].viewportSize<ae.MD&&Fl(l),te=l[3].params.dialog=="preferences"&&Gl(l);return w=new Na({props:{store:l[0]}}),C=new Jn({props:{store:l[0]}}),{c(){e=L(),s=L(),n=h("div"),N&&N.c(),i=L(),r=h("div"),P.c(),o=L(),a=h("div"),q&&q.c(),f=L(),Z&&Z.c(),c=L(),se&&se.c(),u=L(),d=h("div"),X&&X.c(),_=L(),ee&&ee.c(),b=L(),U&&U.c(),p=L(),te&&te.c(),$=L(),J(w.$$.fragment),k=L(),J(C.$$.fragment),m(a,"class","local-mail-view-main-column d-flex mb-3 svelte-1uxxomv"),O(a,"mb-4",l[3].viewportSize>=ae.LG),m(r,"class","row align-items-center"),m(d,"class","row mb-3"),m(n,"class","local-mail local-mail-view container-fluid d-flex flex-column pt-2 svelte-1uxxomv"),O(n,"pt-3",!l[3].mobile),O(n,"p-md-4",!l[3].mobile&&l[3].viewportSize>=ae.MD),O(n,"min-vh-100",l[3].viewportSize<ae.MD)},m(le,j){y(le,e,j),y(le,s,j),y(le,n,j),N&&N.m(n,null),g(n,i),g(n,r),P.m(r,null),g(r,o),g(r,a),q&&q.m(a,null),g(a,f),Z&&Z.m(a,null),g(n,c),se&&se.m(n,null),g(n,u),g(n,d),X&&X.m(d,null),g(d,_),ee&&ee.m(d,null),g(n,b),U&&U.m(n,null),g(n,p),te&&te.m(n,null),g(n,$),K(w,n,null),g(n,k),K(C,n,null),l[20](n),T=!0,A||(D=[W(ft,"resize",l[14]),W(ft,"popstate",l[15]),W(ft,"beforeunload",l[6]),W(ft,"message",l[7]),W(document,"click",function(){De(l[3].mobile?l[8]:void 0)&&(l[3].mobile?l[8]:void 0).apply(this,arguments)}),je(v=Ln.call(null,n,l[3].loading))],A=!0)},p(le,[j]){l=le,(!T||j&40)&&t!==(t=l[5]+" - "+l[3].strings.pluginname)&&(document.title=t),l[3].mobile?N&&(ne(),z(N,1,1,()=>{N=null}),ie()):N?(N.p(l,j),j&8&&S(N,1)):(N=zl(l),N.c(),S(N,1),N.m(n,i)),H===(H=I(l))&&P?P.p(l,j):(P.d(1),P=H(l),P&&(P.c(),P.m(r,o))),l[1]?q?(q.p(l,j),j&2&&S(q,1)):(q=Nl(l),q.c(),S(q,1),q.m(a,f)):q&&(ne(),z(q,1,1,()=>{q=null}),ie()),l[3].viewportSize<ae.LG?Z?(Z.p(l,j),j&8&&S(Z,1)):(Z=Il(l),Z.c(),S(Z,1),Z.m(a,null)):Z&&(ne(),z(Z,1,1,()=>{Z=null}),ie()),(!T||j&8)&&O(a,"mb-4",l[3].viewportSize>=ae.LG),l[1]||l[3].viewportSize>=ae.LG?se?(se.p(l,j),j&10&&S(se,1)):(se=Bl(l),se.c(),S(se,1),se.m(n,u)):se&&(ne(),z(se,1,1,()=>{se=null}),ie()),!l[1]||l[3].viewportSize>=ae.LG?X?(X.p(l,j),j&10&&S(X,1)):(X=El(l),X.c(),S(X,1),X.m(d,_)):X&&(ne(),z(X,1,1,()=>{X=null}),ie()),l[1]?ee?(ee.p(l,j),j&2&&S(ee,1)):(ee=Rl(l),ee.c(),S(ee,1),ee.m(d,null)):ee&&(ne(),z(ee,1,1,()=>{ee=null}),ie()),l[1]&&l[3].viewportSize<ae.MD?U?(U.p(l,j),j&10&&S(U,1)):(U=Fl(l),U.c(),S(U,1),U.m(n,p)):U&&(ne(),z(U,1,1,()=>{U=null}),ie()),l[3].params.dialog=="preferences"?te?(te.p(l,j),j&8&&S(te,1)):(te=Gl(l),te.c(),S(te,1),te.m(n,$)):te&&(ne(),z(te,1,1,()=>{te=null}),ie());const B={};j&1&&(B.store=l[0]),w.$set(B);const Y={};j&1&&(Y.store=l[0]),C.$set(Y),v&&De(v.update)&&j&8&&v.update.call(null,l[3].loading),(!T||j&8)&&O(n,"pt-3",!l[3].mobile),(!T||j&8)&&O(n,"p-md-4",!l[3].mobile&&l[3].viewportSize>=ae.MD),(!T||j&8)&&O(n,"min-vh-100",l[3].viewportSize<ae.MD)},i(le){T||(S(N),S(q),S(Z),S(se),S(X),S(ee),S(U),S(te),S(w.$$.fragment,le),S(C.$$.fragment,le),T=!0)},o(le){z(N),z(q),z(Z),z(se),z(X),z(ee),z(U),z(te),z(w.$$.fragment,le),z(C.$$.fragment,le),T=!1},d(le){le&&(M(e),M(s),M(n)),N&&N.d(),P.d(),q&&q.d(),Z&&Z.d(),se&&se.d(),X&&X.d(),ee&&ee.d(),U&&U.d(),te&&te.d(),V(w),V(C),l[20](null),A=!1,Me(D)}}}function eo(l,e,t){let s,n,i,r,o,a,f,c,u,d=G,_=()=>(d(),d=_e(b,P=>t(3,u=P)),b);l.$$.on_destroy.push(()=>d());let{store:b}=e;_();let p,$=0;dt(()=>{b.setViewportSize(window.innerWidth)}),Kl(()=>{if($!=u.navigationId){$=u.navigationId;let P=p.parentElement;for(;P;)P.scrollTop>0&&P.scrollTo({top:0}),P=P.parentElement}});const w=P=>{if(u.draftData)return P.preventDefault(),b.updateDraft(u.draftData,!0),""},k=P=>{u.mobile&&P.data.addon=="local_mail"&&P.data.backClicked&&b.navigateToMenu()},C=P=>{var q;if(u.mobile&&!P.defaultPrevented&&P.target instanceof HTMLElement){const Z=P.target.closest("a");Z&&((q=window.parent)==null||q.postMessage({addon:"local_mail",openUrl:Z.href},"*")),P.defaultPrevented||P.preventDefault()}},v=()=>b.setViewportSize(window.innerWidth),T=()=>b.navigate(Yl()),A=()=>b.createMessage(u.params.courseid),D=()=>b.showDialog("preferences"),N=()=>b.createMessage(u.params.courseid),I=()=>b.hideDialog();function H(P){Se[P?"unshift":"push"](()=>{p=P,t(4,p)})}return l.$$set=P=>{"store"in P&&_(t(0,b=P.store))},l.$$.update=()=>{var P,q,Z;l.$$.dirty&8&&t(11,s=u.loading),l.$$.dirty&8&&t(1,n=u.params.tray),l.$$.dirty&8&&t(12,i=u.courses.find(se=>se.id==u.params.courseid)),l.$$.dirty&8&&t(13,r=u.labels.find(se=>se.id==u.params.labelid)),l.$$.dirty&12298&&t(2,o=n=="inbox"?u.strings.inbox:n=="starred"?u.strings.starredplural:n=="sent"?u.strings.sentplural:n=="drafts"?u.strings.drafts:n=="trash"?u.strings.trash:n=="label"?(r==null?void 0:r.name)||"":n=="course"?et(i,"fullname"):""),l.$$.dirty&12&&t(5,a=u.message?u.message.subject.trim()||u.strings.nosubject:o),l.$$.dirty&12&&t(10,f=u.viewportSize<ae.LG?o||u.strings.pluginname:""),l.$$.dirty&2&&t(9,c=n!=null),l.$$.dirty&2048&&((P=window.parent)==null||P.postMessage({addon:"local_mail",setLoading:s},"*")),l.$$.dirty&1024&&((q=window.parent)==null||q.postMessage({addon:"local_mail",setTitle:f},"*")),l.$$.dirty&512&&((Z=window.parent)==null||Z.postMessage({addon:"local_mail",captureBack:c},"*"))},[b,n,o,u,p,a,w,k,C,c,f,s,i,r,v,T,A,D,N,I,H]}class to extends oe{constructor(e){super(),fe(this,e,eo,xa,re,{store:0})}}const xe=[];function so(l,e=G){let t;const s=new Set;function n(o){if(Nn(l,o)&&(l=o,t)){const a=!xe.length;for(const f of s)f[1](),xe.push(f,l);if(a){for(let f=0;f<xe.length;f+=2)xe[f][0](xe[f+1]);xe.length=0}}}function i(o){n(o(l))}function r(o,a=G){const f=[o,a];return s.add(f),s.size===1&&(t=e(n,i)||G),o(l),()=>{s.delete(f),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function lo(l){let e=0,t={userid:l.userid,settings:l.settings,preferences:l.preferences,strings:l.strings,mobile:l.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:s,set:n}=so(t),i=j=>n({...t,...j});s(j=>{t=j});const r=async(j,B,Y=!1)=>{var Qe,Ze,lt,St,Dt;const E=(Qe=t.message)==null?void 0:Qe.id,de=t.draftData,x=B||t.params,ve=!Y&&(x.tray!=t.params.tray||x.messageid!=t.params.messageid||x.courseid!=t.params.courseid||x.labelid!=t.params.labelid||x.search!=t.params.search)?{...t.params,dialog:void 0}:t.prevParams,we=t.preferences.perpage;if(i({loading:!0,error:void 0}),gt(x,Y),E&&de&&(window.clearTimeout(e),e=0,j.unshift({methodname:"update_message",messageid:E,data:de})),j.push({methodname:"get_courses"}),j.push({methodname:"get_labels"}),x.tray){const ye={courseid:x.courseid,labelid:x.tray=="label"?x.labelid:void 0,draft:x.tray=="drafts"?!0:x.tray=="sent"?!1:void 0,roles:x.tray=="inbox"?["to","cc","bcc"]:x.tray=="sent"?["from"]:void 0,starred:x.tray=="starred"?!0:void 0,deleted:x.tray=="trash"};j.push({methodname:"count_messages",query:ye}),x.messageid?(j.push({methodname:"get_message",messageid:x.messageid}),j.push({methodname:"search_messages",query:{...ye,...x.search,startid:x.messageid,reverse:!1},limit:1}),j.push({methodname:"search_messages",query:{...ye,...x.search,startid:x.messageid,reverse:!0},limit:1}),x.search||j.push({methodname:"count_messages",query:{...ye,startid:x.messageid,reverse:!0}})):j.push({methodname:"search_messages",query:{...ye,...x.search},offset:x.search?void 0:x.offset,limit:x.search?we+1:we})}const ke=await o(j);if(ke==null)return null;let ce,Ce,Te,$e,be=[],pe=0;x.tray&&(x.messageid?(x.search||(Ce=ke.pop()),$e=(Ze=ke.pop()[0])==null?void 0:Ze.id,Te=(lt=ke.pop()[0])==null?void 0:lt.id,ce=ke.pop()):(be=ke.pop(),x.search&&(x.search.reverse?($e=(St=be[we])==null?void 0:St.id,Te=x.search.startid,be=be.slice(0,we).reverse()):($e=x.search.startid,Te=(Dt=be[we])==null?void 0:Dt.id,be=be.slice(0,we)))),pe=ke.pop());const Q=ke.pop(),me=ke.pop();if(E&&de&&ke.shift(),x.tray=="course"&&!me.find(ye=>ye.id==x.courseid)||x.tray=="label"&&!Q.find(ye=>ye.id==x.labelid))return await p({tray:"inbox"},!0),ke;let st,Ye,Ne;if(ce!=null&&ce.draft){const ye=[{methodname:"get_roles",courseid:ce.course.id},{methodname:"get_groups",courseid:ce.course.id}];(ce==null?void 0:ce.id)!=E&&ye.push({methodname:"get_message_form",messageid:ce.id});const Re=await o(ye);if(Re==null)return null;(ce==null?void 0:ce.id)!=E&&(st=Re.pop()),Ne=Re.pop(),Ye=Re.pop()}return i({params:x,prevParams:ve,unread:me.reduce((ye,Re)=>ye+Re.unread,0),drafts:me.reduce((ye,Re)=>ye+Re.drafts,0),courses:me,labels:Q,messageOffset:Ce,totalCount:pe,listMessages:be,message:ce,nextMessageId:Te,prevMessageId:$e,draftForm:(ce==null?void 0:ce.id)!=E?st:t.draftForm,draftRoles:Ye,draftGroups:Ne,draftData:void 0,draftSaved:(ce==null?void 0:ce.id)==E,selectedMessages:new Map(ce?[[ce.id,ce]]:t.message?[]:be.filter(ye=>t.selectedMessages.has(ye.id)).map(ye=>[ye.id,ye])),loading:!1,navigationId:Y||x.tray!=t.params.tray||x.courseid!=t.params.courseid||x.labelid!=t.params.labelid||x.messageid!=t.params.messageid||x.offset!=t.params.offset?t.navigationId+1:t.navigationId}),E&&de&&E!=(ce==null?void 0:ce.id)&&se({text:t.strings.draftsaved}),ke},o=async j=>{try{return await Ct(j)}catch(B){return N(B),null}},a=async(j,B)=>{const Y={methodname:"create_label",name:j,color:B,messageids:Array.from(t.selectedMessages.keys())};await r([Y])},f=async j=>{const B=t.params,Y={methodname:"create_message",courseid:j||t.courses[0].id},E=await o([Y]);E!=null&&await p({tray:"drafts",messageid:E.pop(),courseid:["shortname","fullname"].includes(t.settings.filterbycourse)&&B.courseid?j:void 0})},c=async j=>{await r([{methodname:"delete_label",labelid:j}],{tray:"inbox"})},u=async j=>{await r([{methodname:"empty_trash",courseid:j}])},d=async j=>{const B=t.params,Y={methodname:"forward_message",messageid:j.id},E=await r([Y]);E!=null&&await p({tray:"drafts",messageid:E.pop(),courseid:["shortname","fullname"].includes(t.settings.filterbycourse)&&B.courseid!=null?j.course.id:void 0})},_=()=>{const j={...t.params,dialog:void 0};i({params:j}),gt(j,!0)},b=j=>{i({toasts:t.toasts.filter(B=>B!=j)})},p=async(j,B=!1,Y=!0)=>{var x;const E=[];Y&&t.settings.incrementalsearch&&E.push({methodname:"search_messages",query:{deleted:!1},offset:t.settings.incrementalsearchlimit,limit:1}),j!=null&&j.messageid&&E.push({methodname:"view_message",messageid:j.messageid});const de=await r(E,j,B);if(de!=null&&Y&&t.settings.incrementalsearch){const ve=de[0];i({incrementalSearchStopId:(x=ve[0])==null?void 0:x.id})}},$=async(j=!1)=>{const B={...t.params,messageid:void 0,offset:Math.floor((t.params.offset||0)/t.preferences.perpage)*t.preferences.perpage||void 0};await r([],B,j)},w=async()=>{await r([],{})},k=async(j,B)=>{const Y=t.params,E={methodname:"reply_message",messageid:j.id,all:B},de=await r([E]);de!=null&&await p({tray:"drafts",messageid:de.pop(),courseid:["shortname","fullname"].includes(t.settings.filterbycourse)&&Y.courseid!=null?j.course.id:void 0})},C=async j=>{i({preferences:{...t.preferences,...j}});let B=t.params;j.perpage&&(B={...B,offset:t.params.offset?Math.trunc(t.params.offset/j.perpage)*j.perpage:void 0}),await r([{methodname:"set_preferences",preferences:j}],B,!0)},v=j=>{i({selectedMessages:new Map(t.listMessages.filter(B=>j=="all"||j=="read"&&!B.unread||j=="unread"&&B.unread||j=="starred"&&B.starred||j=="unstarred"&&!B.starred).map(B=>[B.id,B]))})},T=async j=>{await p({...t.params,courseid:j,offset:0,messageid:void 0,search:t.params.search?{...t.params.search,startid:void 0,reverse:void 0}:void 0})},A=async()=>{var E;if(!((E=t.message)!=null&&E.draft))return;const j={methodname:"send_message",messageid:t.message.id},B=t.prevParams?{...t.prevParams,messageid:void 0,offset:Math.floor((t.prevParams.offset||0)/t.preferences.perpage)*t.preferences.perpage||void 0}:["shortname","fullname"].includes(t.settings.filterbycourse)?{tray:"inbox",courseid:t.message.course.id}:{tray:"course",courseid:t.message.course.id};await r([j],B)!=null&&se({text:t.strings.messagesent})},D=async(j,B,Y)=>{const E=j.map(ve=>({methodname:"set_deleted",messageid:ve,deleted:B})),de={...t.params,messageid:void 0};if(await r(E,de,!0)!=null&&B!=Ke.DeletedForever){const ve=B?j.length>1?"messagesmovedtotrash":"messagemovedtotrash":j.length>1?"messagesrestored":"messagerestored",we=Ie(t.strings[ve],j.length);se({text:we,undo:Y?()=>{D(j,B?Ke.NotDeleted:Ke.Deleted,!1)}:void 0})}},N=async j=>{i({loading:t.loading&&!j,error:j})},I=async(j,B)=>{le(E=>t.selectedMessages.has(E.id)?{...E,labels:t.labels.filter(de=>j.includes(de.id)?!0:B.includes(de.id)?!1:E.labels.findIndex(x=>x.id==de.id)>=0)}:E);const Y=[];t.selectedMessages.forEach(E=>{Y.push({methodname:"set_labels",messageid:E.id,labelids:E.labels.map(de=>de.id)})}),await r(Y)},H=async(j,B)=>{le(E=>j.includes(E.id)?{...E,starred:B}:E);const Y=j.map(E=>({methodname:"set_starred",messageid:E,starred:B}));await r(Y)},P=async(j,B)=>{le(de=>j.includes(de.id)?{...de,unread:B}:de);const Y=j.map(de=>({methodname:"set_unread",messageid:de,unread:B})),E={...t.params,messageid:void 0};await r(Y,E)},q=j=>{i({viewportSize:j,navigationId:t.navigationId+1}),!t.params.tray&&j>=ae.LG&&!t.error&&p({tray:"inbox",dialog:t.params.dialog},!0)},Z=async j=>{const B={...t.params,dialog:j};gt(B,t.params.dialog!=null),i({params:B})},se=async j=>{i({toasts:[j]}),j&&window.setTimeout(()=>b(j),1e4)},X=j=>{i({selectedMessages:new Map(t.listMessages.filter(B=>B.id==j?!t.selectedMessages.has(B.id):t.selectedMessages.has(B.id)).map(B=>[B.id,B]))})},ee=async j=>{j.undo&&(b(j),j.undo())},U=(j,B)=>{if(!t.message)return;const Y=t.message,E=async()=>{window.clearTimeout(e),e=0;const de=t.draftData;if(!de)return;const x=[{methodname:"update_message",messageid:Y.id,data:de},{methodname:"get_message",messageid:Y.id}],ve=await o(x);if(ve!=null&&de===t.draftData){const we=ve.pop();i({message:we,draftData:void 0,draftSaved:!0})}};i({draftData:j,draftSaved:!1}),B?E():!e&&t.settings.autosaveinterval>0&&(e=window.setTimeout(E,t.settings.autosaveinterval*1e3))},te=async(j,B,Y)=>{await r([{methodname:"update_label",labelid:j,name:B,color:Y}])},le=j=>{i({listMessages:t.listMessages.map(B=>j(B)),message:t.message?j(t.message):void 0,selectedMessages:new Map(Array.from(t.selectedMessages.entries()).map(([B,Y])=>[B,j(Y)]))})};return await p(Yl(),!0,!0),{createLabel:a,createMessage:f,deleteLabel:c,emptyTrash:u,forward:d,get:()=>t,hideDialog:_,hideToast:b,navigate:p,navigateToList:$,navigateToMenu:w,reply:k,savePreferences:C,selectAll:v,selectCourse:T,sendMessage:A,setDeleted:D,setError:N,setLabels:I,setStarred:H,setUnread:P,setViewportSize:q,showDialog:Z,subscribe:s,toggleSelected:X,undo:ee,updateDraft:U,updateLabel:te}}async function no(){const l=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const s=await lo({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(l&&new to({target:l,props:{store:s}}),e){e.innerHTML="";const n=s.get(),i=new In({target:e,props:{settings:n.settings,strings:n.strings,courses:n.courses,labels:n.labels,params:n.params,loading:n.loading,onClick:s.navigate,onComposeClick:s.createMessage,onCourseChange:s.selectCourse}});s.subscribe(r=>{i.$set({settings:r.settings,strings:r.strings,courses:r.courses,labels:r.labels,params:r.params,loading:r.loading})})}}no();
//# sourceMappingURL=view-88oT0m-X.js.map
